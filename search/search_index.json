{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Benvinguts","text":"<p>Benvinguts a la p\u00e0gina del m\u00f2dul de Bastionat de Xarxes i Sistemes del Curs d'especialitzaci\u00f3 en Ciberseguretat.</p>"},{"location":"#professors","title":"Professors","text":"<ul> <li>Maite Mart\u00ed</li> <li>Xuso Ort\u00ed</li> </ul>"},{"location":"Prac_T2/","title":"Criptograf\u00eda","text":""},{"location":"Prac_T2/#1-practica-esteganografia","title":"1. Pr\u00e0ctica Esteganografia","text":"<p>Realitza aquesta pr\u00e0ctica</p>"},{"location":"Prac_T2/#2-practica-quick-hash","title":"2. Pr\u00e0ctica Quick Hash","text":"<p>Realitza aquesta pr\u00e0ctica</p>"},{"location":"Prac_T2/#3-practica-gpg","title":"3. Pr\u00e0ctica GPG","text":"<p>Realitza aquesta pr\u00e0ctica</p>"},{"location":"Prac_T2/#4-practica-kleopatra","title":"4. Pr\u00e0ctica Kleopatra","text":"<p>Realitza aquesta pr\u00e0ctica</p>"},{"location":"Prac_T2/#5-practica-creacio-duna-pki-en-linux","title":"5. Pr\u00e0ctica creaci\u00f3 d'una PKI en Linux","text":"<p>Realitza aquesta pr\u00e0ctica</p>"},{"location":"Prac_T2/#6-practica-us-de-certificats-web","title":"6. Pr\u00e0ctica \u00das de certificats web","text":"<p>Realitza aquesta pr\u00e0ctica</p>"},{"location":"Prac_T2/#7-practica-creacio-duna-pki-en-windows","title":"7. Pr\u00e0ctica Creaci\u00f3 d'una PKI en Windows","text":"<p>Realitza aquesta pr\u00e0ctica</p>"},{"location":"apunts/","title":"Apunts complementaris","text":""},{"location":"apunts/#apunts-i","title":"Apunts I","text":"<p>Descarrega el primer bloc d'apunts</p> <p>Descarrega el segon bloc d'apunts</p>"},{"location":"connexio_ssh/","title":"Connexi\u00f3 SSH","text":"<p>Una connexi\u00f3 SSH (Secure Shell) implica diversos passos, des de l'inici de la connexi\u00f3 fins a l'establiment d'un canal de comunicaci\u00f3 segur. Aquests passos garanteixen la seguretat, autenticaci\u00f3 i confidencialitat de les dades transmeses. Aqu\u00ed tens un desglossament detallat dels passos d'una connexi\u00f3 SSH:</p> <p></p>"},{"location":"connexio_ssh/#1-inici-de-la-connexio-i-negociacio-de-la-versio","title":"1. Inici de la connexi\u00f3 i Negociaci\u00f3 de la Versi\u00f3","text":"<p>Quan el client vol connectar-se a un servidor mitjan\u00e7ant SSH, primer s'inicia la connexi\u00f3 TCP al servidor, normalment al port 22 (per defecte, tot i que es pot configurar un altre port).</p> <ul> <li>Client envia un missatge amb la versi\u00f3 del protocol SSH que suporta.</li> <li>Servidor respon enviant la seva pr\u00f2pia versi\u00f3 del protocol SSH.</li> </ul> <p>Aquest intercanvi de versions permet al client i al servidor con\u00e8ixer la versi\u00f3 de SSH que utilitzar\u00e0 durant la sessi\u00f3.</p>"},{"location":"connexio_ssh/#2-negociacio-de-parametres-de-la-connexio","title":"2. Negociaci\u00f3 de Par\u00e0metres de la Connexi\u00f3","text":"<p>El client i el servidor negocien quins algorismes utilitzaran per establir la connexi\u00f3 segura. Aix\u00f2 inclou:</p> <ul> <li>Algorisme d'intercanvi de claus (com Diffie-Hellman o ECDH).</li> <li>Algorismes de xifrat sim\u00e8tric (com AES o ChaCha20).</li> <li>Algorismes de HMAC (per verificar la integritat dels missatges, com HMAC-SHA2).</li> <li>Algorismes d'autenticaci\u00f3 de la clau p\u00fablica (com RSA, ED25519, etc.).</li> </ul> <p>El client i el servidor escullen la millor combinaci\u00f3 d'algorismes segons el que suporten, i la connexi\u00f3 procedir\u00e0 amb aquests.</p>"},{"location":"connexio_ssh/#3-intercanvi-de-claus-key-exchange","title":"3. Intercanvi de Claus (Key Exchange)","text":"<p>Un cop s'han negociat els algorismes, comen\u00e7a el proc\u00e9s d'intercanvi de claus, que s'utilitza per generar una clau de sessi\u00f3 compartida.</p> <ul> <li>El client i el servidor fan servir l'algorisme d'intercanvi de claus (com Diffie-Hellman o Elliptic Curve Diffie-Hellman).</li> <li>Durant aquest proc\u00e9s, cap de les parts ha d'enviar la clau secreta directament. En lloc d'aix\u00f2, el client i el servidor utilitzen valors temporals per generar una clau sim\u00e8trica comuna que s'utilitzar\u00e0 per xifrar la resta de la comunicaci\u00f3.</li> </ul>"},{"location":"connexio_ssh/#4-autenticacio-del-servidor","title":"4. Autenticaci\u00f3 del Servidor","text":"<p>El servidor s'autentica davant del client per assegurar que el client s'est\u00e0 connectant al servidor correcte.</p> <ul> <li>El servidor envia la seva clau p\u00fablica al client.</li> <li>El client comprova si aquesta clau p\u00fablica \u00e9s v\u00e0lida. Si ja s'ha connectat anteriorment al servidor, la clau s'hauria de trobar en el fitxer <code>known_hosts</code> del client.</li> <li>Si \u00e9s la primera vegada que el client es connecta al servidor, el client mostrar\u00e0 un missatge per acceptar la clau del servidor.</li> </ul> <p>Si la clau p\u00fablica del servidor coincideix amb la que el client t\u00e9 registrada, el client confia en el servidor.</p>"},{"location":"connexio_ssh/#5-autenticacio-del-client","title":"5. Autenticaci\u00f3 del Client","text":"<p>Un cop el servidor ha estat autenticat, ara \u00e9s el torn del client d'autenticar-se davant del servidor. Aquest pas pot fer-se de diverses maneres, les dues m\u00e9s comunes s\u00f3n:</p> <ul> <li>Autenticaci\u00f3 per contrasenya: El client envia la seva contrasenya al servidor de manera xifrada. Si la contrasenya \u00e9s correcta, la connexi\u00f3 s'estableix.</li> <li>Autenticaci\u00f3 per clau p\u00fablica: Si el client t\u00e9 configurades claus SSH, el servidor envia un repte al client, que el client ha de signar amb la seva clau privada. El servidor comprova la signatura amb la clau p\u00fablica del client (que hauria d'estar ja registrada al servidor).</li> </ul> <p>La segona opci\u00f3 \u00e9s m\u00e9s segura, ja que no cal enviar una contrasenya per la xarxa.</p>"},{"location":"connexio_ssh/#6-establiment-del-canal-xifrat-sessio-segura","title":"6. Establiment del Canal Xifrat (Sessi\u00f3 Segura)","text":"<p>Un cop el client ha estat autenticat amb \u00e8xit, es genera una clau sim\u00e8trica (obtinguda de l'intercanvi de claus anterior) que es far\u00e0 servir per xifrar totes les dades que es transmetin durant la sessi\u00f3.</p> <p>Aquest xifrat protegeix la confidencialitat i la integritat de la comunicaci\u00f3 entre el client i el servidor.</p>"},{"location":"connexio_ssh/#7-intercanvi-de-dades-sessio-activa","title":"7. Intercanvi de Dades (Sessi\u00f3 Activa)","text":"<p>Ara que la connexi\u00f3 segura est\u00e0 establerta, el client i el servidor poden comen\u00e7ar a enviar dades de forma segura.</p> <ul> <li>El client pot executar comandes en el servidor remot o transferir arxius.</li> <li>Tot el tr\u00e0nsit entre el client i el servidor est\u00e0 xifrat amb la clau de sessi\u00f3 sim\u00e8trica.</li> </ul> <p>Aquest \u00e9s el moment en qu\u00e8 es realitza l'objectiu principal de la connexi\u00f3 SSH, com ara iniciar una sessi\u00f3 de terminal, transferir arxius via SCP o SFTP, o establir un t\u00fanel de connexi\u00f3 segura (port forwarding).</p>"},{"location":"connexio_ssh/#8-tancament-de-la-connexio","title":"8. Tancament de la Connexi\u00f3","text":"<p>Un cop el client o el servidor decideix acabar la sessi\u00f3, es tanca la connexi\u00f3 SSH.</p> <ul> <li>El client envia una sol\u00b7licitud per tancar la sessi\u00f3.</li> <li>El servidor tanca la connexi\u00f3, allibera els recursos, i amb aix\u00f2, finalitza la comunicaci\u00f3.</li> </ul>"},{"location":"connexio_ssh/#resum-dels-passos","title":"Resum dels passos:","text":"<ol> <li>Inici de la connexi\u00f3: El client i el servidor intercanvien les versions del protocol SSH.</li> <li>Negociaci\u00f3 d'algorismes: Es decideixen quins xifrats, algorismes de HMAC i intercanvi de claus s'utilitzaran.</li> <li>Intercanvi de claus: El client i el servidor generen una clau de sessi\u00f3 segura mitjan\u00e7ant un algorisme com Diffie-Hellman.</li> <li>Autenticaci\u00f3 del servidor: El client verifica la clau p\u00fablica del servidor.</li> <li>Autenticaci\u00f3 del client: El client s'autentica mitjan\u00e7ant contrasenya o clau p\u00fablica.</li> <li>Establiment del canal xifrat: Es genera una clau sim\u00e8trica per xifrar la comunicaci\u00f3.</li> <li>Intercanvi de dades: El client i el servidor intercanvien dades de manera segura i xifrada.</li> <li>Tancament de la connexi\u00f3: El client o el servidor finalitzen la sessi\u00f3 segura.</li> </ol> <p>Aquest proc\u00e9s assegura que la comunicaci\u00f3 sigui segura, confidencial i que cap atacant pugui interceptar o modificar la informaci\u00f3 transmesa entre el client i el servidor.</p>"},{"location":"crear_appliances/","title":"Crear appliances","text":""},{"location":"crear_appliances/#mikrotik","title":"Mikrotik","text":""},{"location":"crear_appliances/#1-appliance","title":"1. Appliance","text":"<p>Baixa alguna versi\u00f3 estable de la web de Mikrotik en la secci\u00f3 Cloud hosted routers i tipus Raw disk image.</p> <p></p> <p>Fem una m\u00e0quina <code>Qemu</code> nova.</p> <p></p> <p>Selecciona la imatge baixada.</p> <p></p> <p>Canv\u00eda el s\u00edmbol.</p> <p></p>"},{"location":"crear_appliances/#2-configuracio","title":"2. Configuraci\u00f3","text":"<p>Podem configurar <code>Mikrotik</code> de tres formes diferents.</p> <ul> <li>Amb <code>Winbox</code></li> <li>Amb un appliance de <code>GNS3</code></li> <li>Navegador web</li> </ul> <p>Warning</p> <p>L'aplicaci\u00f3 de <code>Winbox</code> est\u00e0 disponible per a <code>Windows</code>, si vols utilitzar-la en <code>Linux</code> has de fer \u00fas de <code>Wine</code>.</p> <p>Warning</p> <p>Per a poder utilitzar el navegador cal que router tinga alguna adre\u00e7a <code>IP</code> i que hi haja enrutament fins la m\u00e0quina on utilitzes el navegador.</p>"},{"location":"crear_appliances/#3-xarxa-basica","title":"3. Xarxa b\u00e0sica","text":"<p>El seg\u00fcent esquema correspon a una xarxa b\u00e0sica en la que els ordinadors poden navegar.</p> <p></p> <p>Cal configurar el <code>Mikrotik</code> per a poder navegar, per tant haurem de configurar les adreces de la part <code>LAN</code>, activar un <code>servidor dhcp</code> i fer una regla en el firewall de tipus <code>masquerade</code> per a que el router puga fer <code>NAT</code>.</p> <p>Fem la configuraci\u00f3 amb <code>Winbox</code> que despr\u00e9s explicarem com funciona.</p> <p></p> <p>Canvia el nom de les interf\u00edcies del router a <code>WAN i LAN</code>.</p> <p>Observa com en la interf\u00edcie <code>WAN</code> s'ha creat autom\u00e0ticament un <code>dhcpclient</code> i obt\u00e9 l'adre\u00e7a per dhcp. Configurem la <code>LAN</code> amb 10.0.0.1/24</p> <p></p> <p>Fem el server dhcp directament des del <code>setup</code></p> <p></p> <p>Indiquem amb una regla de <code>firewall</code> de tipus <code>NAT</code> que a tot tr\u00e0fic que vaja a eixir per la <code>WAN</code> se li aplique un <code>masquerade</code>.</p> <p></p> <p></p> <p>Comprovem que assigne les adreces correctes...</p> Bash<pre><code>PC1&gt; ip dhcp\nDORA IP 10.0.0.253/24 GW 10.0.0.1\n</code></pre> <p>Des de l'appliance de <code>Firefox</code> es veu com es pot navegar.</p>"},{"location":"crear_appliances/#appliance-ubuntu-server","title":"Appliance Ubuntu Server","text":"<p>Per al punt 1 haurem de crear una m\u00e0quina virtual en Virtual Box, o almenys hem de tenir un disc <code>vdi</code> o <code>mdk</code></p>"},{"location":"crear_appliances/#1-crear-appliance-des-dun-disc-dur-de-virtualbox","title":"1. Crear appliance des d'un disc dur de VirtualBox","text":"<p>Primer -&gt; Tindre un disc creat en Virtualbox o Vmware</p> <p>Segon  -&gt; Seleccionar New Template. Crear de forma manual </p> <p>Tercer -&gt; Ens obrir\u00e0 el men\u00fa de prefer\u00e8ncies i triarem l'apartat QEMU </p> <p>Quart  -&gt; Nom de la nova plantilla </p> <p>Cinqu\u00e9 -&gt; Triar el virtualitzador, en aquesta cas qemu. Ho deixarem per defecte. I triar la quantitat de mem\u00f2ria RAM per a la m\u00e0quina. </p> <p>Sis\u00e9 -&gt; Ara triem el tipus de consola. En el nostre cas vnc. </p> <p>Set\u00e9  -&gt; En aquest apartat triem New imatge i seleccionem el disc <code>vdi</code> o  <code>mdk</code> </p> <p>Warning</p> <p>IMPORTANT -- Sembla que es quede penjat per\u00f2 est\u00e0 important la m\u00e0quina.</p> <p>Warning</p> <p>PACI\u00c8NCIA</p> <p>Huit\u00e9 -&gt; Seguidament ens pregunta si volem copiar-la al directori d'imatges. Li diguem que Si. </p> <p>Nov\u00e9  -&gt; Apliquem els canvis i ja tenim la plantilla disponible per a utilitzar. </p>"},{"location":"crear_appliances/#2-crear-des-del-gns3-marketplace","title":"2. Crear des del GNS3 Marketplace","text":"<p>El procediment \u00e9s el mateix que per al firefox, la \u00fanica difer\u00e8ncia \u00e9s que en el Guest triarem un Ubuntu Server. Ens rediriguir\u00e0 a la p\u00e0gina d'osboxes. Un lloc on podem triar les m\u00e0quinas ja instal\u00b7lades per a descarregar. La difer\u00e8ncia \u00e9s que les versions no coincidixen i haurem de crear una versi\u00f3 nova i triar la imatge que hem descarregat.</p> <p>Warning</p> <p>Es descarrega un 7zip que hem de descomprimir i ja trindrem la imatge del disc per a importar.</p>"},{"location":"criptografia/","title":"Criptograf\u00eda","text":""},{"location":"criptografia/#1-introduccion","title":"1. Introducci\u00f3n","text":"<p>Criptograf\u00eda</p> <p>La criptograf\u00eda es el desarrollo de un conjunto de t\u00e9cnicas que permiten alterar y modificar mensajes o archivos con el objetivo de que no puedan ser le\u00eddos por todos aquellos usuarios que no est\u00e9n autorizados a hacerlo. Hoy en d\u00eda, en pleno auge de las comunicaciones digitales, funciona como la base para cualquier proceso de seguridad inform\u00e1tica.</p> <p>Esta disciplina naci\u00f3 en la Antigua Grecia con el objetivo de evitar que se difundan secretos militares. Los mensajes se encriptaban con m\u00e9todos sencillos como, por ejemplo, alternando las letras del abecedario. Con el correr de los siglos esas t\u00e9cnicas se fueron complejizando considerablemente y actualmente atraviesan gran parte de nuestra vida cotidiana.</p> <p>Entre el Antiguo Egipto e Internet, los criptogramas (los mensajes cifrados) han protagonizado buena parte de los grandes episodios hist\u00f3ricos y un sinf\u00edn de an\u00e9cdotas. Existen mensajes cifrados entre los art\u00edculos del Kamasutra, se usaron por gobernantes y militares ya en los primeros estados como Egipto, Babilonia, Roma... Abundan en los textos diplom\u00e1ticos de toda \u00e9poca, indispensables para las \u00f3rdenes militares y los ej\u00e9rcitos modernos en tiempos de guerra y, por supuesto, esenciales en la actividad de los esp\u00edas. Hoy en d\u00eda, con las nuevas tecnolog\u00edas el uso de la criptograf\u00eda se ha extendido m\u00e1s all\u00e1 de su tradicional esfera estatal o pol\u00edtica, y es vital tambi\u00e9n para la actividad diaria de las empresas y ciudadanos particulares.</p> <p>Algunos ejemplos de la evoluci\u00f3n a lo largo de la historia del uso de elementos criptogr\u00e1ficos s\u00f3n los siguientes. Los espartanos utilizaron, hacia el 400 a.C., la Escitala, que puede considerarse el primer sistema de criptograf\u00eda por transposici\u00f3n, es decir, que se caracteriza por ocultar el significado real de un texto alterando el orden de los signos que lo conforman. Los militares de la ciudad-estado griega escrib\u00edan sus mensajes sobre una tela que envolv\u00eda una vara. El mensaje s\u00f3lo pod\u00eda leerse cuando se enrollaba la tela sobre un bast\u00f3n del mismo grosor, que pose\u00eda el destinatario l\u00edcito del mensaje (\u00bfel origen del \"bast\u00f3n de mando\"?).El m\u00e9todo de la escitala era extremadamente sencillo, como tambi\u00e9n lo era el que utiliz\u00f3 Julio C\u00e9sar, basado en la sustituci\u00f3n de cada letra por la situada tres puestos despu\u00e9s en el alfabeto latino. A este cifrado por sustituci\u00f3n sencilla se le conoce como cifrado C\u00e9sar. </p> <p></p> <p></p> <p>La escitala</p> <p>Mira este sencillo video sobre el funcionamiento de la escitala.</p> <p>Criptograf\u00eda y matem\u00e1tica</p> <p>Una buena introducci\u00f3n a la criptografia y las matem\u00e1ticas.</p> <p>A medida que la tecnolog\u00eda evolucion\u00f3, los elementos criptogr\u00e1ficos se volvieron m\u00e1s complejos, encontrando ejemplos c\u00f3mo la m\u00e1quina Enigma en la II Guerra Mundial.</p> <p></p>"},{"location":"criptografia/#2-funciones-hash","title":"2. Funciones HASH","text":"<p>HASH</p> <p>Una funci\u00f3n criptogr\u00e1fica hash- usualmente conocida como \u201chash\u201d- es un algoritmo matem\u00e1tico que transforma cualquier bloque arbitrario de datos en una nueva serie de caracteres con una longitud fija. Independientemente de la longitud de los datos de entrada, el valor hash de salida tendr\u00e1 siempre la misma longitud.</p> <p></p> <p>A modo de ejemplo introductorio, vemos en la siguiente figura que las funciones HASH se pueden aplicar tanto a texto c\u00f3mo a ficheros de datos.</p> <p></p> <p>Art\u00edculo</p> <p>Lee este art\u00edculo en el que se explica el funcionamiento de las funciones HASH.</p>"},{"location":"criptografia/#3-cifrado-simetrico","title":"3. Cifrado sim\u00e9trico","text":"<p>Uso de claves</p> <p>Solo utiliza una clave para cifrar y descifrar. \u00c9sta debe ser previamente conocida por todas las partes involucradas. </p> <p>Seg\u00fan se explica en la web de NIC Argentina podemos imaginar este sistema como algo similar a la seguridad de nuestra casa. Tenemos una llave para cerrar la puerta y estamos tranquilos que solo las personas con esa misma llave la van a poder abrir. Tenemos la ventaja que podemos compartirla con cualquier persona de confianza, pero tambi\u00e9n existe la posibilidad de que se extrav\u00ede, o de que alguien la robe. Esa es la principal desventaja de la criptograf\u00eda sim\u00e9trica.</p> <p></p> <p>Debes leer el siguiente art\u00edculo y visualizar el video</p>"},{"location":"criptografia/#4-cifrado-asimetrico-criptografia-de-clave-publica","title":"4. Cifrado asim\u00e9trico. Criptograf\u00eda de clave p\u00fablica.","text":"<p>Asim\u00e9trico</p> <p>Es un sistema basado en el uso de dos claves, una clave privada que s\u00f3lamente puede conocer el propietario, y una clave p\u00fablica (vinculada con la privada) que conocen todos los participantes en la comunicaci\u00f3n. </p> <p></p> <p>Si una persona que emite un mensaje a un destinatario, usa la llave p\u00fablica de este \u00faltimo para cifrarlo; una vez cifrado, solo la clave privada del destinatario podr\u00e1 descifrar el mensaje, ya que es el \u00fanico que deber\u00eda conocerla. Por tanto se logra la confidencialidad del env\u00edo del mensaje, es extremadamente dif\u00edcil que lo descifre alguien salvo el destinatario . Cualquiera, usando la llave p\u00fablica del destinatario, puede cifrarle mensajes; los que ser\u00e1n descifrados por el destinatario usando su clave privada.</p> <p>Si el propietario del par de claves usa su clave privada para cifrar un mensaje, cualquiera puede descifrarlo utilizando la clave p\u00fablica del primero. En este caso se consigue la identificaci\u00f3n y autentificaci\u00f3n del remitente, ya que se sabe que solo pudo haber sido \u00e9l quien emple\u00f3 su clave privada (salvo que un tercero la haya obtenido). Esta idea es el fundamento de la firma digital, donde jur\u00eddicamente existe la presunci\u00f3n de que el firmante es efectivamente el due\u00f1o de la clave privada.</p> <p>Los sistemas de cifrado de clave p\u00fablica o sistemas de cifrado asim\u00e9tricos se inventaron con el fin de evitar por completo el problema del intercambio de claves de los sistemas de cifrado sim\u00e9tricos. Con las claves p\u00fablicas no es necesario que el remitente y el destinatario se pongan de acuerdo en la clave a emplear. Todo lo que se requiere es que, antes de iniciar la comunicaci\u00f3n secreta, cada uno debe conseguir la llave p\u00fablica del otro y cuidar cada uno su llave privada. Es m\u00e1s, esas mismas claves p\u00fablicas pueden ser usada por cualquiera que desee comunicarse con alguno de ellos siempre que se utilice correctamente la llave p\u00fablica de cada uno. </p>"},{"location":"criptografia/#ejemplo-1-mensaje-secreto","title":"Ejemplo 1: Mensaje secreto","text":"<p>Supongamos que Ana quiere enviar a David un mensaje secreto que solo \u00e9l pueda leer.</p> <p>Primero, David env\u00eda a Ana una caja abierta, pero con cerradura, cerradura que se bloquear\u00e1 una vez se cierre la caja, y que solo podr\u00e1 abrirse con una llave, que solo David tiene. Ana recibe la caja, escribe el mensaje, lo pone en la caja y la cierra con su cerradura (ahora Ana ya no podr\u00e1 abrir la caja para acceder de nuevo al mensaje). Finalmente, Ana env\u00eda la caja a David y este la abre con su llave. En este ejemplo, la caja con la cerradura es la \u00abclave p\u00fablica\u00bb de David, y la llave de la cerradura es su \u00abclave privada\u00bb. </p> <p></p> <p>\"Caja\" y \"cerradura\" son variables, dos datos (en el caso m\u00e1s sencillo, dos n\u00fameros) necesarios ambos para resolver un determinado problema matem\u00e1tico de manera inmediata. Es cierto que teniendo solo la \"cerradura\" (alguien que interceptase la caja antes de que llegue a David), un cerrajero experto podr\u00eda abrir la caja sin necesidad de la \"llave\", pero, en la pr\u00e1ctica, un sistema de cifrado competente exhibe una complejidad tal que su resoluci\u00f3n, desconociendo la clave privada del destinatario, exige de una potencia computacional o de un coste en tiempo desproporcionadamente mayor al valor esperado del robo de la informaci\u00f3n (la computaci\u00f3n cu\u00e1ntica, por ejemplo, reducir\u00eda en mucho dicho coste, volviendo obsoletos no pocos sistemas criptogr\u00e1ficos que a d\u00eda de hoy pueden considerarse efectivamente invulnerables). </p>"},{"location":"criptografia/#ejemplo-2-firma-digital","title":"Ejemplo 2: Firma digital","text":""},{"location":"criptografia/#5-infraestructura-pki","title":"5. Infraestructura PKI","text":"<p>Seg\u00fan indica Ram\u00f3n Onrubia en los apuntes de su curso, tenemos el siguiente escenario. </p> <p>Hemos visto en el punto anterior, que la criptograf\u00eda de clave p\u00fablica nos proporciona autenticaci\u00f3n, confidencialidad, integridad y no repudio, necesarios hoy en d\u00eda para garantizar una buena seguridad en la informaci\u00f3n. Como hemos visto, esto se consigue con un sistema de claves p\u00fablicas y privadas que combin\u00e1ndolos adecuadamente nos proporcionan los servicios citados anteriormente.</p> <p>Pero el principal problema que surge es la confianza. \u00bfC\u00f3mo puedo garantizar que la clave p\u00fablica de un usuario es suya y no es la de un impostor? Cualquiera puede generar un par de claves y pretender ser otra persona. Aqu\u00ed es donde entran en juego las autoridades de certificaci\u00f3n (AC o CA, del ingl\u00e9s Certification Authority), que asumen la responsabilidad de autenticar la identidad de esa clave p\u00fablica y que aparecer\u00e1 en un documento electr\u00f3nico llamado certificado digital.</p> <p>Todo este conjunto de certificados, firmas digitales, autoridades de certificaci\u00f3n y los procesos que intervienen, forman parte de lo que se conoce como infraestructura de clave p\u00fablica que pasamos a definir a continuaci\u00f3n.</p> <p>PKI</p> <p>Por infraestructura de clave p\u00fablica o PKI (Public Key Infraestructure) se entiende el conjunto de herramientas hardware, software, procesos y procedimientos legales que permiten crear, gestionar, almacenar, distribuir y revocar certificados digitales. </p> <p>Este t\u00e9rmino incluye por tanto las autoridades de certificaci\u00f3n y al resto de elementos que participan como los certificados digitales o los algoritmos de clave p\u00fablica y firma digital en comunicaciones  y transacciones electr\u00f3nicas.</p> <p>Hay que indicar tambi\u00e9n que para usar la firma digital y los algoritmos de clave p\u00fablica, no es necesaria la PKI, como se ha podido ver en las pr\u00e1cticas del punto anterior.</p> <p>Una infraestructura de clave p\u00fablica consta de:</p> <ul> <li>Autoridades de Certificaci\u00f3n (CAs) que llevan la gesti\u00f3n de los certificados</li> <li>Autoridades de Registro (RAs), que autorizan la asociaci\u00f3n entre una clave p\u00fablica y el titular de un certificado</li> <li>Partes utilizadoras, que verifican certificados y firmas</li> <li>Repositorios (Directorios), que almacenan y distribuyen certificados y estados de los mismos</li> <li>Titulares de Certificados, que son las entidades finales, usuarios o suscriptores de los certificados y por tanto a quien pertenecen</li> <li>Autoridad de Validaci\u00f3n (opcional), que suministra informaci\u00f3n de forma online (en tiempo real) acerca del estado de un certificado</li> </ul> <p></p>"},{"location":"equipBase/","title":"equipBase","text":"<p>Tutorial de Fortificaci\u00f3 de l'Equip Base en Seguretat Inform\u00e0tica</p> <p>La fortificaci\u00f3 d\u2019un equip base \u00e9s una estrat\u00e8gia fonamental en la seguretat inform\u00e0tica per reduir la superf\u00edcie d'atac i protegir el sistema de possibles vulnerabilitats. Aqu\u00ed et presento una guia pas a pas per millorar la seguretat d\u2019un sistema:</p>"},{"location":"equipBase/#1-actualitzacions-de-sistema-operatiu-i-programari","title":"1. Actualitzacions de Sistema Operatiu i Programari","text":""},{"location":"equipBase/#objectiu-corregir-vulnerabilitats-i-millorar-la-seguretat-general-del-sistema","title":"Objectiu: Corregir vulnerabilitats i millorar la seguretat general del sistema.","text":"<ul> <li>Windows: Activa les actualitzacions autom\u00e0tiques o verifica manualment les actualitzacions a Configuraci\u00f3 &gt; Actualitzaci\u00f3 i seguretat.</li> <li>Linux: Executa comandes com <code>sudo apt update &amp;&amp; sudo apt upgrade</code> (en sistemes basats en Debian) o <code>dnf update</code> (en Red Hat/Fedora) per mantenir el sistema al dia.</li> <li>macOS: V\u00e9s a Prefer\u00e8ncies del sistema &gt; Actualitzaci\u00f3 de programari per garantir que tens les darreres versions instal\u00b7lades.</li> </ul>"},{"location":"equipBase/#2-us-dun-tallafocs-firewall","title":"2. \u00das d'un Tallafocs (Firewall)","text":""},{"location":"equipBase/#objectiu-filtrar-el-trafic-de-xarxa-no-desitjat-i-prevenir-atacs","title":"Objectiu: Filtrar el tr\u00e0fic de xarxa no desitjat i prevenir atacs.","text":"<ul> <li>Windows: Configura el tallafocs a la secci\u00f3 de Configuraci\u00f3 &gt; Actualitzaci\u00f3 i seguretat &gt; Tallafocs.</li> <li>Linux: Activa i configura <code>ufw</code> (Uncomplicated Firewall) amb comandes com <code>sudo ufw enable</code> i defineix les regles de tr\u00e0fic.</li> <li>macOS: Activa el tallafocs a Prefer\u00e8ncies del sistema &gt; Seguretat i privacitat &gt; Tallafocs.</li> </ul>"},{"location":"equipBase/#3-configuracio-de-politiques-de-contrassenya-segures","title":"3. Configuraci\u00f3 de Pol\u00edtiques de Contrassenya Segures","text":""},{"location":"equipBase/#objectiu-augmentar-la-complexitat-i-seguretat-de-les-contrasenyes-utilitzades-en-el-sistema","title":"Objectiu: Augmentar la complexitat i seguretat de les contrasenyes utilitzades en el sistema.","text":"<ul> <li>Estableix requisits de complexitat: Minimitza l\u2019\u00fas de contrasenyes f\u00e0cils. Opta per requisits de longitud m\u00ednima i \u00fas de maj\u00fascules, min\u00fascules, n\u00fameros i car\u00e0cters especials.</li> <li>Activa l'expiraci\u00f3 de contrasenyes: Revisa i canvia les contrasenyes peri\u00f2dicament.</li> </ul>"},{"location":"equipBase/#com-fer-ho","title":"Com fer-ho:","text":"<ul> <li>Windows: Configura pol\u00edtiques de contrasenya a Configuraci\u00f3 &gt; Comptes &gt; Opcions d'inici de sessi\u00f3.</li> <li>Linux: Edita fitxers com <code>/etc/login.defs</code> i utilitza <code>chage</code> per establir l\u00edmits de caducitat de contrasenya.</li> </ul>"},{"location":"equipBase/#4-gestio-de-privilegis-dusuaris","title":"4. Gesti\u00f3 de Privilegis d'Usuaris","text":""},{"location":"equipBase/#objectiu-reduir-lacces-innecessari-als-recursos-i-funcionalitats-del-sistema","title":"Objectiu: Reduir l\u2019acc\u00e9s innecessari als recursos i funcionalitats del sistema.","text":"<ul> <li>Utilitza comptes d\u2019usuari limitats: Les tasques di\u00e0ries han de realitzar-se amb comptes d\u2019usuari amb privilegis m\u00ednims. Nom\u00e9s utilitza comptes d'administrador per tasques de manteniment.</li> </ul>"},{"location":"equipBase/#com-fer-ho_1","title":"Com fer-ho:","text":"<ul> <li>Windows: Configura permisos a Configuraci\u00f3 &gt; Comptes &gt; Fam\u00edlia i altres usuaris.</li> <li>Linux: Fes servir <code>sudo</code> per accedir als permisos administratius de manera temporal.</li> </ul>"},{"location":"equipBase/#5-desactivacio-de-serveis-i-ports-innecessaris","title":"5. Desactivaci\u00f3 de Serveis i Ports Innecessaris","text":""},{"location":"equipBase/#objectiu-reduir-la-superficie-datac-desactivant-serveis-no-utilitzats","title":"Objectiu: Reduir la superf\u00edcie d'atac desactivant serveis no utilitzats.","text":""},{"location":"equipBase/#com-fer-ho_2","title":"Com fer-ho:","text":"<ul> <li>Windows: Utilitza el gestor de serveis (<code>services.msc</code>) per aturar serveis innecessaris.</li> <li>Linux: Fes servir <code>systemctl</code> o <code>service</code> per revisar i desactivar serveis inactius: <code>sudo systemctl disable servei</code>.</li> </ul>"},{"location":"equipBase/#6-xifrat-de-disc-dur-i-fitxers","title":"6. Xifrat de Disc Dur i Fitxers","text":""},{"location":"equipBase/#objectiu-protegir-les-dades-en-cas-de-robatori-o-acces-no-autoritzat","title":"Objectiu: Protegir les dades en cas de robatori o acc\u00e9s no autoritzat.","text":"<ul> <li>Windows: Utilitza BitLocker per xifrar el disc dur completament.</li> <li>Linux: Utilitza LUKS (<code>cryptsetup luksFormat</code>) per xifrar volums de disc.</li> <li>macOS: Activa FileVault a Prefer\u00e8ncies del sistema &gt; Seguretat i privacitat &gt; FileVault.</li> </ul>"},{"location":"equipBase/#7-antivirus-i-anti-malware","title":"7. Antivirus i Anti-Malware","text":""},{"location":"equipBase/#objectiu-defensar-el-sistema-contra-programari-malicios","title":"Objectiu: Defensar el sistema contra programari malici\u00f3s.","text":"<ul> <li>Windows: Activa Windows Defender o utilitza una altra soluci\u00f3 antivirus de confian\u00e7a.</li> <li>Linux: Encara que no \u00e9s tan com\u00fa, utilitza eines com <code>ClamAV</code> per escanejar el sistema.</li> <li>macOS: Complementa amb solucions antivirus comercials o gratu\u00eftes, segons convingui.</li> </ul>"},{"location":"equipBase/#8-activacio-de-lautenticacio-multifactor-mfa","title":"8. Activaci\u00f3 de l'Autenticaci\u00f3 Multifactor (MFA)","text":""},{"location":"equipBase/#objectiu-afegir-una-capa-addicional-de-seguretat-als-comptes-dacces","title":"Objectiu: Afegir una capa addicional de seguretat als comptes d'acc\u00e9s.","text":"<ul> <li>Activa MFA en comptes d'administrador i serveis en l\u00ednia importants com correu electr\u00f2nic, VPN, etc.</li> </ul>"},{"location":"equipBase/#com-fer-ho_3","title":"Com fer-ho:","text":"<ul> <li>Windows: Usa l'opci\u00f3 de Windows Hello per activar MFA (empremta digital, reconeixement facial).</li> <li>Linux: Configura Google Authenticator o altres aplicacions de MFA amb PAM (Pluggable Authentication Modules).</li> </ul>"},{"location":"equipBase/#9-auditoria-de-logs-i-monitoratge-de-seguretat","title":"9. Auditoria de Logs i Monitoratge de Seguretat","text":""},{"location":"equipBase/#objectiu-revisar-els-esdeveniments-de-seguretat-i-detectar-comportaments-sospitosos","title":"Objectiu: Revisar els esdeveniments de seguretat i detectar comportaments sospitosos.","text":"<ul> <li>Linux: Configura el sistema per registrar esdeveniments amb <code>rsyslog</code> o eines com <code>auditd</code>.</li> <li>Windows: Activa els logs d\u2019esdeveniments des de l'Administrador d'esdeveniments i configura pol\u00edtiques per arxivar esdeveniments importants.</li> </ul>"},{"location":"equipBase/#10-copies-de-seguretat-regulars","title":"10. C\u00f2pies de Seguretat Regulars","text":""},{"location":"equipBase/#objectiu-garantir-la-recuperacio-de-dades-en-cas-de-fallada-o-atac","title":"Objectiu: Garantir la recuperaci\u00f3 de dades en cas de fallada o atac.","text":"<ul> <li>Implementa la regla 3-2-1: Realitza tres c\u00f2pies de seguretat, utilitzant dos tipus de suports diferents, i guarda una c\u00f2pia fora de les instal\u00b7lacions.</li> </ul>"},{"location":"equipBase/#com-fer-ho_4","title":"Com fer-ho:","text":"<ul> <li>Windows: Configura l'historial de fitxers o utilitza eines externes com Acronis o Veeam.</li> <li>Linux: Utilitza eines com <code>rsync</code>, <code>timeshift</code>, o solucions de c\u00f2pies de seguretat com Bacula.</li> <li>macOS: Utilitza Time Machine per fer c\u00f2pies de seguretat autom\u00e0tiques.</li> </ul>"},{"location":"equipBase/#11-bloqueig-de-lequip-i-proteccio-fisica","title":"11. Bloqueig de l'Equip i Protecci\u00f3 F\u00edsica","text":""},{"location":"equipBase/#objectiu-evitar-acces-fisic-no-autoritzat-a-lequip","title":"Objectiu: Evitar acc\u00e9s f\u00edsic no autoritzat a l'equip.","text":"<ul> <li>Windows/Linux/macOS: Configura el sistema perqu\u00e8 es bloquegi autom\u00e0ticament despr\u00e9s d\u2019un per\u00edode d'inactivitat.</li> </ul>"},{"location":"equipBase/#12-proteccio-de-xarxa-vpn-i-segmentacio","title":"12. Protecci\u00f3 de Xarxa: VPN i Segmentaci\u00f3","text":""},{"location":"equipBase/#objectiu-mantenir-les-connexions-segures-i-separar-diferents-parts-de-la-xarxa-per-minimitzar-limpacte-dun-atac","title":"Objectiu: Mantenir les connexions segures i separar diferents parts de la xarxa per minimitzar l'impacte d'un atac.","text":"<ul> <li>Configura una VPN: Per accedir de manera segura a recursos remots.</li> <li>Utilitza una xarxa segmentada: A\u00eflla dispositius menys segurs en segments de xarxa separats.</li> </ul>"},{"location":"equipBase/#13-desactivacio-de-scripts-i-maquinari-innecessaris","title":"13. Desactivaci\u00f3 de Scripts i Maquinari Innecessaris","text":""},{"location":"equipBase/#objectiu-evitar-que-funcions-o-dispositius-no-utilitzats-es-converteixin-en-vectors-datac","title":"Objectiu: Evitar que funcions o dispositius no utilitzats es converteixin en vectors d'atac.","text":"<ul> <li>Desactiva dispositius no utilitzats: Com unitats de disquet, ports USB o serveis de xarxa sense \u00fas.</li> </ul>"},{"location":"fail2ban_telegram/","title":"fail2ban i Telegram","text":""},{"location":"fail2ban_telegram/#fail2ban","title":"Fail2ban","text":"<p>Fail2Ban \u00e9s una eina de seguretat per a servidors Linux que ajuda a protegir contra atacs de for\u00e7a bruta. La seva principal funci\u00f3 \u00e9s monitoritzar els fitxers de registre del sistema per detectar patrons espec\u00edfics relacionats amb intents d'inici de sessi\u00f3 fallits, i despr\u00e9s pren accions com bloquejar temporalment l'adre\u00e7a IP de l'origen d'aquests intents.</p> <p>Aqu\u00ed tens com instal\u00b7lar fail2ban en un sistema Ubuntu:</p> <p>Actualitza el sistema:</p> <p>Abans d'instal\u00b7lar nous paquets, \u00e9s una bona pr\u00e0ctica actualitzar la llista de paquets disponibles i actualitzar els paquets ja instal\u00b7lats.</p> Bash<pre><code>sudo apt update\nsudo apt upgrade\n</code></pre> <p>Instal\u00b7la Fail2Ban:</p> <p>Utilitza el gestor de paquets <code>apt</code> per instal\u00b7lar fail2ban.</p> Bash<pre><code>sudo apt install fail2ban\n</code></pre> <p>Configuraci\u00f3 b\u00e0sica de Fail2Ban:</p> <p>Despr\u00e9s de la instal\u00b7laci\u00f3, fail2ban crea els seus fitxers de configuraci\u00f3 a <code>/etc/fail2ban/</code>. El fitxer principal \u00e9s <code>fail2ban.conf</code>, i les regles espec\u00edfiques es configuren a trav\u00e9s de fitxers de jail com <code>jail.conf</code> o <code>jail.local</code>.</p> Bash<pre><code>sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local\n</code></pre> <p>Configura Jail per a SSH (sshd):</p> <p>Obrir el fitxer de configuraci\u00f3 de jail local amb un editor de text. Pots utilitzar <code>nano</code> o qualsevol editor que prefereixis.</p> Bash<pre><code>sudo nano /etc/fail2ban/jail.local\n</code></pre> <p>Cerca la secci\u00f3 <code>[sshd]</code> i assegura't que estigui configurada per habilitar fail2ban per a SSH. Pots ajustar el valor de <code>maxretry</code> segons les teves prefer\u00e8ncies.</p> INI<pre><code>[sshd]\nenabled = true\nport = ssh\nfilter = sshd\nlogpath = /var/log/auth.log\nmaxretry = 5\n</code></pre> <p>Guarda els canvis i tanca l'editor.</p> <p>Inicia i habilita el servei Fail2Ban:</p> <p>Inicia el servei Fail2Ban i habilita que s'executi al iniciar-se el sistema.</p> Bash<pre><code>sudo service fail2ban start\nsudo service fail2ban enable\n</code></pre> <p>o</p> Bash<pre><code>sudo systemctl start fail2ban\nsudo systemctl enable fail2ban\n</code></pre> <p>A partir d'aquest moment, Fail2Ban est\u00e0 monitoritzant els intents d'inici de sessi\u00f3 fallits a trav\u00e9s del registre del sistema (en aquest cas, <code>/var/log/auth.log</code> per SSH) i pren accions com bloquejar temporalment les adreces IP que superin el l\u00edmit especificat.</p> <p>Pots revisar els registres i configurar m\u00e9s opcions mitjan\u00e7ant els fitxers de configuraci\u00f3 de Fail2Ban. Tamb\u00e9 pots crear regles personalitzades per altres serveis i protocols. La documentaci\u00f3 oficial de Fail2Ban \u00e9s un bon recurs per a m\u00e9s detalls i configuracions avan\u00e7ades: Fail2Ban Wiki.</p>"},{"location":"fail2ban_telegram/#enviament-notificacions","title":"Enviament notificacions","text":""},{"location":"fail2ban_telegram/#crear-bot-de-telegram","title":"Crear bot de Telegram","text":"<p>Crear bot i grup</p> <p>Has de crear un bot de telegram i un grup, i afegir el bot al grup per a realitzar la pr\u00e0ctica. Has d'obtindre el token del bot i l'identificador de la conversa per a configurar el script.</p> <p>Crear un nou bot a Telegram \u00e9s un proc\u00e9s senzill que es fa a trav\u00e9s de Telegram amb l'ajuda del BotFather, un bot oficial de Telegram que permet crear i gestionar bots. Aqu\u00ed tens els passos per crear un nou bot a Telegram:</p> <p>Inicia una conversa amb el BotFather:    - V\u00e9s a la barra de cerca de Telegram i escriu \"BotFather\".    - Inicia una conversa amb el BotFather fent clic sobre ell i despr\u00e9s fes clic a \"Iniciar\" o envia el missatge <code>/start</code>.</p> <p>Crea un nou bot:    - Envia el missatge <code>/newbot</code> per comen\u00e7ar el proc\u00e9s de creaci\u00f3 d'un nou bot.</p> <p>Proporciona un nom per el teu bot:    - El BotFather et demanar\u00e0 que li donis un nom per al teu bot. Escull un nom que sigui \u00fanic, ja que cada bot a Telegram ha de tenir un nom \u00fanic. Aquest nom tamb\u00e9 ser\u00e0 utilitzat com a nom d'usuari del bot.</p> <p>Proporciona un nom d'usuari per al teu bot:    - Despr\u00e9s de triar el nom, el BotFather et demanar\u00e0 que li donis un nom d'usuari pel teu bot. Aquest nom d'usuari ha de ser \u00fanic i acabar amb la paraula \"bot\" (per exemple, \"example_bot\"). El nom d'usuari \u00e9s com s'identificar\u00e0 el teu bot a Telegram.</p> <p>Rebr\u00e0s el token del teu bot:    - Una vegada hagis completat els passos anteriors, el BotFather et enviar\u00e0 un missatge amb el token del teu bot. Aquest token \u00e9s una clau \u00fanica que identifica el teu bot i que s'utilitzar\u00e0 per a les comunicacions amb l'API de Telegram.</p> <p>Guarda aquest token de manera segura, ja que el necessitar\u00e0s per programar o configurar el teu bot.</p> <p>Ara has creat amb \u00e8xit un nou bot a Telegram. Pots comen\u00e7ar a programar-lo i personalitzar-lo segons les teves necessitats. Per obtenir m\u00e9s informaci\u00f3 sobre com interactuar amb l'API de Telegram i desenvolupar funcionalitats per al teu bot, pots revisar la documentaci\u00f3 oficial de Telegram per als desenvolupadors: Telegram Bot API.</p> <p></p>"},{"location":"fail2ban_telegram/#exemple-de-script-per-a-enviar-un-text-per-telegram","title":"Exemple de script per a enviar un text per Telegram","text":"test_telegram.md<pre><code>#!/bin/bash\nUSERID=\"\" #Chat al que queremos enviar el mensaje.\nKEY=\"\" #API Key generada por BotFather.\nTIMEOUT=\"10\" #Timeout de la petici\u00f3n a la API.\nURL=\"https://api.telegram.org/bot$KEY/sendMessage\" #URL de la API para enviar mensajes.\nLOG=\"envio_telegram_`date \"+%d%m%Y\"`.log\" #Log de env\u00edo de mensajes.\nSONIDO=0 #Cuando SONIDO es 0, suena notificaci\u00f3n, si es 1, es silenciosa.\nFECHA_EJEC=\"$(date \"+%d %b %H:%M:%S\")\" #Generamos fecha y hora de ejecuci\u00f3n.\n#Condicional para enviar sonido o no con la notificaci\u00f3n. Segundo par\u00e1metro.\nif [[ $2 -eq 1 ]] ; then\n    SONIDO=1\nfi\nTEXTO=\"&lt;b&gt;$FECHA_EJEC:&lt;/b&gt;\\n&lt;pre&gt;$1&lt;/pre&gt;\" #Texto a enviar. Fecha de ejecuci\u00f3n y primer par\u00e1metro del script.\ncurl -s --max-time $TIMEOUT -d \"parse_mode=HTML&amp;disable_notification=$SONIDO&amp;chat_id=$USERID&amp;disable_web_page_preview=1&amp;text=`echo -e \"$TEXTO\"`\" $URL &gt;&gt; $LOG 2&gt;&amp;1 #Realizamos la petici\u00f3n a la API con la informaci\u00f3n recopilada.\n\"echo\" &gt;&gt; $LOG #Introducimos l\u00ednea nueva en el log.\n</code></pre> <p>Par\u00e0metres del script</p> <p>Es pot modificar el script per a que reba la IP bloquejada com a par\u00e0metre per a comunicar-la.</p>"},{"location":"fail2ban_telegram/#configurar-per-a-executar-un-script","title":"Configurar per a executar un script","text":"<p>Afegir a l'arxiu <code>/etc/fail2ban/jail.conf</code></p> Bash<pre><code>[sshd]\n\n# To use more aggressive sshd modes set filter parameter \"mode\" in jail.local:\n# normal (default), ddos, extra or aggressive (combines all).\n# See \"tests/files/logs/sshd\" or \"filter.d/sshd.conf\" for usage example and details.\n#mode   = normal\nport    = ssh\nlogpath = %(sshd_log)s\nbackend = %(sshd_backend)s\naction  = iptables[name=SSH, port=22, protocol=tcp]\n            telegram\n</code></pre> <p>Tabulaci\u00f3</p> <p>Hi ha que tabular correctament <code>telegram</code> o no funcionar\u00e0!!</p> <p>Crear l'arxiu <code>/etc/fail2ban/action.d/telegram.conf</code></p> Bash<pre><code>[Definition]\nactionstart = /etc/fail2ban/scripts/test_telegram.sh \"iniciant telegram\"\nactionstop = /etc/fail2ban/scripts/test_telegram.sh \"parant telegram\"\nactioncheck = \nactionban = /etc/fail2ban/scripts/test_telegram.sh \"s'ha bloquejat una IP\"\nactionunban = /etc/fail2ban/scripts/test_telegram.sh \"s'ha desbloquejat una IP\"\n\n[Init]\ninit = 123\n</code></pre> <p>Carpeta scripts</p> <p>Ubicar el script en la carpeta <code>/etc/fail2ban/scripts</code> i comprova que tinga permissos d'execuci\u00f3</p>"},{"location":"fail2ban_telegram/#resposta-de-telegram","title":"Resposta de Telegram","text":"<p>T'aconselle que proves primer el script i comproves que envia correctament a telegram. Si \u00e9s aix\u00ed, a m\u00e9s a m\u00e9s d'apareixer els missatges es crea un log en una estructura semblant a aquesta:</p> JSON<pre><code>{\"ok\":true,\"result\":{\"message_id\":19,\"from\":{\"id\":6440810779,\"is_bot\":true,\"first_name\":\"fail2baninformerbot\",\"username\":\"fail2baninformerbot\"},\"chat\":{\"id\":-4000475834,\"title\":\"Avisos fail2ban\",\"type\":\"group\",\"all_members_are_administrators\":true},\"date\":1702919156,\"text\":\"18 de des. 18:05:56:\\nhola\",\"entities\":[{\"offset\":0,\"length\":20,\"type\":\"bold\"},{\"offset\":21,\"length\":4,\"type\":\"pre\"}]}}\n</code></pre>"},{"location":"fail2ban_telegram/#funcionament","title":"Funcionament","text":"<p>Si tot funciona correctament, quan es bloqueja una ip el bot de telegram es comunica.</p> <p></p> <p>Pots consultar el log del <code>fail2ban</code> en <code>/var/log/fail2ban.log</code></p> <p></p>"},{"location":"hardering_ssh/","title":"Hardering SSH","text":"<p>Hardering d'un servidor SSH</p> <p>El hardening de SSH \u00e9s una s\u00e8rie de pr\u00e0ctiques per augmentar la seguretat de les connexions SSH al teu sistema. A continuaci\u00f3 tens alguns passos importants per fer un hardening de SSH:</p> <p></p>"},{"location":"hardering_ssh/#1-canviar-el-port-per-defecte","title":"1. Canviar el port per defecte","text":"<p>Per defecte, SSH escolta al port 22. Canviar-lo pot reduir els intents d'atacs autom\u00e0tics.</p> <ul> <li>Edita el fitxer de configuraci\u00f3 de SSH: Bash<pre><code>sudo nano /etc/ssh/sshd_config\n</code></pre></li> <li>Canvia la l\u00ednia <code>Port 22</code> a un n\u00famero de port no usat (per exemple, <code>Port 2222</code>).</li> </ul> <p>Despr\u00e9s, reinicia el servei SSH:   Bash<pre><code>sudo systemctl restart sshd\n</code></pre></p>"},{"location":"hardering_ssh/#2-deshabilitar-lacces-com-a-root","title":"2. Deshabilitar l'acc\u00e9s com a <code>root</code>","text":"<p>L'acc\u00e9s SSH com a root \u00e9s perill\u00f3s. Deshabilita'l per obligar els usuaris a autenticar-se amb un compte normal i despr\u00e9s usar <code>sudo</code>.</p> <ul> <li>Al fitxer de configuraci\u00f3 <code>/etc/ssh/sshd_config</code>, busca la l\u00ednia:   Bash<pre><code>PermitRootLogin yes\n</code></pre></li> <li>Canvia-la a:   Bash<pre><code>PermitRootLogin no\n</code></pre></li> </ul>"},{"location":"hardering_ssh/#3-usar-autenticacio-per-clau-publica","title":"3. Usar autenticaci\u00f3 per clau p\u00fablica","text":"<p>Deshabilita l'autenticaci\u00f3 per contrasenya i usa claus SSH per autenticar-te.</p> <ul> <li>Genera una clau SSH al teu ordinador client (si no en tens una):   Bash<pre><code>ssh-keygen -t rsa -b 4096\n</code></pre></li> <li>Despr\u00e9s, copia la clau p\u00fablica al servidor:   Bash<pre><code>ssh-copy-id usuari@server_ip\n</code></pre></li> <li>Finalment, deshabilita l'autenticaci\u00f3 per contrasenya editant el fitxer <code>/etc/ssh/sshd_config</code> i canvia:   Bash<pre><code>PasswordAuthentication yes\n</code></pre>   a:   Bash<pre><code>PasswordAuthentication no\n</code></pre></li> </ul>"},{"location":"hardering_ssh/#4-usar-ssh-protocol-2","title":"4. Usar SSH Protocol 2","text":"<p>SSH t\u00e9 dues versions de protocol, i la versi\u00f3 1 \u00e9s considerada insegura. Assegura't que est\u00e0s utilitzant la versi\u00f3 2:</p> <ul> <li>Al fitxer <code>/etc/ssh/sshd_config</code>, assegura't que hi hagi aquesta l\u00ednia:   Bash<pre><code>Protocol 2\n</code></pre></li> </ul>"},{"location":"hardering_ssh/#5-restriccio-per-ip-firewall","title":"5. Restricci\u00f3 per IP (Firewall)","text":"<p>Utilitza el tallafocs per permetre nom\u00e9s connexions SSH des de determinades adreces IP.</p> <ul> <li>Amb ufw (si est\u00e0 instal\u00b7lat):   Bash<pre><code>sudo ufw allow from IP_a_permetre to any port 2222\nsudo ufw enable\n</code></pre></li> </ul>"},{"location":"hardering_ssh/#6-temps-dinactivitat-i-desconnexio-automatica","title":"6. Temps d'inactivitat i desconnexi\u00f3 autom\u00e0tica","text":"<p>Configura un temps d'inactivitat despr\u00e9s del qual la connexi\u00f3 SSH es tancar\u00e0 autom\u00e0ticament.</p> <ul> <li>Edita el fitxer <code>/etc/ssh/sshd_config</code> i afegeix aquestes l\u00ednies:   Bash<pre><code>ClientAliveInterval 300\nClientAliveCountMax 2\n</code></pre></li> </ul>"},{"location":"hardering_ssh/#7-deshabilitar-x11-forwarding","title":"7. Deshabilitar X11 Forwarding","text":"<p>Si no necessites l'acc\u00e9s remot gr\u00e0fic, deshabilita la redirecci\u00f3 de X11.</p> <ul> <li>Busca i canvia la l\u00ednia seg\u00fcent a <code>/etc/ssh/sshd_config</code>:   Bash<pre><code>X11Forwarding yes\n</code></pre>   a:   Bash<pre><code>X11Forwarding no\n</code></pre></li> </ul>"},{"location":"hardering_ssh/#8-limitar-els-usuaris-que-poden-connectar-se","title":"8. Limitar els usuaris que poden connectar-se","text":"<p>Si vols permetre nom\u00e9s a certs usuaris que accedeixin via SSH, afegeix aquesta l\u00ednia al fitxer de configuraci\u00f3:</p> Bash<pre><code>AllowUsers usuari1 usuari2\n</code></pre>"},{"location":"hardering_ssh/#9-configuracio-de-fail2ban","title":"9. Configuraci\u00f3 de Fail2Ban","text":"<p>Installar Fail2Ban pot ajudar a bloquejar les IP que intenten for\u00e7ar l'acc\u00e9s al teu servidor SSH mitjan\u00e7ant m\u00faltiples intents fallits.</p> Bash<pre><code>sudo apt-get install fail2ban\n</code></pre> <p>Aquestes pr\u00e0ctiques de hardening ajudaran a enfortir la seguretat del teu servei SSH i evitar atacs externs.</p>"},{"location":"hardering_ssh/#activitat-practica","title":"Activitat pr\u00e0ctica","text":""},{"location":"hardering_ssh/#part-1","title":"Part 1","text":"<p>Hardering</p> <p>Aplicar les configuracions que s'han explicat en la part anterior al teu servidor ssh.</p> <ul> <li> <p>Una de les mesures de seguretat recomanades \u00e9s canviar el port d'escolta dels serveis per ports alternatius que no siguen superiors al 1024, els anomenats puertos well-known. Tria un port alternatiu; assegura't que no estiga en \u00fas en el teu sistema i que no tingues previst utilitzar-lo, i configura el teu servidor perqu\u00e8 escolte les peticions per ell.</p> </li> <li> <p>Configura openssh-server perqu\u00e8 no mantinga obertes les connexions que no han iniciat sessi\u00f3 durant m\u00e9s temps del necessari.</p> </li> <li> <p>Creus que tots els usuaris del sistema necessiten tenir acc\u00e9s via SSH al servidor? Normalment no \u00e9s aix\u00ed. Pensa en una estructura d'usuaris o grups i configura el servidor perqu\u00e8 permeta l'acc\u00e9s a l'usuari <code>ubuntu</code> i denegue l'acc\u00e9s a altres usuaris com els alumnes, que estaran dins d'un grup, per\u00f2 no als usuaris que estiguen fora del grup.</p> </li> </ul>"},{"location":"hardering_ssh/#part-2","title":"Part 2","text":"<p>Sense contrasenya</p> <p>Fins ara, sempre ens hem connectat al servidor SSH d'Ubuntu Server autenticant-nos amb usuari/contrasenya. L'autenticaci\u00f3 mitjan\u00e7ant clau p\u00fablica i clau privada dota el servidor SSH d'un plus de seguretat al nostre sistema, ja que, entre altres coses, \u00e9s m\u00e9s resistent a atacs per for\u00e7a bruta o a robatoris de contrasenyes per descuit.</p>"},{"location":"hardering_ssh/#tasques","title":"Tasques","text":"<p>Consulta els v\u00eddeos que tens m\u00e9s avall per realitzar les seg\u00fcents accions sobre una m\u00e0quina virtual de VirtualBox amb un Ubuntu Server:</p> <ol> <li>Per defecte, aquest sistema permet la connexi\u00f3 via SSH mitjan\u00e7ant els dos m\u00e8todes esmentats a la introducci\u00f3 d'aquesta pr\u00e0ctica. Realitza els passos necessaris perqu\u00e8 <code>admin01</code> es connecte al servidor utilitzant l'autenticaci\u00f3 per clau p\u00fablica. Consulta el seg\u00fcent v\u00eddeo:  </li> </ol> <p>Ubuntu Server 18.04 - Autenticaci\u00f3 SSH amb clau p\u00fablica i privada</p> <ol> <li> <p>Configura el sistema de manera que nom\u00e9s permeta la connexi\u00f3 mitjan\u00e7ant clau p\u00fablica/privada.</p> </li> <li> <p>Fes els canvis necessaris perqu\u00e8 un usuari no administrador del servidor puga connectar-se via SSH. L'usuari es dir\u00e0 igual que tu. Aquest v\u00eddeo et servir\u00e0 de guia:  </p> </li> </ol> <p>Ubuntu Server 18.04 - Autenticaci\u00f3 SSH nom\u00e9s amb clau p\u00fablica i privada</p>"},{"location":"hardering_ssh/#lliurament","title":"Lliurament","text":"<p>Puja un fitxer PDF amb les seg\u00fcents captures de pantalla:</p> <ol> <li> <p>Canvis realitzats en l'arxiu de configuraci\u00f3 del servidor SSH.</p> </li> <li> <p>Comanda que copia la clau p\u00fablica de <code>admin01</code> directament del client al servidor i la deixa preparada per al seu \u00fas. No oblides que s'ha de veure el resultat.</p> </li> <li> <p>Comanda que copia la clau p\u00fablica de l'usuari que has creat del client al servidor. No oblides que s'ha de veure el resultat.</p> </li> <li> <p>Comanda que mostra l'arxiu de claus autoritzades de l'usuari que has creat al servidor. Atenci\u00f3, no es demana que mostre el contingut, sin\u00f3 que mostre el nom de l'arxiu i els seus detalls.</p> </li> </ol>"},{"location":"honeypot/","title":"Honeypot","text":""},{"location":"honeypot/#honeypot","title":"Honeypot","text":"<p>Que \u00e9s?</p> <p>Un honeypot \u00e9s un sistema o aplicaci\u00f3 inform\u00e0tica configurada per simular vulnerabilitats i comportaments atractius per als atacants, amb l'objectiu de detectar, estudiar i aprendre dels seus intents d'intrusi\u00f3. \u00c9s com una trampa que imita un sistema real per\u00f2 que, en realitat, est\u00e0 controlat i monitoritzat per detectar possibles activitats malicioses.</p>"},{"location":"honeypot/#objectius-principals-dun-honeypot","title":"Objectius principals d'un honeypot:","text":"<ul> <li> <p>Detectar atacs: Com que els honeypots s\u00f3n configurats per semblar vulnerables, poden detectar intents d'atac que altres sistemes de seguretat, com els tallafocs, podrien passar per alt.</p> </li> <li> <p>Observar t\u00e8cniques d'atac: Un honeypot permet monitoritzar i estudiar el comportament dels atacants, com ara les eines i t\u00e8cniques que utilitzen per accedir al sistema.</p> </li> <li> <p>Distraure els atacants: Un honeypot pot actuar com a esquer, desviant l'atenci\u00f3 dels atacants cap a ell i protegint els sistemes reals mentre aquests perden temps intentant accedir al sistema fals.</p> </li> <li> <p>Millorar la seguretat: Amb la informaci\u00f3 obtinguda dels atacs, es poden millorar les defenses del sistema real ajustant les pol\u00edtiques de seguretat o tancant possibles vulnerabilitats.</p> </li> </ul>"},{"location":"honeypot/#tipus-de-honeypots","title":"Tipus de honeypots:","text":"<ul> <li> <p>Honeypots de producci\u00f3: Utilitzats en entorns reals per detectar i alertar d'atacs en curs. Sovint, aquests honeypots s'utilitzen com a sistema de detecci\u00f3 de intrusions per protegir els entorns de producci\u00f3.</p> </li> <li> <p>Honeypots d'investigaci\u00f3: S'utilitzen principalment per recollir informaci\u00f3 sobre t\u00e8cniques d'atac i comportament dels atacants. Aquests es poden utilitzar en laboratoris de seguretat per estudiar malware o altres amenaces.</p> </li> </ul>"},{"location":"honeypot/#com-funciona-un-honeypot","title":"Com funciona un honeypot:","text":"<ul> <li> <p>Simulaci\u00f3 de vulnerabilitats: El sistema actua com si tingu\u00e9s vulnerabilitats reals. Aix\u00f2 pot incloure serveis no segurs, ports oberts o configuracions poc segures que conviden als atacants a interactuar amb el sistema.</p> </li> <li> <p>Monitoritzaci\u00f3 i registres: Els honeypots estan dissenyats per monitoritzar i enregistrar cada acci\u00f3 que realitza un possible atacant. Aquesta informaci\u00f3 es pot utilitzar per entendre millor com operen i quines t\u00e8cniques utilitzen per explotar sistemes.</p> </li> <li> <p>No interfereix en sistemes reals: Com que un honeypot no s'utilitza per a finalitats productives reals, qualsevol interacci\u00f3 amb ell es pot considerar sospitosa i s'ha de tractar com un intent d'intrusi\u00f3.</p> </li> </ul> <p></p>"},{"location":"honeypot/#avantatges-dun-honeypot","title":"Avantatges d'un honeypot:","text":"<ul> <li>Alta precisi\u00f3: Qualsevol acci\u00f3 en un honeypot \u00e9s probable que sigui maliciosa, reduint falsos positius.</li> <li>Recollida d'informaci\u00f3 detallada: Ofereix informaci\u00f3 detallada sobre els atacs i les t\u00e8cniques que utilitzen els atacants.</li> <li>Impacte m\u00ednim en el rendiment del sistema real: Ja que no afecta els sistemes productius.</li> </ul>"},{"location":"honeypot/#limitacions-dun-honeypot","title":"Limitacions d'un honeypot:","text":"<ul> <li>Cobertura limitada: Nom\u00e9s atrau atacs dirigits cap a ell, no protegeix directament altres parts de la xarxa.</li> <li>Exposici\u00f3: Si un atacant experimentat descobreix que est\u00e0 interactuant amb un honeypot, pot evitar-lo o intentar sabotejar-lo.</li> </ul>"},{"location":"honeypot/#practica-configuracio-dun-honeypot-en-linux","title":"Pr\u00e0ctica: Configuraci\u00f3 d'un Honeypot en Linux","text":"<p>Un honeypot \u00e9s una eina utilitzada per atraure atacants simulant un sistema vulnerable. Els administradors de sistemes poden utilitzar un honeypot per estudiar el comportament dels atacants i millorar la seguretat del sistema. Aquesta pr\u00e0ctica se centra en la configuraci\u00f3 d'un honeypot senzill en Linux utilitzant <code>Cowrie</code>, una soluci\u00f3 popular per a SSH.</p>"},{"location":"honeypot/#objectiu","title":"Objectiu:","text":"<p>Aprendre a configurar un honeypot en un sistema Linux mitjan\u00e7ant Cowrie per monitoritzar intents d'acc\u00e9s SSH no autoritzats.</p>"},{"location":"honeypot/#requisits-previs","title":"Requisits previs:","text":"<ul> <li>Un servidor Linux amb acc\u00e9s root (preferiblement una m\u00e0quina virtual o entorn de proves).</li> <li>Acc\u00e9s a internet per descarregar Cowrie i les depend\u00e8ncies.</li> </ul>"},{"location":"honeypot/#passos-per-a-la-configuracio-del-honeypot-amb-cowrie","title":"Passos per a la configuraci\u00f3 del honeypot amb Cowrie:","text":""},{"location":"honeypot/#1-installar-les-dependencies","title":"1. Instal\u00b7lar les depend\u00e8ncies","text":"<p>Abans d'instal\u00b7lar Cowrie, cal assegurar-se que tenim Python 3 i altres depend\u00e8ncies instal\u00b7lades:</p> Bash<pre><code>sudo apt update\nsudo apt install python3 python3-venv python3-dev git libssl-dev libffi-dev build-essential\n</code></pre>"},{"location":"honeypot/#2-clonar-el-repositori-de-cowrie","title":"2. Clonar el repositori de Cowrie","text":"<p>Clonarem el repositori de Cowrie des de GitHub a la nostra m\u00e0quina:</p> Bash<pre><code>cd /opt\nsudo git clone https://github.com/cowrie/cowrie.git\ncd cowrie\n</code></pre>"},{"location":"honeypot/#3-configurar-lentorn-virtual-de-python","title":"3. Configurar l'entorn virtual de Python","text":"<p>Un cop dins del directori de Cowrie, configurarem un entorn virtual de Python per mantenir les depend\u00e8ncies a\u00efllades:</p> Bash<pre><code>sudo python3 -m venv cowrie-env\nsource cowrie-env/bin/activate\n</code></pre>"},{"location":"honeypot/#4-installar-les-dependencies-de-cowrie","title":"4. Instal\u00b7lar les depend\u00e8ncies de Cowrie","text":"<p>Amb l'entorn virtual activat, instal\u00b7larem les depend\u00e8ncies de Cowrie utilitzant <code>pip</code>:</p> Bash<pre><code>pip install --upgrade pip\npip install -r requirements.txt\n</code></pre>"},{"location":"honeypot/#5-configurar-cowrie","title":"5. Configurar Cowrie","text":"<p>Cowrie ve amb un fitxer de configuraci\u00f3 d'exemple que hem de copiar i ajustar si cal:</p> Bash<pre><code>cd etc\ncp cowrie.cfg.dist cowrie.cfg\n</code></pre> <p>Pots editar el fitxer <code>cowrie.cfg</code> amb un editor de text com <code>nano</code> si vols ajustar opcions, com ara el port SSH fals o altres par\u00e0metres. Per defecte, Cowrie escolta al port 2222 en lloc del 22, per evitar conflictes amb el servei SSH real.</p>"},{"location":"honeypot/#6-executar-cowrie","title":"6. Executar Cowrie","text":"<p>Ara, pots llan\u00e7ar Cowrie perqu\u00e8 comenci a funcionar com a honeypot:</p> Bash<pre><code>cd /opt/cowrie\nbin/cowrie start\n</code></pre> <p>Per veure els logs en temps real i seguir l'activitat, pots utilitzar:</p> Bash<pre><code>tail -f log/cowrie.log\n</code></pre>"},{"location":"honeypot/#7-redirigir-el-port-ssh-real-al-port-del-honeypot","title":"7. Redirigir el port SSH real al port del honeypot","text":"<p>Per assegurar-te que els atacants es connectin al honeypot, pots redirigir el tr\u00e0fic del port SSH real (22) al port 2222 on Cowrie est\u00e0 escoltant. Aix\u00f2 ho pots fer amb <code>iptables</code>:</p> Bash<pre><code>sudo iptables -t nat -A PREROUTING -p tcp --dport 22 -j REDIRECT --to-port 2222\n</code></pre> <p>Aix\u00f2 far\u00e0 que qualsevol intent d'acc\u00e9s al port 22 es redirigeixi autom\u00e0ticament al honeypot.</p>"},{"location":"instalar_gns3_primer_escenari/","title":"Instal\u00b7laci\u00f3 de GNS3","text":""},{"location":"instalar_gns3_primer_escenari/#1-installation-from-packages","title":"1. Installation from Packages","text":""},{"location":"instalar_gns3_primer_escenari/#11-ubuntu-based-distributions-64-bit-only","title":"1.1 Ubuntu-based distributions (64-bit only)","text":"<p>These instructions are for Ubuntu and all distributions based on it (like Linux Mint).</p> Bash<pre><code>sudo add-apt-repository ppa:gns3/ppa\nsudo apt update                              \nsudo apt install gns3-gui gns3-server\n</code></pre> <p>when prompted whether non-root users should be allowed to use wireshark and ubridge, select Yes both times If you want IOU support</p> Bash<pre><code>sudo dpkg --add-architecture i386\nsudo apt update\nsudo apt install gns3-iou\n</code></pre>"},{"location":"instalar_gns3_primer_escenari/#2-to-install-docker-ce","title":"2. To install Docker CE","text":""},{"location":"instalar_gns3_primer_escenari/#21-ubuntu-version-xenial_and_newer","title":"2.1 <code>UBUNTU VERSION</code> (Xenial_and_newer)","text":"<p>Remove any old versions:</p> Bash<pre><code>sudo apt remove docker docker-engine docker.io\nsudo snap remove docker\n</code></pre> <p>Install the following packages:</p> Bash<pre><code>sudo apt-get install apt-transport-https ca-certificates curl \\ software-properties-common\n</code></pre> <p>Import the official Docker GPG key:</p> Bash<pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n</code></pre> <p>Add the appropriate repo:</p> Bash<pre><code>sudo add-apt-repository \\\n\"deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) stable\"\n</code></pre> <p>Install Docker-CE:</p> Bash<pre><code>sudo apt update\nsudo apt install docker-ce\n</code></pre>"},{"location":"instalar_gns3_primer_escenari/#22-mint___-version","title":"2.2 <code>MINT___ VERSION</code>","text":"<p>Step 1: Install Dependency packages</p> <p>Start the installation by ensuring that all the packages used by docker as dependencies are installed.</p> Bash<pre><code>sudo apt update\nsudo apt -y install apt-transport-https ca-certificates curl software-properties-common\nsudo apt -y remove docker docker-engine docker.io containerd runc\n</code></pre> <p>Step 2: Add Docker\u2019s official GPG key</p> <p>Import Docker GPG key used for signing Docker packages.</p> Bash<pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n</code></pre> <p>Step 3: Add the Docker repository</p> <p>Add Docker upstream repository to your Linux Mint 21 so you can install the latest stable release of Docker.</p> Bash<pre><code>echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu jammy stable\" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\n</code></pre> <p>The command above will add a new line to additional repositories file.</p> Bash<pre><code>cat /etc/apt/sources.list.d/docker.list\n\ndeb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu jammy stable\n</code></pre> <p>Step 4: Install Docker Engine and Compose Update the apt package index.</p> Bash<pre><code>$ sudo apt update\n</code></pre> <p>Then install the latest version of Docker CE and Docker Compose</p> Bash<pre><code>sudo apt update\nsudo apt install docker-ce docker-ce-cli containerd.io docker-compose-plugin\n</code></pre> <p>Check the versi### 3.3 Navegaci\u00f3on of docker installed</p> Bash<pre><code>docker version\n</code></pre> Note <p>docker version</p> <p>Client: Docker Engine - Community Version:           20.10.19 API version:       1.41 Go version:        go1.18.7 Git commit:        d85ef84 Built:             Thu Oct 13 16:46:58 2022 OS/Arch:           linux/amd64 Context:           default Experimental:      true</p> <p>Server: Docker Engine - Community Engine: Version:          20.10.19 API version:      1.41 (minimum version 1.12) Go version:       go1.18.7 Git commit:       c964641 Built:            Thu Oct 13 16:44:47 2022 OS/Arch:          linux/amd64 Experimental:     false containerd: Version:          1.6.8 GitCommit:        9cd3357b7fd7218e4aec3eae239db1f68a5a6ec6 runc: Version:          1.1.4 GitCommit:        v1.1.4-0-g5fd4c4d docker-init: Version:          0.19.0 GitCommit:        de40ad0</p> <p>Finally, add your user to the following groups:<code>ubridge libvirt kvm wireshark docker</code></p> <p>Opcion 1</p> Bash<pre><code>sudo usermod -aG ubridge,libvirt,kvm,wireshark,docker $(whoami)\n</code></pre> <p>Opcion 2</p> Bash<pre><code>sudo usermod -aG ubridge,libvirt,kvm,wireshark,docker $USER\n</code></pre> <p>Restart your user session by logging out and back in, or restarting the system.</p>"},{"location":"instalar_gns3_primer_escenari/#3-us-basic-de-gns3","title":"3. \u00das b\u00e0sic de GNS3","text":""},{"location":"instalar_gns3_primer_escenari/#31-configuracio-inicial","title":"3.1 Configuraci\u00f3 inicial","text":"<p>GNS3 disposa d'una pantalla general de prefer\u00e8ncies on podem triar les consoles en mode text que utilitza mitjan\u00e7ant telnet i altres per a les interficies gr\u00e0fiques, a les quals es connectar\u00e0 per vnc.</p> <p></p> <p>Ac\u00ed teniu una llista de les ferramentes que haureu d'instal\u00b7lar al vostre sistema operatiu per a poder utilitzar les diferents consoles. </p>"},{"location":"instalar_gns3_primer_escenari/#32-prova-basica-de-xarxa","title":"3.2 Prova b\u00e0sica de xarxa","text":"<p><code>GNS3</code> disposa de dues formes de connexi\u00f3 a la xarxa, amb <code>cloud</code> i amb <code>NAT</code>. <code>Cloud</code> \u00e9s semblant al mode bridge del virtualbox i realitza la connexi\u00f3 mitjan\u00e7ant la targeta f\u00edsica de l'ordinador. Per contra el <code>NAT</code> realitza la connexi\u00f3 a trav\u00e9s d'una interficie virtual que es crea a l'ordinador anomenada vibr0, i \u00e9s semblant al mode NAT del virtualBox. L'adre\u00e7a en la qual es treballa per defecte \u00e9s 192.168.122.0/24.</p> <p></p> <p>Si treballes amb <code>Linux</code> has de tindre en compte que no funciona el <code>cloud</code> sobre la targeta <code>wifi</code> i si vols treballar d'eixa forma haur\u00e0s de fer-ho amb cable. L'alternativa \u00e9s utilitzar el <code>NAT</code>.</p> <p>Anem a provar la connexi\u00f3 b\u00e0sica amb un <code>VPC</code> que no \u00e9s m\u00e9s que un <code>PC virtual</code> que ens proporciona una consola. Suposa un avantatge respecte a <code>Virtual Box</code> o <code>VM Ware</code> ja que no haurem de tindre una m\u00e0quina diferent per a fer de clients.</p> <p></p> <p>Per tal de comprovar la IP que ens ha donat obrim la consola del VPC...</p> Bash<pre><code>PC1&gt; ip dhcp\nDDORA IP 192.168.122.206/24 GW 192.168.122.1\n</code></pre> <p>Podem fer <code>ping</code> des del nostre PC amfitri\u00f3...</p> Ping des de l'amfitri\u00f3 <p>xus@tourmalet:~$ ping 192.168.122.206</p> <p>PING 192.168.122.206 (192.168.122.206) 56(84) bytes of data. 64 bytes from 192.168.122.206: icmp_seq=1 ttl=64 time=0.348 ms 64 bytes from 192.168.122.206: icmp_seq=2 ttl=64 time=0.778 ms 64 bytes from 192.168.122.206: icmp_seq=3 ttl=64 time=0.787 ms</p> <p>--- 192.168.122.206 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2046ms rtt min/avg/max/mdev = 0.348/0.637/0.787/0.204 ms</p>"},{"location":"instalar_gns3_primer_escenari/#33-importar-un-appliance","title":"3.3 Importar un appliance","text":"<p>Prova a importar un appliance seguint aquest tutorial.</p>"},{"location":"manual_iptables/","title":"Manual iptables","text":""},{"location":"manual_iptables/#iptables-un-manual-sencillo","title":"iptables, un manual sencillo","text":"<p>Firewall</p> <p>Un cortafuegos (firewall) es un dispositivo hardware o software que tiene como objetivo proteger una red de otras redes a las que est\u00e1 conectado. El cortafuegos se configura con una serie de reglas que determinan el tr\u00e1fico que puede pasar de una red a otra y el tr\u00e1fico que debe ser bloqueado. </p> <p>Para comprender el funcionamiento de un cortafuegos, podemos pensar en c\u00f3mo desempe\u00f1an su trabajo los guardias de seguridad de una discoteca. Los due\u00f1os del local establecen los criterios que debe cumplir un potencial cliente para poder pasar a la sala y, cada vez que alguien llega a la puerta, el portero lo eval\u00faa:</p> <ul> <li>si cumple los criterios \u2192 pasa</li> <li>si no los cumple \u2192 no pasa</li> </ul> <p>En la siguiente figura se representa el esquema de una red de ordenadores que utiliza un cortafuegos para proteger la red local de la red externa:</p> <p></p> <p>Se pueden construir cortafuegos m\u00e1s sofisticados, como veremos a lo largo del art\u00edculo, que incluyen equipos separados del resto de la red local (DMZ: Zona Desmilitarizada) para aumentar a\u00fan m\u00e1s la seguridad. De hecho, en las grandes corporaciones, es posible encontrar instalaciones con m\u00e1s de un cortafuegos, que separan los equipos de diferentes \u00e1reas de la empresa.</p>"},{"location":"manual_iptables/#linux-como-cortafuegos","title":"Linux como cortafuegos","text":"<p>El n\u00facleo de las m\u00e1quinas GNU/Linux incorpora el framework Netfilter, que permite interceptar y manipular paquetes de red. Adem\u00e1s, en el espacio de usuario, el administrador puede usar iptables para establecer las reglas del firewall.</p>"},{"location":"manual_iptables/#iptables","title":"iptables","text":"<p>iptables se usa para crear, mantener y revisar las tablas de filtrado de paquetes en el kernel de Linux, y se estructura de la siguiente manera:</p> <ul> <li>Existen diferentes tablas (tables) dentro de las cuales puede haber varias cadenas (chains).</li> <li>Cada cadena consiste en una lista de reglas con las que se comparan los paquetes que pasan por el cortafuegos. Las reglas especifican qu\u00e9 se hace con los paquetes que se ajustan a ellas (target).</li> </ul> <p>Para cada paquete que recibe el cortafuegos, se examina la primera regla de la cadena correspondiente. Si el paquete no se ajusta a esa regla, se contin\u00faa examinando la siguiente hasta que se ajusta con alguna. En ese momento se ejecuta el target:</p> <ul> <li>DROP: el paquete se descarta, no puede pasar</li> <li>ACCEPT: el paquete contin\u00faa su camino normal</li> </ul> <p>Si se llega al final de una cadena predefinida se ejecuta un target por defecto, llamado chain policy. El chain policy establece, por tanto, la pol\u00edtica por defecto de nuestro cortafuegos.</p>"},{"location":"manual_iptables/#tablas","title":"Tablas","text":"<p>Como dec\u00edamos, en iptables existen varias tablas, que tienen diferentes objetivos:</p> <ul> <li> <p>La tabla filter es la tabla por defecto, y se utiliza para especificar filtros de paquetes. Contiene 3 chains predefinidas:</p> </li> <li> <p>INPUT: Se consulta para los paquetes que van dirigidos al propio cortafuegos</p> </li> <li>FORWARD: La atraviesan los paquetes enrutados a trav\u00e9s de esta m\u00e1quina, es decir, aquellos paquetes en los que el origen y el destino son equipos de redes diferentes.</li> <li>OUTPUT: Para paquetes generados localmente</li> <li>La tabla nat se consulta cada vez que se ve un paquete que inicia una nueva conexi\u00f3n, con el objetivo de alterar alg\u00fan par\u00e1metro de esa conexi\u00f3n. Tiene 3 chains predefinidas:</li> <li>PREROUTING: se consulta con los paquetes que entran en la m\u00e1quina cortafuegos, tan pronto como llegan, antes de decidir qu\u00e9 hacer con ellos.</li> <li>OUTPUT: se utiliza para alterar paquetes generados localmente, antes de enrutarlos.</li> <li>POSTROUTING: para alterar los paquetes que est\u00e1n a punto de salir de la m\u00e1quina.</li> <li>La tabla mangle es una tabla especial, destinada a alterar determinados par\u00e1metros de los paquetes (TOS, TTL \u2026), que se utiliza para realizar configuraciones complejas del cortafuegos. Cuenta con 5 chains predefinidas: INPUT, OUTPUT, PREROUNTING, POSTROUTING Y FORWARD.</li> </ul>"},{"location":"manual_iptables/#flujo-de-los-paquetes-a-traves-de-iptables","title":"Flujo de los paquetes a trav\u00e9s de iptables","text":"<p>Veamos todos los posibles caminos que un paquete puede seguir al atravesar nuestro cortafuegos.</p> <p></p> <p>Veamos el camino que seguir\u00eda, por ejemplo, un paquete que se origina en nuestra red local y va destinado a una m\u00e1quina de Internet:</p> <ul> <li>El paquete entra en el cortafuegos por una interfaz de red, por tanto, primero se comprobar\u00edan las reglas de la cadena PREROUTING.</li> <li>A continuaci\u00f3n se comprobar\u00edan las reglas de la cadena FORWARD, ya que el paquete no va destinado a un proceso del cortafuegos, si no que va a atravesarlo, saliendo por la interfaz que lo conecta con la red externa.</li> <li>Por \u00faltimo, si el paquete no ha sido filtrado y sigue adelante, antes de salir del cortafuegos por la otra interfaz de red, se comprueban las reglas de la cadena POSTROUTING</li> </ul>"},{"location":"manual_iptables/#comandos-de-configuracion","title":"Comandos de configuraci\u00f3n","text":"<p>Vamos a ir explicando, a continuaci\u00f3n, los comandos b\u00e1sicos de configuraci\u00f3n de iptables. Veremos alg\u00fan ejemplo sencillo, y terminaremos con un ejemplo completo de configuraci\u00f3n de un firewall con DMZ.</p>"},{"location":"manual_iptables/#listado-de-reglas","title":"Listado de reglas","text":"<p><code>iptables [-t tabla] [opciones] -L [chain]</code></p> <p>Muestra un listado de todas las reglas de una cadena, o de todas ellas. Las opciones disponibles son:</p> <ul> <li>-v: informaci\u00f3n detallada de una regla</li> <li>-N: crear una nueva cadena</li> <li>-X: Borrar una cadena vac\u00eda</li> </ul>"},{"location":"manual_iptables/#borrado-de-contadores","title":"Borrado de contadores","text":"<p><code>iptables [-t tabla] -Z [chain]</code></p> <p>Borra los contadores de una determinada chain, o de todas ellas. Es habitual colocar este comando al principio de todos los script de configuraci\u00f3n, para borrar las reglas que existieran de antemano. Se puede combinar con la opci\u00f3n -L para mostrar la informaci\u00f3n justo antes de borrarla.</p>"},{"location":"manual_iptables/#borrado-de-todas-las-reglas","title":"Borrado de todas las reglas","text":"<p><code>iptables [-t tabla] -F [chain]</code></p> <p>Borra las reglas de una determinada chain o de todas ellas.</p>"},{"location":"manual_iptables/#creacion-y-borrado-de-reglas","title":"Creaci\u00f3n y borrado de reglas","text":"Bash<pre><code>iptables [-t table] -A chain rule-spec\n\niptables [-t table] -I chain [rulenum] rule-spec\n\niptables [-t table] -R chain rulenum rule-spec\n\niptables [-t table] -D chain rule-spec\n\niptables [-t table] -D chain rulenum\n</code></pre> <p>Las opciones son las siguientes:</p> <ul> <li>-A: a\u00f1ade una regla al final de la lista</li> <li>-I: inserta una regla al comienzo de la lista o en el punto especificado</li> <li>-R: reemplaza una regla (especificada por su n\u00famero de regla) por otra</li> <li>-D: borra una regla determinada</li> </ul> <p>Para especificar una regla podemos usar los siguientes par\u00e1metros:</p> <ul> <li>-p [!] protocolo: el protocolo del paquete a comprobar. Puede ser \u2018tcp\u2019, \u2018udp\u2019, \u2018icmp\u2019 o \u2018all\u2019</li> <li>-[sd] [!] direcci\u00f3n[/m\u00e1scara]: direcci\u00f3n ip origen (s) o destino (d) del paquete</li> <li>-[io] [!] iface: nombre de la interfaz de entrada (i) o de salida (o) del paquete</li> <li>-j target: especifica el target de dicha regla. Puede ser una acci\u00f3n predefinida (ACCEPT, DROP), una extensi\u00f3n o el nombre de una chain</li> </ul>"},{"location":"manual_iptables/#establecimiento-de-un-politica-por-defecto","title":"Establecimiento de un pol\u00edtica por defecto","text":"<p><code>iptables [-t table] -P chain target</code></p> <p>Establece el taget que se ejecutar\u00e1 para los paquetes que no cumplan con ninguna regla de la chain especificada.</p>"},{"location":"manual_iptables/#un-ejemplo-sencillo","title":"Un ejemplo sencillo","text":"<p>Con estos comandos b\u00e1sicos de configuraci\u00f3n ya podemos resolver muchos de los problemas con los que se encuentra una empresa al exponer sus sistemas de informaci\u00f3n a Internet. Vamos a ver un ejemplo sencillo para entender c\u00f3mo se deben escribir las reglas en iptables. Observemos la figura 3, que representa una instalaci\u00f3n sencilla, con una m\u00e1quina que act\u00faa como router y cortafuegos conectando dos redes distintas.</p> <p></p> <p>Supongamos que queremos que s\u00f3lo la m\u00e1quina B pueda hablar con C, y adem\u00e1s s\u00f3lo pueda usar el protocolo TCP. Los paquetes que no cumplan estas condiciones ser\u00e1n descartados. Lo primero que tenemos que decidir es \u00bfen qu\u00e9 tabla y en qu\u00e9 cadena vamos a colocar las reglas? En este caso, queremos realizar filtrado de paquetes, por lo que est\u00e1 claro que trabajaremos con la tabla filter\u2026 pero \u00bfen la cadena INPUT, OUTPUT o FORWARD? Como los paquetes que queremos filtrar son los que van a atravesar el Firewall de una red a otra, trabajaremos con la cadena FORWARD. Los comandos que deber\u00edamos usar para conseguir estos objetivos son los siguientes:</p> Bash<pre><code>iptables -F FORWARD\n\niptables -P FORWARD DROP\n\niptables -t filter -A FORWARD -p tcp -s 192.168.1.2 -d 192.168.2.1 -j ACCEPT\n\niptables -t filter -A FORWARD -p tcp -s 192.168.2.1 -d 192.168.1.2 -j ACCEPT\n</code></pre> <ul> <li>La l\u00ednea 1 borra las reglas que pudiera haber en la cadena FORWARD de la tabla filter (que es la tabla por defecto).</li> <li>La l\u00ednea 2 establece la pol\u00edtica por defecto a DROP (denegar), por lo tanto, los paquetes que no cumplan con las reglas que especifiquemos ser\u00e1n rechazados.</li> <li>Las l\u00edneas 3 y 4 permiten el tr\u00e1fico entre las m\u00e1quinas B y C seg\u00fan las reglas especificadas en el enunciado.</li> </ul> <p></p> <p>Los aministradores no suelen sentarse delante de la m\u00e1quina que act\u00faa como cortafuegos y ejecutan los comandos uno a uno. Es m\u00e1s habitual escribir todos los comandos en un script de shell y ejecutar solamente el script. No s\u00f3lo se hace por comodidad, sino porque esta opci\u00f3n permite incluir comentarios y reutilizar el c\u00f3digo:</p> Bash<pre><code>#!/bin/bash\n\n##Script de iptables \u2013 Un ejemplo sencillo\n\n##Borramos las reglas de la chain FORWARD de la tabla filter\n\niptables -F FORWARD\n\n##Establecemos la pol\u00edtica por defecto -&gt; DROP\n\niptables -P FORWARD DROP\n\n##Aceptamos los paquetes TCP entre B y C\n\niptables -t filter -A FORWARD -p tcp -s 192.168.1.2 -d 192.168.2.1 -j ACCEPT\n\niptables -t filter -A FORWARD -p tcp -s 192.168.2.1 -d 192.168.1.2 -j ACCEPT\n</code></pre>"},{"location":"manual_iptables/#extensiones-de-las-reglas","title":"Extensiones de las reglas","text":"<p>Con las opciones vistas hasta el momento podemos controlar los par\u00e1metros m\u00e1s b\u00e1sicos de la cabecera IP del paquete. Puede ser necesario un control m\u00e1s estricto, por ello existen una serie de extensiones que permiten utilizar opciones nuevas:</p> <ul> <li>-m extensi\u00f3n: activa una extensi\u00f3n para poder especificar los par\u00e1metros del paquete.</li> </ul> <p>Veamos algunas extensiones de las reglas:</p> <ul> <li>tcp: a\u00f1ade las siguientes opciones</li> <li>--sport [!] port[:port]: especifica el puerto o rango de puertos origen</li> <li>--dport [!] port[:port]: especifica el puerto o rango de puertos destino</li> <li>[!] --syn: la regla concordar\u00e1 s\u00f3lo con los paquetes cuyo bit SYN=1 y los flags ACK y FIN valgan 0. Los datagramas con estos valores se utilizan para abrir las conexiones TCP</li> <li>udp: a\u00f1ade las siguientes opciones:</li> <li>--sport [!] port[:port]: especifica el puerto o rango de puertos origen</li> <li>--dport [!] port[:port]: especifica el puerto o rango de puertos destino</li> </ul> <p>Ejemplo: supongamos que quieres crear una regla para permitir el paso a las peticiones a un servidor web que tiene la IP 172.16.0.254.</p> <p><code>iptables -A FORWARD -p tcp -d 172.16.0.254 --dport 80 -j ACCEPT</code></p> <ul> <li>icmp: a\u00f1ade la opci\u00f3n --icmp-type tipo, que indica qu\u00e9 tipo ICMP debe tener el paquete (echo-request, echo-reply, network-unreachable\u2026)</li> <li>mac: a\u00f1ade la opci\u00f3n --mac-source [!] dir_mac, que especifica la direcci\u00f3n MAC que debe tener el paquete.</li> </ul> <p>Ejemplo: quieres permitir que se realice ping al cortafuegos desde la m\u00e1quina del administrador, que tiene IP din\u00e1mica y MAC 00:21:00:16:82:9f</p> Text Only<pre><code>`iptables -A INPUT -p icmp --icmp-type echo-request -m mac --mac-source 00:21:00:16:82:9f -j ACCEPT`\n\n`iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT`\n</code></pre> <ul> <li>state: A\u00f1ade la opci\u00f3n --state valor, que indica el estado en el que debe estar la conexi\u00f3n correspondiente a dicho paquete. Los tipos de estado principales son:</li> <li>NEW: el paquete corresponde a una conexi\u00f3n nueva</li> <li>ESTABLISHED: el paquete est\u00e1 asociado a una conexi\u00f3n ya establecida</li> <li>RELATED: el paquete corresponde a una conexi\u00f3n nueva, pero relacionada con una que ya est\u00e1 establecida (como un canal de datos FTP o un error de ICMP)</li> <li>multiport: Nos permite indicar con las opciones --sports y --dports varios puertos.</li> </ul>"},{"location":"manual_iptables/#extensiones-de-target","title":"Extensiones de target","text":"<p>Existen otros target diferentes a DROP y ACCEPT que permiten que nuestro cortafuegos realice otras funciones a parte del filtrado de paquetes:</p> <ul> <li>MASQUERADE: s\u00f3lo es v\u00e1lida en la chain POSTROUTING. Indica que la direcci\u00f3n origen del paquete (y de todos los de esa conexi\u00f3n) ser\u00e1 cambiada por la IP local de esta m\u00e1quina. Muy \u00fatil para IP din\u00e1mica (es lo que se conoce como NAT)</li> </ul> <p>Ejemplo:</p> Text Only<pre><code>`iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE`\n</code></pre> <ul> <li>SNAT: s\u00f3lo es v\u00e1lida en la chain POSTROUTING. Indica que la direcci\u00f3n y puerto origen del paquete (y de todos los de esa conexi\u00f3n) sea modificada seg\u00fan se especifica con la opci\u00f3n --to-source. El target ser\u00e1 SNAT (en lugar de MASQUERADE) cuando tengamos una IP fija.</li> </ul> <p>Ejemplo:</p> Text Only<pre><code>`iptables -t nat -A POSTROUTING -o eth1 -j SNAT --to-source 189.29.35.15`\n</code></pre> <ul> <li>DNAT: s\u00f3lo es v\u00e1lida en las chains PREROUTING y OUTPUT. Cambia la direcci\u00f3n IP destino (y de todos los futuros de esta misma conexi\u00f3n) por el especificado con la opci\u00f3n --to-destination. Es lo que se conoce como \u2018abrir el puerto\u2019 en el router.</li> </ul> <p>Por ejemplo, si la m\u00e1quina 192.168.1.2 de nuestra red local aloja un servidor web que queremos que sea accesible desde la red externa:</p> Text Only<pre><code>`iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.2:80`\n</code></pre>"},{"location":"manual_iptables/#dmz-zona-desmilitarizada","title":"DMZ, zona desmilitarizada","text":"<p>Observa la figura siguiente, que representa una red en la que tenemos un servidor web p\u00fablico, al que vamos a permitir el acceso desde Internet, y un servidor de BBDD privado, con toda la informaci\u00f3n de nuestra empresa.</p> <p></p> <p>\u00bfQu\u00e9 ocurrir\u00eda si un atacante consigue comprometer la seguridad de nuestro servidor web? A partir de ese momento, el acceso a los recursos de la red local ser\u00eda inmediato, ya que ambos servidores se encuentran en la misma red.</p> <p>En estos casos, el uso de una DMZ permite que se puedan dar servicios a la red externa a la vez que se protege la red interna en el caso de que un intruso comprometa la seguridad de los equipos situados en la zona desmilitarizada:</p> <p></p>"},{"location":"manual_iptables/#un-ejemplo-completo","title":"Un ejemplo completo","text":"<p>Observemos la imagen, que representa la configuraci\u00f3n de la red de nuestra empresa:</p> <p></p> <p>En el ejemplo supondremos que nuestra m\u00e1quina GNU/Linux est\u00e1 conectada a un ROUTER que nos proporciona el acceso a Internet por la interfaz eth2. Este router est\u00e1 configurado como monopuesto (no hace NAT y deja pasar todo el tr\u00e1fico a nuestra m\u00e1quina Linux).</p> <p>Las direcciones de la m\u00e1quina son las siguientes:</p> <ul> <li>eth0: 192.168.1.1/24</li> <li>eth1: 192.168.2.1/24</li> <li>eth2: direcci\u00f3n IP obtenida por DHCP (din\u00e1mica)</li> </ul> <p>En la DMZ tenemos un servidor WEB y un servidor SSH que queremos sean accesibles desde Internet y la red local. Las direcciones son:</p> <ul> <li>Servidor WEB: 192.168.2.2/24</li> <li>Servidor FTP: 192.168.2.3/24</li> </ul> <p>Las m\u00e1quinas de la red local podr\u00e1n navegar por Internet accediendo a servidores WEB, servidores WEB Seguros, servidores FTP y servidores DNS. El resto de conexiones ser\u00e1n filtradas.</p> <p>Todas las m\u00e1quinas de la red local tienen direcciones del rango 192.168.1.0/24.</p> <p>Supondremos que en el firewall hay instalado un servidor ssh para que el administrador pueda conectarse desde la red local.</p> <p>Se presenta a continuaci\u00f3n un script, con una parte configurable por el usuario, para que pueda ser f\u00e1cilmente adaptado a otras instalaciones y requisitos:</p> Bash<pre><code>#!/bin/bash\n\n####################################################################   \n\n#plo de configuraci\u00f3n de un firewall con DMZ y red local           #\n\n####################################################################\n\n### SECCI\u00d3N CONFIGURABLE POR EL USUARIO ###\n\n# REDLOCAL    Direcci\u00f3n IP de la red local interna\n\n# BCASTLOCAL    Direcci\u00f3n de Broadcast de la red local\n\n# IFAZLOCAL    Nombre del interfaz de red local\n\n# CUALQUIERA    Direcci\u00f3n de red 0.0.0.0\n\n# IFAZEXT        Nombre del interfaz de red externo\n\n# WEB        Direcci\u00f3n IP del servidor WEB\n\n# FTP            Direcci\u00f3n IP del servidor FTP\n\n# REDDMZ        Direcci\u00f3n IP de la red DMZ\n\n# IFAZDMZ        Nombre del interfaz de red de la DMZ\n\n# TCPLOCAL    Lista de puertos TCP que permitimos usar en la red local\n\n# UDPLOCAL    Lista de puertos UDP que permitimos usar en la red local\n\n\nREDLOCAL = \"192.168.1.0/24\"\n\nBCASTLOCAL = \"192.168.1.255\"\n\nIFAZLOCAL = \"eth0\"\n\nCUALQUIERA = \"0/0\"\n\nIFAZEXT = \"eth2\"\n\nWEB = \"192.168.2.2\"\n\nFTP = \"192.168.2.3\"\n\nREDDMZ = \"192.168.2.0/24\"\n\nIFAZDMZ = \"eth1\"\n\nTCPLOCAL = \"www,ftp,ftp-data,https\"\n\nUDPLOCAL = \"domain\"\n\n\n`                `###IMPLEMENTACI\u00d3N###\n\n# Borramos todas las reglas que pudiera haber anteriormente, y los contadores\n\niptables -F\n\niptables -t nat -F\n\niptables -X         #borra las cadenas creadas por el usuario\n\niptables -Z\n\n# Cambiamos la pol\u00edtica por defecto en todas las cadenas de la tabla filter\n\n# Chain Policy -&gt; DROP\n\niptables -P FORWARD DROP\n\niptables -P INPUT DROP\n\niptables -P OUTPUT DROP\n\n# Permitimos que se acceda al cortafuegos por ssh\n\niptables -A INPUT -s $REDLOCAL -p tcp --dport 22 -j ACCEPT\n\niptables -A OUTPUT -d $REDLOCAL -p tcp --sport 22 -j ACCEPT\n\n##CONEXIONES TCP\n\n# Permitimos las conexiones establecidas, desde la red externa y desde la DMZ hacia la red local en los puertos permitidos\n\niptables -A FORWARD -d $REDLOCAL -p tcp  -m state --state ESTABLISHED -m multiport --sports $TCPLOCAL -j ACCEPT\n\n# Permitimos el tr\u00e1fico desde la red local hacia la red externa y hacia la DMZ en los puertos permitidos\n\niptables -A FORWARD -s $REDLOCAL -p tcp -m multiport --dports $TCPLOCAL -j ACCEPT\n\n# Permitimos el tr\u00e1fico desde la red local y desde la red externa al servidor WEB  por el puerto 80\n\niptables -A FORWARD -d $WEB -p tcp --dport 80 -j ACCEPT\n\n# Permitimos las conexiones establecidas desde el servidor WEB a la red local y a la red externa\n\niptables -A FORWARD -s $WEB -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT\n\n# Permitimos el tr\u00e1fico desde la red local y desde la red externa al servidor FTP por el puerto 20 y 21\n\niptables -A FORWARD -d $FTP -p tcp --dport 20:21 -j ACCEPT\n\n# Permitimos las conexiones establecidas desde el servidor FTP a la red local y a la red externa\n\niptables -A FORWARD -s $FTP -p tcp --sport 20:21 -m state --state ESTABLISHED -j ACCEPT\n\n# Permitimos las conexiones relacionadas desde el servidor FTP a la red local y a la red externa\n\niptables -A FORWARD -s $WEB -p tcp --sport 20:21 -m state --state RELATED -j ACCEPT\n\n##CONEXIONES UDP\n\n# Permitimos las conexiones establecidas desde la red externa hacia la red local en los puertos permitidos\n\niptables -A FORWARD -d $REDLOCAL -i $IFAZEXT -p udp  -m state --state     ESTABLISHED -m multiport --sports $UDPLOCAL -j ACCEPT\n\n# Permitimos el tr\u00e1fico desde la red local hacia la red externa  en los puertos permitidos\n\niptables -A FORWARD -s $REDLOCAL -o $IFAZEXT -p udp -m multiport --dports     $UDPLOCAL -j ACCEPT\n\n## Hacemos NAT para las m\u00e1quinas de la red local y para las m\u00e1quinas de la  DMZ\n\niptables -t nat -A POSTROUTING -o eth2 -j MASQUERADE\n\n# Si la direcci\u00f3n IP P\u00fablica fuera est\u00e1tica har\u00edamos SNAT\n\n## Hacemos DNAT para que las peticiones que recibimos de Internet lleguen a los servidores\n\niptables -t nat -A PREROUTING -i eth2 -p tcp --dport 80 -j DNAT --to-destination $WEB:80\n\niptables -t nat -A PREROUTING -i eth2 -p tcp \u2013dport 20 -j DNAT --to-destination $FTP:20\n</code></pre>"},{"location":"manual_iptables2/","title":"Manual iptables2","text":"<p>Aqu\u00ed tens la traducci\u00f3 al catal\u00e0 i el codi en format Markdown:</p> Markdown<pre><code>## **iptables, un manual senzill**\n\nUn tallafocs (firewall) \u00e9s un dispositiu de hardware o software que t\u00e9 com a objectiu protegir una xarxa d'altres xarxes a les quals est\u00e0 connectat. El tallafocs es configura amb una s\u00e8rie de regles que determinen el tr\u00e0nsit que pot passar d'una xarxa a una altra i el tr\u00e0nsit que ha de ser bloquejat. Per comprendre el funcionament d'un tallafocs, podem pensar en com realitzen la seva feina els gu\u00e0rdies de seguretat d'una discoteca. Els propietaris del local estableixen els criteris que ha de complir un client potencial per poder passar a la sala i, cada vegada que alg\u00fa arriba a la porta, el porter l'avalua:\n\n- si compleix els criteris \u2192 passa\n- si no els compleix \u2192 no passa\n\nA la seg\u00fcent figura es representa l'esquema d'una xarxa d'ordinadors que utilitza un tallafocs per protegir la xarxa local de la xarxa externa:\n\n![iptables](./img/img_iptables/iptables1.png)\n\nEs poden construir tallafocs m\u00e9s sofisticats, com veurem al llarg de l'article, que inclouen equips separats de la resta de la xarxa local (**DMZ: Zona Desmilitaritzada**) per augmentar encara m\u00e9s la seguretat. De fet, en les grans corporacions, \u00e9s possible trobar instal\u00b7lacions amb m\u00e9s d'un tallafocs, que separen els equips de diferents \u00e0rees de l'empresa.\n\n## Linux com a tallafocs\nEl nucli de les m\u00e0quines GNU/Linux incorpora el framework Netfilter, que permet interceptar i manipular paquets de xarxa. A m\u00e9s, en l'espai d'usuari, l'administrador pot usar iptables per establir les regles del tallafocs.\n\n### iptables\n\niptables s'utilitza per crear, mantenir i revisar les taules de filtratge de paquets en el nucli de Linux, i s'estructura de la seg\u00fcent manera:\n\n- Existeixen diferents taules (tables) dins de les quals pot haver-hi diverses cadenes (chains).\n- Cada cadena consisteix en una llista de regles amb les quals es comparen els paquets que passen pel tallafocs. Les regles especifiquen qu\u00e8 es fa amb els paquets que s'ajusten a elles (target).\n\nPer a cada paquet que rep el tallafocs, s'examina la primera regla de la cadena corresponent. Si el paquet no s'ajusta a aquesta regla, es continua examinant la seg\u00fcent fins que s'ajusti amb alguna. En aquell moment s'executa el target:\n\n- DROP: el paquet es descarta, no pot passar\n- ACCEPT: el paquet continua el seu cam\u00ed normal\n\nSi s'arriba al final d'una cadena predefinida s'executa un target per defecte, anomenat pol\u00edtica de cadena (chain policy). La pol\u00edtica de cadena estableix, per tant, la pol\u00edtica per defecte del nostre tallafocs.\n\n### Taules\n\nCom d\u00e8iem, en iptables existeixen diverses taules, que tenen diferents objectius:\n\n- La taula filter \u00e9s la taula per defecte, i s'utilitza per especificar filtres de paquets. Cont\u00e9 3 cadenes predefinides:\n  - INPUT: Es consulta per als paquets que van dirigits al propi tallafocs.\n  - FORWARD: La travessen els paquets enrutats a trav\u00e9s d'aquesta m\u00e0quina, \u00e9s a dir, aquells paquets en els quals l'origen i el dest\u00ed s\u00f3n equips de xarxes diferents.\n  - OUTPUT: Per a paquets generats localment.\n- La taula nat es consulta cada vegada que es veu un paquet que inicia una nova connexi\u00f3, amb l'objectiu de modificar algun par\u00e0metre d'aquella connexi\u00f3. T\u00e9 3 cadenes predefinides:\n  - PREROUTING: es consulta amb els paquets que entren a la m\u00e0quina tallafocs, tan aviat com arriben, abans de decidir qu\u00e8 fer amb ells.\n  - OUTPUT: s'utilitza per alterar paquets generats localment, abans de rutar-los.\n  - POSTROUTING: per alterar els paquets que estan a punt de sortir de la m\u00e0quina.\n- La taula mangle \u00e9s una taula especial, destinada a alterar determinats par\u00e0metres dels paquets (TOS, TTL \u2026), que s'utilitza per realitzar configuracions complexes del tallafocs. Comptar\u00e0 amb 5 cadenes predefinides: INPUT, OUTPUT, PREROUTING, POSTROUTING I FORWARD.\n\n### Fluix dels paquets a trav\u00e9s d'iptables\n\nVeiem tots els possibles camins que un paquet pot seguir al travessar el nostre tallafocs.\n\n![iptables](./img/img_iptables/iptables2.png)\n\nVeiem el cam\u00ed que seguiria, per exemple, un paquet que s'origina a la nostra xarxa local i va destinat a una m\u00e0quina d'Internet:\n\n- El paquet entra al tallafocs per una interf\u00edcie de xarxa, per tant, primer es comprovarien les regles de la cadena PREROUTING.\n- A continuaci\u00f3 es comprovarien les regles de la cadena FORWARD, ja que el paquet no va destinat a un proc\u00e9s del tallafocs, sin\u00f3 que va a travessar-lo, sortint per la interf\u00edcie que el connecta amb la xarxa externa.\n- Finalment, si el paquet no ha estat filtrat i continua endavant, abans de sortir del tallafocs per l'altra interf\u00edcie de xarxa, es comproven les regles de la cadena POSTROUTING.\n\n### Comandos de configuraci\u00f3\n\nAnem a explicar, a continuaci\u00f3, els comandos b\u00e0sics de configuraci\u00f3 d'iptables. Veurem algun exemple senzill, i acabarem amb un exemple complet de configuraci\u00f3 d'un tallafocs amb DMZ.\n\n#### Llistat de regles\n\n```bash\niptables [-t taula] [opcions] -L [cadena]\n</code></pre> <p>Mostra un llistat de totes les regles d'una cadena, o de totes elles. Les opcions disponibles s\u00f3n:</p> <ul> <li>-v: informaci\u00f3 detallada d'una regla</li> <li>-N: crear una nova cadena</li> <li>-X: Esborrar una cadena buida</li> </ul>"},{"location":"manual_iptables2/#esborrat-de-comptadors","title":"Esborrat de comptadors","text":"Bash<pre><code>iptables [-t taula] -Z [cadena]\n</code></pre> <p>Esborra els comptadors d'una determinada cadena, o de totes elles. \u00c9s habitual col\u00b7locar aquest comandament al principi de tots els scripts de configuraci\u00f3, per esborrar les regles que existien pr\u00e8viament. Es pot combinar amb l'opci\u00f3 -L per mostrar la informaci\u00f3 just abans d'esborrar-la.</p>"},{"location":"manual_iptables2/#esborrat-de-totes-les-regles","title":"Esborrat de totes les regles","text":"Bash<pre><code>iptables [-t taula] -F [cadena]\n</code></pre> <p>Esborra les regles d'una determinada cadena o de totes elles.</p>"},{"location":"manual_iptables2/#creacio-i-esborrat-de-regles","title":"Creaci\u00f3 i esborrat de regles","text":"Bash<pre><code>iptables [-t taula] -A cadena regla-especificada\niptables [-t taula] -I cadena [n\u00famero-regla] regla-especificada\niptables [-t taula] -R cadena n\u00famero-regla regla-especificada\niptables [-t taula] -D cadena regla-especificada\niptables [-t taula] -D cadena n\u00famero-regla\n</code></pre> <p>Les opcions s\u00f3n les seg\u00fcents:</p> <ul> <li>-A: afegeix una regla al final de la llista</li> <li>-I: insereix una regla al comen\u00e7ament de la llista o en el punt especificat</li> <li>-R: reempla\u00e7a una regla (especificada pel seu n\u00famero de regla) per una altra</li> <li>-D: esborra una regla determinada</li> </ul> <p>Per especificar una regla podem usar els seg\u00fcents par\u00e0metres:</p> <ul> <li>-p [!] protocol: el protocol del paquet a comprovar. Pot ser \u2018tcp\u2019, \u2018udp\u2019, \u2018icmp\u2019 o \u2018all\u2019.</li> <li>-[sd] [!] adre\u00e7a[/m\u00e0scara]: adre\u00e7a ip origen (s) o dest\u00ed (d) del paquet.</li> <li>-[io] [!] iface: nom de la interf\u00edcie d'entrada (i) o de sortida (o) del paquet.</li> <li>-j target: especifica el target d'aquesta regla. Pot ser una acci\u00f3 predefinida (ACCEPT, DROP), una extensi\u00f3 o el nom d'una cadena.</li> </ul>"},{"location":"manual_iptables2/#establiment-duna-politica-per-defecte","title":"Establiment d'una pol\u00edtica per defecte","text":"Bash<pre><code>iptables [-t taula] -P cadena target\n</code></pre> <p>Estableix el target que s'executar\u00e0 per als paquets que no compleixin cap regla de la cadena especificada.</p>"},{"location":"manual_iptables2/#un-exemple-senzill","title":"Un exemple senzill","text":"<p>Amb aquests comandaments b\u00e0sics de configuraci\u00f3 ja podem resoldre molts dels problemes amb els quals es troba una empresa al exposar els seus sistemes d'informaci\u00f3 a Internet. Anem a veure un exemple senzill per entendre com s'han d'escriure les regles en iptables. Observem la figura 3, que representa una instal\u00b7laci\u00f3 senzilla, amb una m\u00e0quina que actua com a router i tallafocs connectant dues xarxes diferents.</p> <p></p> <p>Suposem que volem que nom\u00e9s la m\u00e0quina B pugui parlar amb C, i a m\u00e9s nom\u00e9s pugui usar el protocol TCP. Els pa</p> <p>quets de la xarxa A no han d'accedir a la m\u00e0quina C, i no volem que l'usuari de B pugui accedir a la m\u00e0quina A. En aquest escenari, no volem exposar la m\u00e0quina A a Internet, aix\u00ed que definirem les seg\u00fcents regles:</p> Bash<pre><code># Esborrem totes les regles existents\niptables -F\n\n# Establim les pol\u00edtiques per defecte\niptables -P INPUT DROP\niptables -P FORWARD DROP\niptables -P OUTPUT ACCEPT\n\n# Permetem l'acc\u00e9s a la m\u00e0quina B\niptables -A FORWARD -s 192.168.1.2 -d 192.168.1.3 -p tcp -j ACCEPT\n</code></pre> <p>Amb aix\u00f2, ja tenim la m\u00e0quina B connectada amb la m\u00e0quina C. Encara podem permetre l'acc\u00e9s a la m\u00e0quina C des d'Internet, i prohibir l'acc\u00e9s a la m\u00e0quina A. Veiem com implementar-ho:</p> Bash<pre><code># Permet l'acc\u00e9s a la m\u00e0quina C\niptables -A FORWARD -s 0.0.0.0/0 -d 192.168.1.3 -p tcp -j ACCEPT\n</code></pre> <p>A partir d'aquest moment, la m\u00e0quina B pot accedir a la m\u00e0quina C, i la m\u00e0quina C est\u00e0 accessible des d'Internet. La m\u00e0quina A no pot ser accedida des de cap lloc.</p>"},{"location":"manual_iptables2/#exemple-complet-amb-dmz","title":"Exemple complet amb DMZ","text":"<p>A l'\u00faltim exemple, construirem un tallafocs que contindr\u00e0 una DMZ. La xarxa es veur\u00e0 aix\u00ed:</p> <p></p> <p>El tallafocs estar\u00e0 format per tres interf\u00edcies de xarxa:</p> <ul> <li>INTERF\u00cdCIE_EXTERNA: connecta amb Internet.</li> <li>INTERF\u00cdCIE_DMZ: connecta amb la DMZ (servidor web i servidor de correu).</li> <li>INTERF\u00cdCIE_INTERNA: connecta amb la xarxa interna de l'empresa.</li> </ul> <p>El tallafocs ha de ser capa\u00e7 de controlar les comunicacions de les xarxes internes amb la DMZ, aix\u00ed com les comunicacions de la DMZ amb Internet. Les regles seran:</p> Bash<pre><code># Esborrem les regles existents\niptables -F\n\n# Establim les pol\u00edtiques per defecte\niptables -P INPUT DROP\niptables -P FORWARD DROP\niptables -P OUTPUT ACCEPT\n\n# Permet l'acc\u00e9s a la m\u00e0quina DMZ des de la xarxa interna\niptables -A FORWARD -s 192.168.1.0/24 -d 192.168.2.0/24 -j ACCEPT\n\n# Permet l'acc\u00e9s a la xarxa interna des de la DMZ\niptables -A FORWARD -s 192.168.2.0/24 -d 192.168.1.0/24 -j ACCEPT\n\n# Permet l'acc\u00e9s a Internet des del servidor web de la DMZ\niptables -A FORWARD -s 192.168.2.2 -d 0.0.0.0/0 -j ACCEPT\n\n# Permet l'acc\u00e9s des de Internet al servidor web\niptables -A FORWARD -s 0.0.0.0/0 -d 192.168.2.2 -p tcp --dport 80 -j ACCEPT\n\n# Permet l'acc\u00e9s al servidor de correu\niptables -A FORWARD -s 0.0.0.0/0 -d 192.168.2.3 -p tcp --dport 25 -j ACCEPT\n</code></pre> <p>Amb aix\u00f2, hem aconseguit una bona configuraci\u00f3 inicial d'un tallafocs. Tot i aix\u00f2, cal tenir en compte que aquesta \u00e9s una configuraci\u00f3 b\u00e0sica, i que en una instal\u00b7laci\u00f3 real seria convenient aplicar estrat\u00e8gies de seguretat addicionals.</p> <p>Fi de l'article ``` </p> <p>Si necessites qualsevol altre canvi o afegit, fes-m'ho saber!</p>"},{"location":"manuals/","title":"Gu\u00edes i manuals","text":""},{"location":"manuals/#guies-i-manuals","title":"Gu\u00edes i manuals","text":"<p>Documentaci\u00f3</p> <p>En aquesta secci\u00f3 pots trobar diferents guies i manuals que seran \u00fatils durant tot el curs</p> <ul> <li>Descarrega el Manual de Mikrotik</li> </ul>"},{"location":"prac_the_dude/","title":"Prac the dude","text":""},{"location":"prac_the_dude/#escenari","title":"Escenari","text":""},{"location":"prac_the_dude/#escenari-amb-gns3","title":"Escenari amb GNS3","text":"<p>Has de partir d'un escenari similar al seg\u00fcent:</p> <p></p> <p>Configuraci\u00f3</p> <p>Configura el Mikrotik amb les adreces i serveis necessaris per a que puga donar <code>ips</code>per <code>dhcp</code> del rang que apareix a la figura.</p>"},{"location":"prac_the_dude/#wine","title":"Wine","text":"<p>Per a usuaris de Linux</p> <p>Has de tindre instal\u00b7lat <code>Wine</code> al teu equip si eres usuari de <code>Linux</code>.</p>"},{"location":"prac_the_dude/#client-de-the-dude","title":"Client de The Dude","text":"<p>Pots consultar aquest tutorial per a instal\u00b7lar el client.</p>"},{"location":"prac_the_dude/#servidor-the-dude","title":"Servidor The Dude","text":"<p>Pots descarregar el client i el servidor de la web de Mikrotik</p> <p>Visualitza aquest tutorial per a instal\u00b7lar el servidor.</p> <p>Versions iguals</p> <p>\u00c9s necessari que el client i el servidor siguen la mateixa versi\u00f3.</p>"},{"location":"prac_the_dude/#bot-de-telegram","title":"Bot de Telegram","text":"<p>Per a aquesta pr\u00e0ctica necessites que un ChatBot de Telegram t'envie notificacions quan un dels serveis que estem monitoritzant presenta problemes.</p> <ul> <li> <p>Consulta ac\u00ed com crerar un <code>ChatBot</code> de <code>Telegram</code>.</p> </li> <li> <p>Consulta ac\u00ed com obtindre el <code>ID</code> del teu xat amb el <code>bot</code> de Telegram.</p> </li> </ul>"},{"location":"prac_the_dude/#passos-de-la-practica","title":"Passos de la pr\u00e0ctica","text":""},{"location":"prac_the_dude/#crea-lescenari","title":"Crea l'escenari","text":"<p>Amb <code>GNS3</code> crea l'escenari descrit, instal\u00b7la a les m\u00e0quines corresponents els clients i els servidors de <code>The Dude</code> i connecta't al panell de control.</p>"},{"location":"prac_the_dude/#dispositius-i-links","title":"Dispositius i links","text":"<p>Afegix dispositius i links per a poder monitoritzar l'escenari. Ha de quedar-te d'una forma molt semblant a aquesta.</p> <p></p>"},{"location":"prac_the_dude/#crea-una-notificacio-de-telegram","title":"Crea una notificaci\u00f3 de Telegram","text":"<p>El codi per a crear la notificaci\u00f3 \u00e9s aquest:</p> Text Only<pre><code>:local CHATID \"Id_de_tu _chat\"\n:local BOTID \"Token_de_tu_bot\"\n:local mensaje \" -ejemplo- The Dude --&gt;&gt; \u00a1\u00a1EPP!! A las: [Time], Equipo:[Device.Name] [Service.ProblemDescription] ([Service.Status])\"\n:local apiUrl \"https://api.telegram.org/bot$BOTID/sendmessage\\?chat_id=$CHATID&amp;text=$mensaje\"\n/tool fetch mode=https url=\"$apiUrl\" keep-result=no\n</code></pre> <p>Crea una notificaci\u00f3 com aquesta:</p> <p></p> <p>Test de notificaci\u00f3</p> <p>Quan crees la notificaci\u00f3 pots polsar el bot\u00f3 de <code>Test</code> per a comprovar que funciona correctament.</p> <p>Assignar notificaci\u00f3</p> <p>Recorda que una vegada creada la notificaci\u00f3, la pots assignar al servei que vullgues, per\u00f2 a m\u00e9s a m\u00e9s has d'indicar que utilitze notificacions.</p>"},{"location":"prac_the_dude/#provoca-una-ruptura-en-el-servei-de-ping","title":"Provoca una ruptura en el servei de <code>ping</code>","text":"<p>Assigna la notificaci\u00f3 al servei de <code>ping</code> a l'equip 10.0.0.254 i despr\u00e9s apaga aquest equip, de manera que provoques que el <code>ping</code> falle. Si tot est\u00e0 ben configurat has de rebre un missatge al <code>Telegram</code> que t'informe de la caiguda del servei.</p> <p></p>"},{"location":"prac_the_dude/#_1","title":"Prac the dude","text":""},{"location":"practiquesBase/","title":"practiquesBase","text":""},{"location":"practiquesBase/#practica-de-configuracio-i-securitzacio-de-server-nas","title":"Pr\u00e0ctica de configuraci\u00f3 i securitzaci\u00f3 de Server NAS","text":"<p>Pots trobar una guia dels aspectes de configuraci\u00f3 essencials en aquest tutorial.</p> <p>http://somebooks.es/crea-tu-propio-nas-con-openmediavault-parte-1/</p> <p>http://somebooks.es/crea-tu-propio-nas-con-openmediavault-parte-2/</p> <p>En classe s'han vist les seg\u00fcents accions de securitzaci\u00f3.</p> <ul> <li> <p>Habilitar connexi\u00f3 d'administraci\u00f3 https</p> </li> <li> <p>Habilitar FTP segur</p> </li> <li> <p>Generar certificats del domini i per a ssh</p> </li> <li> <p>Creaci\u00f3 d'un RAID-5</p> </li> <li> <p>Habilitar serveis SMB/CIFS</p> </li> <li> <p>Creaci\u00f3 d'usuaris</p> </li> <li> <p>Habilitaci\u00f3 de quotes de disc</p> </li> </ul> <p>Crea un sistema de c\u00f2pies de seguretat automatitzat en alguna m\u00e0quina virtual o en l'ordinador anfitri\u00f3 per a que realitze les c\u00f2pies en el NAS que has creat.</p>"},{"location":"practiquesBase/#activitat-practica-xifrat-de-disc-utilitzant-bitlocker-i-luks","title":"Activitat Pr\u00e0ctica: Xifrat de Disc Utilitzant BitLocker i LUKS","text":""},{"location":"practiquesBase/#part-1-xifrat-de-disc-en-windows-amb-bitlocker","title":"Part 1: Xifrat de Disc en Windows amb BitLocker","text":""},{"location":"practiquesBase/#requisits-previs","title":"Requisits previs:","text":"<ul> <li>Windows 10 Pro, Enterprise o Education (BitLocker no est\u00e0 disponible en Windows 10 Home).</li> <li>Disc dur o unitat USB per xifrar.</li> </ul>"},{"location":"practiquesBase/#passos-a-seguir","title":"Passos a seguir:","text":"<ul> <li> <p>Accedir a BitLocker:</p> <ul> <li>Fes clic a la barra de cerca de Windows i escriu \"BitLocker\".</li> <li>Selecciona Gestiona BitLocker.</li> </ul> </li> <li> <p>Activar BitLocker en una unitat:</p> <ul> <li>Veureu una llista de totes les unitats disponibles. Cerca la unitat que vols xifrar (pot ser una partici\u00f3 de disc o una unitat USB).</li> <li>Fes clic a Activar BitLocker al costat de la unitat que vols xifrar.</li> </ul> </li> <li> <p>Selecci\u00f3 del m\u00e8tode de desbloqueig:</p> <ul> <li>Tria com vols desbloquejar la unitat xifrada. Pots utilitzar:<ul> <li>Contrasenya: BitLocker et demanar\u00e0 una contrasenya cada vegada que vulguis accedir a la unitat.</li> <li>Targeta intel\u00b7ligent: Si tens una targeta compatible.</li> </ul> </li> </ul> </li> <li> <p>Guardar la clau de recuperaci\u00f3:         - IMPORTANT: BitLocker generar\u00e0 una clau de recuperaci\u00f3 per si oblides la contrasenya o per si hi ha problemes d'acc\u00e9s. Guarda aquesta clau en un lloc segur (pots guardar-la al teu compte de Microsoft, en un arxiu, o imprimir-la).</p> </li> <li> <p>Xifrar la unitat:         - Tria si vols xifrar nom\u00e9s l'espai utilitzat o tot el disc (es recomana xifrar tot el disc).         - Pots escollir entre dos m\u00e8todes de xifrat:             - Nou mode de xifrat (per a unitats fixes en aquest dispositiu).             - Compatibilitat amb versions anteriors de Windows (si la unitat s'utilitzar\u00e0 en altres equips).         - Fes clic a Inicia el xifrat i espera que el proc\u00e9s acabi.</p> </li> <li> <p>Accedir a la unitat xifrada:</p> <ul> <li>Quan intentis accedir a la unitat, se't demanar\u00e0 la contrasenya que has configurat.</li> </ul> </li> </ul>"},{"location":"practiquesBase/#objectiu-daprenentatge","title":"Objectiu d'aprenentatge:","text":"<ul> <li>Els participants aprendran a xifrar i gestionar unitats en Windows mitjan\u00e7ant BitLocker, assegurant-se que les dades estan protegides.</li> </ul>"},{"location":"practiquesBase/#part-2-xifrat-de-disc-en-linux-amb-luks-linux-unified-key-setup","title":"Part 2: Xifrat de Disc en Linux amb LUKS (Linux Unified Key Setup)","text":""},{"location":"practiquesBase/#requisits-previs_1","title":"Requisits previs:","text":"<ul> <li>Acc\u00e9s a una distribuci\u00f3 Linux amb suport per a LUKS (pr\u00e0cticament qualsevol distribuci\u00f3 moderna).</li> <li>Eina <code>cryptsetup</code> instal\u00b7lada (normalment ve per defecte en la majoria de distribucions modernes).</li> </ul>"},{"location":"practiquesBase/#passos-a-seguir_1","title":"Passos a seguir:","text":"<ul> <li> <p>Crear una partici\u00f3 o unitat de prova:         - Crea o selecciona una partici\u00f3 del disc o unitat USB que vols xifrar.         - Exemple: Si utilitzes una unitat USB, es pot identificar com <code>/dev/sdb1</code> (verifica la teva unitat amb la comanda <code>lsblk</code>).</p> </li> <li> <p>Xifrar la partici\u00f3 amb LUKS:         - Utilitza <code>cryptsetup</code> per formatar la partici\u00f3 seleccionada amb LUKS:             Bash<pre><code>sudo cryptsetup luksFormat /dev/sdb1\n</code></pre>         - Atenci\u00f3: Aix\u00f2 esborra totes les dades existents en la partici\u00f3.</p> </li> <li> <p>Obrir la partici\u00f3 xifrada:</p> <ul> <li>Despr\u00e9s de xifrar-la, has d\u2019obrir la partici\u00f3 xifrada per accedir-hi:     Bash<pre><code>sudo cryptsetup luksOpen /dev/sdb1 nom_particio_xifrada\n</code></pre></li> <li>Et demanar\u00e0 la contrasenya que has introdu\u00eft en el pas anterior.</li> </ul> </li> <li> <p>Formatejar la partici\u00f3 xifrada:</p> <ul> <li>Ara, formatar la partici\u00f3 xifrada (en aquest exemple, amb ext4):     Bash<pre><code>sudo mkfs.ext4 /dev/mapper/nom_particio_xifrada\n</code></pre></li> </ul> </li> <li> <p>Muntar la partici\u00f3 xifrada:</p> <ul> <li>Un cop formatada, pots muntar-la per accedir-hi com una unitat normal:     Bash<pre><code>sudo mount /dev/mapper/nom_particio_xifrada /mnt\n</code></pre></li> </ul> </li> <li> <p>Desmuntar i tancar la partici\u00f3 xifrada:</p> <ul> <li>Quan acabis, desmunta la unitat i tanca la partici\u00f3 xifrada:     Bash<pre><code>sudo umount /mnt\nsudo cryptsetup luksClose nom_particio_xifrada\n</code></pre></li> </ul> </li> </ul>"},{"location":"practiquesBase/#objectiu-daprenentatge_1","title":"Objectiu d'aprenentatge:","text":"<ul> <li>Els participants aprendran a xifrar i gestionar particions en Linux utilitzant LUKS, garantint la seguretat de les dades en una partici\u00f3 o unitat.</li> </ul>"},{"location":"servidorNAS/","title":"servidorNAS","text":""},{"location":"servidorNAS/#regla-del-3-2-1","title":"Regla del 3-2-1","text":"<p>La regla 3-2-1 per les c\u00f2pies de seguretat \u00e9s una pr\u00e0ctica recomanada per protegir dades de manera fiable. Aquesta regla implica els seg\u00fcents passos:</p> <ul> <li> <p>3 c\u00f2pies de les dades: Cal tenir tres c\u00f2pies de les dades importants, aix\u00f2 inclou la c\u00f2pia original m\u00e9s dues c\u00f2pies de seguretat.</p> </li> <li> <p>2 tipus de suports diferents: Les c\u00f2pies de seguretat s'han de guardar en dos suports diferents (per exemple, un disc dur extern i un servidor al n\u00favol). Aix\u00f2 redueix el risc que un tipus de suport falli completament.</p> </li> <li> <p>1 c\u00f2pia fora de les instal\u00b7lacions: Una c\u00f2pia de les dades s'ha de guardar en un lloc f\u00edsicament separat, fora de les instal\u00b7lacions principals. Aix\u00f2 protegeix en cas de desastres f\u00edsics com incendis o robatoris.</p> </li> </ul> <p></p> <p>Avantatge</p> <p>Aquest enfocament garanteix que, fins i tot en cas de fallada d'un dispositiu o desastre local, sempre hi haur\u00e0 una c\u00f2pia segura de les dades.</p>"},{"location":"servidorNAS/#tipus-de-copies-de-seguretat","title":"Tipus de c\u00f2pies de seguretat","text":"<p>Hi ha diversos tipus de c\u00f2pies de seguretat que pots utilitzar per protegir les teves dades. Cada tipus t\u00e9 les seves avantatges i desavantatges, i la seva utilitat pot dependre dels teus requeriments espec\u00edfics. Aqu\u00ed tens alguns dels tipus m\u00e9s comuns de c\u00f2pies de seguretat:</p>"},{"location":"servidorNAS/#1-copia-de-seguretat-completa-full-backup","title":"1. C\u00f2pia de Seguretat Completa (Full Backup):","text":"<ul> <li>Descripci\u00f3: Es realitza una c\u00f2pia completa de totes les dades seleccionades.</li> <li>Avantatges: Recuperaci\u00f3 completa i r\u00e0pida de totes les dades.</li> <li>Desavantatges: Requereix m\u00e9s temps i emmagatzematge.</li> </ul>"},{"location":"servidorNAS/#2-copia-de-seguretat-incremental","title":"2. C\u00f2pia de Seguretat Incremental:","text":"<ul> <li>Descripci\u00f3: Nom\u00e9s es realitza una c\u00f2pia de les dades que han canviat des de l'\u00faltima c\u00f2pia de seguretat.</li> <li>Avantatges: Menys emmagatzematge i temps requerit per cada c\u00f2pia de seguretat.</li> <li>Desavantatges: Recuperaci\u00f3 m\u00e9s complexa, ja que dep\u00e8n de c\u00f2pies anteriors.</li> </ul>"},{"location":"servidorNAS/#3-copia-de-seguretat-diferencial","title":"3. C\u00f2pia de Seguretat Diferencial:","text":"<ul> <li>Descripci\u00f3: Es realitza una c\u00f2pia de totes les dades que han canviat des de l'\u00faltima c\u00f2pia completa.</li> <li>Avantatges: M\u00e9s f\u00e0cil de restaurar que una c\u00f2pia incremental, ja que nom\u00e9s necessites la darrera c\u00f2pia completa i l'\u00faltima diferencial.</li> <li>Desavantatges: Pot requerir m\u00e9s emmagatzematge que una c\u00f2pia incremental.</li> </ul>"},{"location":"servidorNAS/#4-copia-de-seguretat-selectiva-o-personalitzada","title":"4. C\u00f2pia de Seguretat Selectiva o Personalitzada:","text":"<ul> <li>Descripci\u00f3: Nom\u00e9s es realitza una c\u00f2pia de les carpetes o fitxers seleccionats.</li> <li>Avantatges: Menys emmagatzematge i m\u00e9s control sobre qu\u00e8 es c\u00f2pia.</li> <li>Desavantatges: Pot ser m\u00e9s labori\u00f3s gestionar qu\u00e8 s'ha de c\u00f2pia i qu\u00e8 no.</li> </ul>"},{"location":"servidorNAS/#5-copia-de-seguretat-local","title":"5. C\u00f2pia de Seguretat Local:","text":"<ul> <li>Descripci\u00f3: Les dades es c\u00f2pien en un dispositiu de emmagatzematge local com ara un disc dur extern o un servidor local.</li> <li>Avantatges: Acc\u00e9s r\u00e0pid i control total.</li> <li>Desavantatges: Vulnerable a p\u00e8rdua de dades en cas d'incendi, inundaci\u00f3 o altres desastres locals.</li> </ul>"},{"location":"servidorNAS/#6-copia-de-seguretat-en-linia-o-en-el-nuvol","title":"6. C\u00f2pia de Seguretat en L\u00ednia o en el N\u00favol:","text":"<ul> <li>Descripci\u00f3: Les dades es c\u00f2pien i emmagatzemen en un servei de n\u00favol o en l\u00ednia.</li> <li>Avantatges: Accessible des de qualsevol lloc amb connexi\u00f3 a internet i protegit contra desastres locals.</li> <li>Desavantatges: Pot ser necess\u00e0ria una connexi\u00f3 r\u00e0pida a internet, i hi pot haver costos associats amb el servei de n\u00favol.</li> </ul>"},{"location":"servidorNAS/#7-copia-de-seguretat-automatica","title":"7. C\u00f2pia de Seguretat Autom\u00e0tica:","text":"<ul> <li>Descripci\u00f3: Es programen c\u00f2pies de seguretat autom\u00e0tiques segons un calendari o triggers espec\u00edfics.</li> <li>Avantatges: Minimitza la intervenci\u00f3 humana i assegura c\u00f2pies regulars.</li> <li>Desavantatges: Pot consumir recursos del sistema durant la c\u00f2pia de seguretat programada.</li> </ul>"},{"location":"servidorNAS/#8-copia-de-seguretat-fuente-live-backup","title":"8. C\u00f2pia de Seguretat Fuente (Live Backup):","text":"<ul> <li>Descripci\u00f3: Es realitzen c\u00f2pies de seguretat cont\u00ednuament, en temps real, a mesura que es produeixen els canvis.</li> <li>Avantatges: M\u00ednima p\u00e8rdua de dades, ja que les c\u00f2pies es realitzen immediatament despr\u00e9s de cada canvi.</li> <li>Desavantatges: Pot ser m\u00e9s intensiu en termes de recursos.</li> </ul> <p>La selecci\u00f3 del tipus de c\u00f2pia de seguretat dep\u00e8n de factors com la quantitat de dades, els recursos disponibles, la freq\u00fc\u00e8ncia dels canvis i els requisits de recuperaci\u00f3. Moltes organitzacions utilitzen una combinaci\u00f3 de diversos tipus de c\u00f2pies de seguretat per garantir una protecci\u00f3 completa de les seves dades.</p>"},{"location":"servidorNAS/#esquema-de-copies","title":"Esquema de c\u00f2pies","text":"<p>L'elecci\u00f3 d'un esquema de c\u00f2pies de seguretat dep\u00e8n de diversos factors, com la quantitat de dades, la freq\u00fc\u00e8ncia dels canvis, els recursos disponibles i les necessitats espec\u00edfiques de cada usuari o organitzaci\u00f3. Aqu\u00ed tens algunes opcions d'esquemes de c\u00f2pies de seguretat i quan podrien ser m\u00e9s recomanables:</p>"},{"location":"servidorNAS/#1-copia-de-seguretat-completa-regular-full-backup","title":"1. C\u00f2pia de Seguretat Completa Regular (Full Backup):","text":"<ul> <li>Frequ\u00e8ncia: Setmanal o mensual.</li> <li>Quan \u00e9s recomanable: Per a conjunts de dades m\u00e9s petits o quan es poden permetre temps m\u00e9s llargs de c\u00f2pies de seguretat. \u00c9s \u00fatil per a la recuperaci\u00f3 r\u00e0pida de tots els fitxers en cas de p\u00e8rdua.</li> </ul>"},{"location":"servidorNAS/#2-copia-de-seguretat-incremental_1","title":"2. C\u00f2pia de Seguretat Incremental:","text":"<ul> <li>Frequ\u00e8ncia: Di\u00e0ria o fins i tot m\u00e9s freq\u00fcent.</li> <li>Quan \u00e9s recomanable: Per a conjunts de dades grans on les c\u00f2pies de seguretat completes s\u00f3n costoses en termes de temps i emmagatzematge. Es recomana quan es produeixen canvis freq\u00fcents en els fitxers.</li> </ul>"},{"location":"servidorNAS/#3-copia-de-seguretat-diferencial_1","title":"3. C\u00f2pia de Seguretat Diferencial:","text":"<ul> <li>Frequ\u00e8ncia: Di\u00e0ria o setmanal.</li> <li>Quan \u00e9s recomanable: Similar a la c\u00f2pia de seguretat incremental, per\u00f2 amb un temps de restauraci\u00f3 m\u00e9s r\u00e0pid. \u00c9s una bona opci\u00f3 quan els temps de c\u00f2pia de seguretat incrementals s\u00f3n massa llargs, per\u00f2 encara es vol accelerar la restauraci\u00f3.</li> </ul>"},{"location":"servidorNAS/#4-copia-de-seguretat-completa-incrementalsdiferencials","title":"4. C\u00f2pia de Seguretat Completa + Incrementals/Diferencials:","text":"<ul> <li>Frequ\u00e8ncia: C\u00f2pia de seguretat completa seguida de c\u00f2pies incrementals o diferencials m\u00e9s freq\u00fcents.</li> <li>Quan \u00e9s recomanable: Per combinar els avantatges de les c\u00f2pies completes amb la efici\u00e8ncia de les c\u00f2pies incrementals o diferencials. Proporciona una bona barreja de restauraci\u00f3 r\u00e0pida i efici\u00e8ncia en emmagatzematge.</li> </ul>"},{"location":"servidorNAS/#5-copies-de-seguretat-regulars-i-automatiques","title":"5. C\u00f2pies de Seguretat Regulars i Autom\u00e0tiques:","text":"<ul> <li>Frequ\u00e8ncia: Programades amb regularitat.</li> <li>Quan \u00e9s recomanable: Sempre. \u00c9s important mantenir un esquema de c\u00f2pies de seguretat regular i automatitzat per garantir que les dades estiguin sempre protegides. Aquest esquema pot utilitzar c\u00f2pies de seguretat completes, incrementals o diferencials, segons les necessitats.</li> </ul>"},{"location":"servidorNAS/#consells-addicionals","title":"Consells Addicionals:","text":"<ul> <li> <p>Rotaci\u00f3 de Mitjans: Considera utilitzar m\u00faltiples mitjans de c\u00f2pia de seguretat (discs, n\u00favols, cintes) i rotar-los regularment per evitar problemes amb mitjans deteriorats.</p> </li> <li> <p>Prova de Restauraci\u00f3: Realitza proves de restauraci\u00f3 peri\u00f2diques per garantir que les teves c\u00f2pies de seguretat siguin efectives.</p> </li> <li> <p>Monitoritzaci\u00f3 i Informes: Utilitza eines de monitoritzaci\u00f3 i informes per supervisar l'estat i l'\u00e8xit de les teves c\u00f2pies de seguretat.</p> </li> </ul> <p>La millor estrat\u00e8gia de c\u00f2pies de seguretat dependr\u00e0 del teu entorn espec\u00edfic i de les teves necessitats. \u00c9s recomanable adaptar l'esquema de c\u00f2pies de seguretat en funci\u00f3 dels canvis en les dades i de la import\u00e0ncia de la informaci\u00f3.</p>"},{"location":"servidorNAS/#servidor-nas","title":"Servidor NAS","text":"<p>NAS</p> <p>Un servidor Network Attached Storage (NAS) \u00e9s un dispositiu especialitzat que ofereix emmagatzematge centralitzat i accessibilitat a trav\u00e9s d'una xarxa local (LAN) o fins i tot a trav\u00e9s d'internet. Aquest tipus de servidor est\u00e0 dissenyat espec\u00edficament per a la gesti\u00f3 i el compartiment de dades, oferint funcions avan\u00e7ades com a emmagatzematge en xarxa, gesti\u00f3 de fitxers, control d'acc\u00e9s i serveis de servidor addicionals. </p> <p>Aqu\u00ed tens algunes de les caracter\u00edstiques i funcions principals d'un servidor NAS:</p>"},{"location":"servidorNAS/#caracteristiques-principals","title":"Caracter\u00edstiques Principals:","text":"<p>Emmagatzematge Centralitzat:    - El NAS proporciona una ubicaci\u00f3 centralitzada on es poden emmagatzemar i organitzar dades. Aix\u00f2 facilita l'acc\u00e9s i la gesti\u00f3 de fitxers per part dels usuaris de la xarxa.</p> <p>Xarxa Local (LAN) i Acc\u00e9s Remot:    - Pot ser accedit localment a trav\u00e9s de la xarxa local de l'usuari o de forma remota mitjan\u00e7ant una connexi\u00f3 a internet. Aix\u00f2 permet l'acc\u00e9s a les dades des de qualsevol lloc amb una connexi\u00f3 a la xarxa.</p> <p>Serveis de Fitxers:    - Ofereix serveis de fitxers com compartici\u00f3 de fitxers, transfer\u00e8ncia de fitxers i suport per protocols com SMB/CIFS (per a sistemes Windows), NFS (per a sistemes Unix/Linux) i AFP (per a sistemes macOS).</p> <p>Gesti\u00f3 de Discs i RAID:    - Molts servidors NAS permeten la gesti\u00f3 de m\u00faltiples discs durs, amb la possibilitat de configurar-los utilitzant diverses opcions RAID (Redundant Array of Independent Disks) per millorar la seguretat i la disponibilitat de les dades.</p> <p>Serveis Addicionals:    - Pot oferir diversos serveis addicionals com serveis de c\u00f2pia de seguretat, servidor multim\u00e8dia, servei de correu electr\u00f2nic, servidors d'aplicacions, i altres aplicacions que augmenten la funcionalitat del dispositiu.</p> <p>Control d'Acc\u00e9s i Seguretat:    - Proporciona funcions de control d'acc\u00e9s per gestionar qui pot accedir a les carpetes o fitxers espec\u00edfics. La seguretat \u00e9s una consideraci\u00f3 important amb diverses opcions de xifrat i autenticaci\u00f3.</p> <p>Gesti\u00f3 Remota:    - Molts servidors NAS ofereixen interf\u00edcies de gesti\u00f3 web que permeten als usuaris gestionar i configurar el dispositiu de forma remota.</p> <p>Consum Energ\u00e8tic Eficient:    - S\u00f3n dissenyats per ser eficients en el consum d'energia, especialment comparats amb servidors m\u00e9s grans i sistemes de c\u00f2pies de seguretat tradicionals.</p> <p>Eines de Col\u00b7laboraci\u00f3:    - Alguns models inclouen funcionalitats de col\u00b7laboraci\u00f3 com \u00e0lbums de fotos compartits, aplicacions d'edici\u00f3 de documents en l\u00ednia i altres eines col\u00b7laboratives.</p> <p>Un servidor NAS \u00e9s una soluci\u00f3 vers\u00e0til que pot ser utilitzada tant per a usuaris dom\u00e8stics com per a empreses, proporcionant un mitj\u00e0 eficient i segur d'emmagatzemar i accedir a les dades. La seva flexibilitat i escalabilitat fan que sigui una opci\u00f3 popular per a diverses necessitats d'emmagatzematge.</p> <p></p>"},{"location":"servidorNAS/#openmediavault","title":"Openmediavault","text":"<p>Openmediavault</p> <p>\u00c9s una distribuci\u00f3 de <code>Linux</code> orientada a la creaci\u00f3 de servidors NAS. Pots descarregar la iso ac\u00ed</p> <p>OpenMediaVault (OMV) \u00e9s una soluci\u00f3 de gesti\u00f3 de serveis de xarxa de codi obert basada en Linux que proporciona eines per a la creaci\u00f3 d'un servidor de xarxa amb funcionalitats com emmagatzematge en xarxa (NAS), control d'acc\u00e9s, c\u00f2pies de seguretat i altres serveis relacionats. Aquesta plataforma est\u00e0 dissenyada per ser una soluci\u00f3 lleugera i f\u00e0cil d'utilitzar, adequada per a usuaris dom\u00e8stics, petits empresaris i altres entorns similars.</p> <p>Aqu\u00ed tens algunes de les caracter\u00edstiques principals d'OpenMediaVault:</p> <ol> <li> <p>Interf\u00edcie Web Intu\u00eftiva: OMV ofereix una interf\u00edcie web f\u00e0cil d'utilitzar que permet als usuaris gestionar les seves tasques sense necessitat de con\u00e8ixer la l\u00ednia de comandes de Linux. Aquesta interf\u00edcie ofereix un panell de control amb opcions clares i accessible des de qualsevol navegador web.</p> </li> <li> <p>Gesti\u00f3 de Emmagatzematge: Proporciona eines per gestionar discs durs, crear particions, configurar RAID (Redundant Array of Independent Disks) i gestionar l'espai de magatzematge en xarxa.</p> </li> <li> <p>Serveis de Xarxa: Inclou serveis de xarxa com SMB/CIFS (per a compatibilitat amb Windows), NFS (per a compatibilitat amb Unix/Linux) i AFP (per a compatibilitat amb macOS), permetent la compartici\u00f3 de fitxers a trav\u00e9s de la xarxa.</p> </li> <li> <p>C\u00f2pies de Seguretat i Restauraci\u00f3: Ofereix funcions integrades per realitzar c\u00f2pies de seguretat programades i restaurar-les f\u00e0cilment en cas de necessitat.</p> </li> <li> <p>Control d'Acc\u00e9s: Proporciona opcions de control d'acc\u00e9s per gestionar qui t\u00e9 permisos per accedir a carpetes o fitxers espec\u00edfics.</p> </li> <li> <p>Plugins i Extensions: OMV t\u00e9 un sistema de plugins que permet als usuaris ampliar les funcionalitats del sistema amb diverses extensions. Aix\u00f2 inclou l'acc\u00e9s a serveis com Plex Media Server, Nextcloud i altres.</p> </li> <li> <p>Monitoritzaci\u00f3 del Sistema: Inclou eines per a la monitoritzaci\u00f3 del sistema, incloent informaci\u00f3 sobre l'\u00fas de la CPU, mem\u00f2ria i altres recursos.</p> </li> <li> <p>Comunitat Activa: Sota la llic\u00e8ncia de codi obert, OMV gaudeix d'una comunitat activa d'usuaris i desenvolupadors que ofereixen suport i col\u00b7laboraci\u00f3.</p> </li> </ol> <p>OpenMediaVault es presenta com una opci\u00f3 vers\u00e0til per als usuaris que busquen configurar un servidor de xarxa amb funcionalitats avan\u00e7ades sense haver de fer servir una gran quantitat de coneixements t\u00e8cnics. \u00c9s especialment \u00fatil per a la creaci\u00f3 d'un servidor NAS, per\u00f2 tamb\u00e9 pot ser utilitzat per altres finalitats relacionades amb la gesti\u00f3 de serveis de xarxa.</p>"},{"location":"servidorNAS/#programari","title":"Programari","text":"<p>Hi ha diversos programaris de c\u00f2pies de seguretat disponibles per a sistemes Windows i Linux, cadascun amb les seves caracter\u00edstiques i funcionalitats \u00faniques. Aqu\u00ed tens una llista de alguns dels principals programaris de c\u00f2pies de seguretat per a ambdues plataformes:</p>"},{"location":"servidorNAS/#windows","title":"Windows:","text":"<p>Backup and Restore (Windows 7):    - El sistema operatiu Windows 7 ofereix una funci\u00f3 de c\u00f2pies de seguretat i restauraci\u00f3 integrada que permet als usuaris realitzar c\u00f2pies de seguretat programades.</p> <p>File History (Windows 8 i 10):    - File History \u00e9s una funcionalitat integrada en Windows 8 i 10 que realitza c\u00f2pies de seguretat autom\u00e0tiques de fitxers importants. Es pot configurar per fer c\u00f2pies en un disc dur extern o a una ubicaci\u00f3 de xarxa.</p> <p>Acronis True Image:    - Acronis True Image ofereix funcions avan\u00e7ades de c\u00f2pies de seguretat, com la c\u00f2pia de seguretat de tot el sistema, la restauraci\u00f3 granular i la possibilitat de crear imatges de disc.</p> <p>EaseUS Todo Backup:    - EaseUS Todo Backup proporciona funcions de c\u00f2pia de seguretat i restauraci\u00f3 de tot el sistema, particions o fitxers individuals. Tamb\u00e9 ofereix c\u00f2pies de seguretat programades i incremental.</p> <p>Veeam Agent for Windows:    - Veeam Agent for Windows \u00e9s una soluci\u00f3 gratu\u00efta que permet fer c\u00f2pies de seguretat i restaurar tot el sistema, volums o fitxers espec\u00edfics.</p>"},{"location":"servidorNAS/#linux","title":"Linux:","text":"<p>rsync:    - <code>rsync</code> \u00e9s una eina de l\u00ednia de comandes que es pot utilitzar per sincronitzar i fer c\u00f2pies de fitxers i directoris entre sistemes. \u00c9s una eina potent i \u00e0mpliament utilitzada en entorns de Linux.</p> <p>Duplicity:    - Duplicity \u00e9s una eina de c\u00f2pies de seguretat basada en la l\u00ednia de comandes que ofereix xifrat, compressi\u00f3 i suport per diversos serveis de copia de seguretat remots com Amazon S3, SSH, i altres.</p> <p>Bacula:    - Bacula \u00e9s una soluci\u00f3 de c\u00f2pies de seguretat empresarial amb una arquitectura client-servidor. Pot gestionar c\u00f2pies de seguretat, restauracions i verificacions de fitxers.</p> <p>Amanda Backup:    - Amanda Backup, o simplement Amanda, \u00e9s una soluci\u00f3 de c\u00f2pies de seguretat lliure i d'\u00fas empresarial per a sistemes Unix i Linux.</p> <p>Restic:    - Restic \u00e9s una eina de c\u00f2pies de seguretat moderna que ofereix suport per a diverses plataformes, xifrat, deduplicaci\u00f3 i integraci\u00f3 amb diversos serveis de c\u00f2pies de seguretat en n\u00favol.</p> <p>Timeshift:    - Timeshift \u00e9s una eina espec\u00edfica per a Linux que ofereix c\u00f2pies de seguretat del sistema de fitxers, permetent als usuaris restaurar el sistema a un estat anterior.</p> <p>Es recomana seleccionar una eina que compleixi les teves necessitats espec\u00edfiques i garantir que les c\u00f2pies de seguretat es realitzin regularment per mantenir la integritat de les teves dades.</p>"},{"location":"ssh/","title":"SSH","text":""},{"location":"ssh/#tutorial-complet-sobre-ssh","title":"Tutorial complet sobre SSH","text":"<p>SSH (Secure Shell) \u00e9s un protocol criptogr\u00e0fic que permet connectar-se de manera segura a una m\u00e0quina remota per gestionar-la, executar comandes, transferir arxius, i molt m\u00e9s. \u00c9s \u00e0mpliament utilitzat pels administradors de sistemes, desenvolupadors i qualsevol persona que treballi amb servidors remots.</p>"},{"location":"ssh/#que-es-ssh","title":"Qu\u00e8 \u00e9s SSH?","text":"<p>SSH proporciona autenticaci\u00f3 i encriptaci\u00f3 per assegurar la comunicaci\u00f3 entre dos sistemes. Es pot utilitzar en sistemes Linux, macOS i Windows (utilitzant clients SSH com PuTTY o la l\u00ednia de comandes de PowerShell a Windows 10+).</p>"},{"location":"ssh/#components-de-lecosistema-ssh","title":"Components de l'ecosistema SSH:","text":"<ol> <li>Client SSH: Un programa que s'utilitza per iniciar una connexi\u00f3 SSH des d'un dispositiu local a un dispositiu remot.</li> <li>Servidor SSH: El servidor al qual ens connectem de forma remota. Per exemple, un servidor Linux.</li> <li>Port: SSH utilitza per defecte el port 22, per\u00f2 es pot configurar per a altres ports.</li> </ol>"},{"location":"ssh/#passos-per-utilitzar-ssh","title":"Passos per utilitzar SSH:","text":""},{"location":"ssh/#1-installar-ssh","title":"1. Instal\u00b7lar SSH","text":""},{"location":"ssh/#a-linux-i-macos","title":"a) Linux i macOS","text":"<p>SSH sol estar preinstal\u00b7lat en la majoria dels sistemes Linux i macOS. Pots verificar-ho executant:</p> Bash<pre><code>ssh -V\n</code></pre> <p>Si no est\u00e0 instal\u00b7lat, ho pots fer amb:</p> <p>Debian/Ubuntu: Bash<pre><code>sudo apt update\nsudo apt install openssh-client\n</code></pre></p> <p>CentOS/Fedora: Bash<pre><code>sudo yum install openssh-clients\n</code></pre></p>"},{"location":"ssh/#b-windows","title":"b) Windows","text":"<p>Windows 10 i posteriors tenen SSH preinstal\u00b7lat a PowerShell. Pots verificar-ho obrint PowerShell i executant:</p> PowerShell<pre><code>ssh\n</code></pre> <p>Si no tens SSH instal\u00b7lat, pots instal\u00b7lar el client PuTTY o utilitzar Windows Subsystem for Linux (WSL) per executar comandes Linux directament des de Windows.</p>"},{"location":"ssh/#2-connectar-se-a-un-servidor-remot","title":"2. Connectar-se a un servidor remot","text":"<p>Per connectar-te a una m\u00e0quina remota via SSH, necessites l'adre\u00e7a IP o el nom de domini del servidor i les teves credencials (nom d'usuari i contrasenya o clau SSH).</p> <p>La comanda b\u00e0sica per establir una connexi\u00f3 \u00e9s:</p> Bash<pre><code>ssh usuari@servidor\n</code></pre> <p>Per exemple, per connectar-te a un servidor amb IP <code>192.168.1.100</code> amb l'usuari <code>root</code>:</p> Bash<pre><code>ssh root@192.168.1.100\n</code></pre> <p>Si \u00e9s la primera vegada que et connectes al servidor, t'apareixer\u00e0 un av\u00eds per acceptar la clau del servidor:</p> Text Only<pre><code>The authenticity of host '192.168.1.100 (192.168.1.100)' can't be established.\nECDSA key fingerprint is SHA256:xxxx.\nAre you sure you want to continue connecting (yes/no)? \n</code></pre> <p>Escriu <code>yes</code> per continuar i, si utilitzes autenticaci\u00f3 amb contrasenya, t'apareixer\u00e0 un camp per introduir la contrasenya de l'usuari.</p>"},{"location":"ssh/#3-autenticacio-amb-clau-ssh","title":"3. Autenticaci\u00f3 amb clau SSH","text":"<p>L'\u00fas de claus SSH \u00e9s m\u00e9s segur que utilitzar contrasenyes. Les claus SSH s\u00f3n parelles de claus p\u00fablica i privada que identifiquen un usuari sense necessitat d'introduir una contrasenya.</p>"},{"location":"ssh/#a-generar-claus-ssh","title":"a) Generar claus SSH","text":"<p>Per generar una parella de claus (p\u00fablica i privada) al teu sistema local, utilitza la comanda:</p> Bash<pre><code>ssh-keygen -t rsa -b 4096\n</code></pre> <p>Aix\u00f2 et demanar\u00e0 on vols guardar la clau. Pots deixar-ho per defecte (<code>~/.ssh/id_rsa</code>) i, si vols, pots protegir la clau amb una contrasenya.</p>"},{"location":"ssh/#b-copiar-la-clau-publica-al-servidor-remot","title":"b) Copiar la clau p\u00fablica al servidor remot","text":"<p>Una vegada generada la clau, pots copiar la clau p\u00fablica al servidor remot amb la seg\u00fcent comanda:</p> Bash<pre><code>ssh-copy-id usuari@servidor\n</code></pre> <p>Aix\u00f2 permetr\u00e0 al servidor recon\u00e8ixer el teu sistema local i acceptar connexions sense que necessitis proporcionar una contrasenya.</p>"},{"location":"ssh/#4-opcions-avancades-de-ssh","title":"4. Opcions avan\u00e7ades de SSH","text":""},{"location":"ssh/#a-utilitzar-un-port-diferent","title":"a) Utilitzar un port diferent","text":"<p>Si el servidor SSH est\u00e0 configurat per escoltar en un port diferent al 22, pots especificar el port amb l'opci\u00f3 <code>-p</code>:</p> Bash<pre><code>ssh -p 2222 usuari@servidor\n</code></pre>"},{"location":"ssh/#b-reenviament-de-ports-port-forwarding","title":"b) Reenviament de ports (Port Forwarding)","text":"<p>SSH tamb\u00e9 permet reenviar ports per accedir a serveis privats a trav\u00e9s de la connexi\u00f3 SSH segura.</p> <p>Reenviament de port local:</p> <p>Si vols accedir a un servidor local en un port remot (per exemple, un servidor web a <code>localhost:8000</code> en el servidor remot), pots reenviar el port aix\u00ed:</p> Bash<pre><code>ssh -L 8080:localhost:8000 usuari@servidor\n</code></pre> <p>Despr\u00e9s d'aix\u00f2, pots accedir a <code>localhost:8080</code> en el teu navegador local, i SSH reenviar\u00e0 el tr\u00e0fic al servidor remot en el port 8000.</p>"},{"location":"ssh/#c-execucio-remota-de-comandes","title":"c) Execuci\u00f3 remota de comandes","text":"<p>Pots utilitzar SSH no nom\u00e9s per connectar-te de forma interactiva, sin\u00f3 tamb\u00e9 per executar comandes remotes sense iniciar una sessi\u00f3 completa:</p> Bash<pre><code>ssh usuari@servidor 'comanda_a_executar'\n</code></pre> <p>Per exemple:</p> Bash<pre><code>ssh root@192.168.1.100 'uptime'\n</code></pre>"},{"location":"ssh/#5-transferir-arxius-amb-scp","title":"5. Transferir arxius amb SCP","text":"<p>SSH tamb\u00e9 es pot utilitzar per transferir arxius amb SCP (Secure Copy Protocol). La sintaxi per copiar fitxers entre m\u00e0quines \u00e9s:</p> Bash<pre><code>scp fitxer_local usuari@servidor:/ruta/desti\n</code></pre> <p>Per exemple, per copiar un fitxer <code>document.txt</code> al servidor remot:</p> Bash<pre><code>scp document.txt root@192.168.1.100:/home/root\n</code></pre> <p>Pots copiar directoris recursivament utilitzant l'opci\u00f3 <code>-r</code>:</p> Bash<pre><code>scp -r carpeta_local usuari@servidor:/ruta/desti\n</code></pre>"},{"location":"ssh/#6-seguretat-en-ssh","title":"6. Seguretat en SSH","text":""},{"location":"ssh/#a-desactivar-el-login-amb-contrasenya","title":"a) Desactivar el login amb contrasenya","text":"<p>Per millorar la seguretat del teu servidor SSH, pots desactivar l'autenticaci\u00f3 amb contrasenya i permetre nom\u00e9s l'acc\u00e9s mitjan\u00e7ant claus SSH. Afegeix o modifica aquestes l\u00ednies en el fitxer <code>/etc/ssh/sshd_config</code> del servidor:</p> Bash<pre><code>PasswordAuthentication no\n</code></pre> <p>Despr\u00e9s reinicia el servei SSH:</p> Bash<pre><code>sudo systemctl restart sshd\n</code></pre>"},{"location":"ssh/#b-canviar-el-port-per-defecte","title":"b) Canviar el port per defecte","text":"<p>Canviar el port per defecte (22) pot dificultar una mica els atacs per for\u00e7a bruta. Modifica el fitxer <code>/etc/ssh/sshd_config</code> i canvia la l\u00ednia:</p> Bash<pre><code>Port 2222\n</code></pre> <p>Despr\u00e9s reinicia el servei SSH.</p>"},{"location":"ssh/#7-depuracio-de-problemes-en-ssh","title":"7. Depuraci\u00f3 de problemes en SSH","text":"<p>Per depurar una connexi\u00f3 SSH fallida, pots utilitzar el mode detallat (<code>verbose mode</code>):</p> Bash<pre><code>ssh -v usuari@servidor\n</code></pre> <p>Aix\u00f2 mostrar\u00e0 informaci\u00f3 detallada sobre la connexi\u00f3 i ajudar\u00e0 a identificar problemes.</p>"},{"location":"ssh_2fa/","title":"2FA SSH","text":"<p>Dobre factor d'autenticaci\u00f3</p> <p>Habilitar autenticaci\u00f3 de dos factors (2FA) per SSH afegeix una capa addicional de seguretat en els teus accessos al servidor. En aquesta activitat pr\u00e0ctica, implementarem Google Authenticator per a la segona fase d'autenticaci\u00f3, utilitzant un dispositiu m\u00f2bil per generar codis d'un sol \u00fas.</p>"},{"location":"ssh_2fa/#activitat-practica-habilitar-2fa-per-ssh-amb-google-authenticator","title":"Activitat pr\u00e0ctica: Habilitar 2FA per SSH amb Google Authenticator","text":""},{"location":"ssh_2fa/#objectiu","title":"Objectiu:","text":"<p>Configurar l'autenticaci\u00f3 de dos factors (2FA) en un servidor Linux amb SSH utilitzant Google Authenticator com a generador de codis.</p>"},{"location":"ssh_2fa/#requisits-previs","title":"Requisits previs:","text":"<ul> <li>Un servidor Linux amb acc\u00e9s a SSH (Ubuntu, Debian, CentOS, etc.).</li> <li>Acc\u00e9s com a superusuari (<code>root</code>) o permisos de <code>sudo</code> per fer canvis de configuraci\u00f3.</li> <li>Un dispositiu m\u00f2bil amb l'app Google Authenticator (o qualsevol app que suporti TOTP, com Authy). `</li> </ul> <p>Possibles problemes en Fedora</p> <p>Utilitzeu preferiblement Ubuntu o similar. En distros com Fedora poden apareixer problemes derivats del <code>SELinux</code> que impedeix que s'execute correctament <code>SSH</code> o <code>Google Autenthicator</code> o tamb\u00e9 problemes derivats de la sincronitzaci\u00f3 del temps que requereixen accions de configuraci\u00f3 molt costoses per a poder realitzar la pr\u00e0ctica.</p>"},{"location":"ssh_2fa/#passos-de-lactivitat","title":"Passos de l'activitat:","text":""},{"location":"ssh_2fa/#1-installacio-de-google-authenticator","title":"1. Instal\u00b7laci\u00f3 de Google Authenticator","text":""},{"location":"ssh_2fa/#ubuntudebian","title":"Ubuntu/Debian:","text":"<ol> <li>Instal\u00b7la el paquet de PAM (Pluggable Authentication Module) per a Google Authenticator:    Bash<pre><code>sudo apt-get update\nsudo apt-get install libpam-google-authenticator\n</code></pre></li> </ol>"},{"location":"ssh_2fa/#centosrhel","title":"CentOS/RHEL:","text":"<ol> <li>Instal\u00b7la el mateix paquet amb:    Bash<pre><code>sudo yum install epel-release\nsudo yum install google-authenticator\n</code></pre></li> </ol>"},{"location":"ssh_2fa/#2-configuracio-de-google-authenticator-per-usuari","title":"2. Configuraci\u00f3 de Google Authenticator per usuari","text":"<p>Cada usuari que vulgui accedir amb 2FA haur\u00e0 de configurar el seu propi autenticador.</p> <ol> <li>Comen\u00e7a per generar la clau secreta de Google Authenticator per a l'usuari (executant aquesta comanda amb cada usuari al qual vulguis habilitar el 2FA):    Bash<pre><code>google-authenticator\n</code></pre></li> </ol> <p></p> <ol> <li>L'usuari haur\u00e0 de seguir els passos seg\u00fcents:</li> <li>Es generar\u00e0 un codi QR que es pot escanejar amb l'app de Google Authenticator al m\u00f2bil.</li> <li>Tamb\u00e9 es proporcionaran codis de recuperaci\u00f3 que haur\u00e0s de guardar en un lloc segur.</li> <li>Respon a les seg\u00fcents preguntes:<ul> <li>Vols que els codis siguin d'un sol \u00fas? (respon y).</li> <li>Fixar una finestra de temps addicional? (respon n, per defecte \u00e9s suficient).</li> <li>Vols prevenir m\u00e9s d\u2019un \u00fas d\u2019un codi? (respon y, per seguretat).</li> <li>Vols habilitar el limitador de freq\u00fc\u00e8ncia? (respon y, per prevenir intents repetits).</li> </ul> </li> </ol>"},{"location":"ssh_2fa/#3-configurar-pam-per-utilitzar-2fa","title":"3. Configurar PAM per utilitzar 2FA","text":"<p>Ara has de modificar els fitxers de configuraci\u00f3 de PAM i SSH perqu\u00e8 l'autenticaci\u00f3 de dos factors funcioni correctament.</p> <ol> <li> <p>Edita el fitxer de configuraci\u00f3 PAM de SSH:    Bash<pre><code>sudo nano /etc/pam.d/sshd\n</code></pre></p> </li> <li> <p>Afegeix la seg\u00fcent l\u00ednia al principi del fitxer:    Bash<pre><code>auth required pam_google_authenticator.so\n</code></pre></p> </li> </ol> <p>Aix\u00f2 indica a PAM que utilitzi el m\u00f2dul de Google Authenticator per validar els usuaris.</p>"},{"location":"ssh_2fa/#4-configurar-ssh-per-acceptar-2fa","title":"4. Configurar SSH per acceptar 2FA","text":"<ol> <li> <p>Edita el fitxer de configuraci\u00f3 de sshd:    Bash<pre><code>sudo nano /etc/ssh/sshd_config\n</code></pre></p> </li> <li> <p>Busca les l\u00ednies seg\u00fcents i assegura't que estiguen habilitades o escriu-les:    Bash<pre><code>ChallengeResponseAuthentication yes\nPasswordAuthentication yes\nAuthenticationMethods password,publickey keyboard-interactive\n</code></pre></p> </li> <li> <p>Si est\u00e0s utilitzant l'autenticaci\u00f3 per clau p\u00fablica i vols combinar-la amb 2FA, assegura't que aquesta l\u00ednia tamb\u00e9 estigui habilitada:    Bash<pre><code>PubkeyAuthentication yes\n</code></pre></p> </li> <li> <p>Deshabilita PasswordAuthentication si nom\u00e9s vols utilitzar autenticaci\u00f3 per clau p\u00fablica + 2FA, cosa que augmenta la seguretat:    Bash<pre><code>PasswordAuthentication no\n</code></pre></p> </li> <li> <p>Guarda i tanca el fitxer.</p> </li> </ol>"},{"location":"ssh_2fa/#5-reiniciar-el-servei-ssh","title":"5. Reiniciar el servei SSH","text":"<p>Despr\u00e9s de configurar el PAM i SSH, reinicia el servei SSH perqu\u00e8 els canvis tinguin efecte:</p> Bash<pre><code>sudo systemctl restart sshd\n</code></pre>"},{"location":"ssh_2fa/#6-prova-de-connexio-amb-2fa","title":"6. Prova de connexi\u00f3 amb 2FA","text":"<p>Ara prova d'accedir al servidor per SSH des d'un altre client. Quan t'introdueixis amb el teu usuari, se't demanar\u00e0 primer la teva clau (si fas servir autenticaci\u00f3 per clau p\u00fablica) o la contrasenya (si est\u00e0 habilitada), i despr\u00e9s se't sol\u00b7licitar\u00e0 el codi de verificaci\u00f3 generat per Google Authenticator:</p> Bash<pre><code>ssh usuari@ip_del_servidor\n</code></pre> <p>Si la configuraci\u00f3 \u00e9s correcta, veur\u00e0s alguna cosa aix\u00ed:</p> Text Only<pre><code>Verification code:\n</code></pre> <p>Has d'introduir el codi generat per la teva app de Google Authenticator.</p> <p>Firewall</p> <p>Si teniu problemes per a connectar-vos per <code>SSH</code> comproveu el Firewall!!!</p> <p>Pots indicar al <code>Firewall</code> que permeta les connexions <code>SSH</code> aix\u00ed:</p> Bash<pre><code>sudo ufw allow ssh\n</code></pre>"},{"location":"ssh_cert/","title":"Acc\u00e9s remot amb certificats","text":""},{"location":"ssh_cert/#enunciat","title":"Enunciat","text":"<p>Descarrega aquest enunciat</p>"},{"location":"ssh_guard2/","title":"SSH-Guard","text":"<p>SSH-Guard</p> <p><code>SSH-Guard</code> \u00e9s una eina per a la protecci\u00f3 contra atacs de for\u00e7a bruta a serveis com SSH, ajudant a detectar i bloquejar IPs sospitoses despr\u00e9s d'un cert nombre d'intents fallits de connexi\u00f3.</p>"},{"location":"ssh_guard2/#activitat-practica-configuracio-i-us-dsshguard-per-protegir-el-servei-ssh","title":"Activitat pr\u00e0ctica: Configuraci\u00f3 i \u00fas d'SSHGuard per protegir el servei SSH","text":""},{"location":"ssh_guard2/#objectiu","title":"Objectiu:","text":"<p>Configurar SSHGuard per detectar intents d'atac de for\u00e7a bruta i bloquejar autom\u00e0ticament les adreces IP sospitoses que intentin accedir repetidament sense \u00e8xit al servei SSH.</p>"},{"location":"ssh_guard2/#requisits-previs","title":"Requisits previs:","text":"<ul> <li>Un servidor Linux amb acc\u00e9s a SSH (qualsevol distribuci\u00f3 que suporti SSHGuard, com Ubuntu, Debian, CentOS, etc.).</li> <li>Acc\u00e9s com a superusuari (<code>root</code>) o permisos de <code>sudo</code> per fer canvis de configuraci\u00f3.</li> </ul>"},{"location":"ssh_guard2/#passos-de-lactivitat","title":"Passos de l'activitat:","text":""},{"location":"ssh_guard2/#1-installacio-dsshguard","title":"1. Instal\u00b7laci\u00f3 d'SSHGuard","text":"<p>Per comen\u00e7ar, instal\u00b7la SSHGuard al teu servidor. La comanda dependr\u00e0 de la distribuci\u00f3 Linux que estiguis utilitzant:</p> <ul> <li> <p>Ubuntu/Debian:   Bash<pre><code>sudo apt-get update\nsudo apt-get install sshguard\n</code></pre></p> </li> <li> <p>CentOS/RHEL:   Bash<pre><code>sudo yum install sshguard\n</code></pre></p> </li> <li> <p>Fedora:   Bash<pre><code>sudo dnf install sshguard\n</code></pre></p> </li> </ul>"},{"location":"ssh_guard2/#2-configuracio-basica-dsshguard","title":"2. Configuraci\u00f3 b\u00e0sica d'SSHGuard","text":"<p>Despr\u00e9s de la instal\u00b7laci\u00f3, configura SSHGuard perqu\u00e8 monitoritzi el fitxer de registre d'errors de connexi\u00f3 SSH (<code>/var/log/auth.log</code> o equivalent segons la teva distribuci\u00f3).</p> <ul> <li>Ubuntu/Debian: Generalment, el registre d'autenticaci\u00f3 es troba a <code>/var/log/auth.log</code>.</li> </ul> <p>No cal modificar fitxers de configuraci\u00f3 d'SSHGuard per defecte, ja que l'eina sap on trobar els registres per defecte. No obstant aix\u00f2, si vols personalitzar la configuraci\u00f3, pots editar el fitxer de configuraci\u00f3:</p> Bash<pre><code>sudo nano /etc/sshguard/sshguard.conf\n</code></pre> <p>Dins aquest fitxer, podr\u00e0s modificar aspectes com el nombre d'intents fallits permesos abans de bloquejar una IP, o la durada del bloqueig.</p>"},{"location":"ssh_guard2/#3-integracio-amb-el-sistema-de-tallafocs-optional","title":"3. Integraci\u00f3 amb el sistema de tallafocs (optional)","text":"<p>SSHGuard funciona amb diversos tallafocs com iptables, nftables, o pf. En moltes distribucions, SSHGuard es configura autom\u00e0ticament per treballar amb iptables o nftables.</p> <p>Per verificar-ho:</p> <ul> <li>Iptables:   Bash<pre><code>sudo iptables -L\n</code></pre></li> </ul> <p>Hauries de veure una regla d'SSHGuard a la llista, que indica que l'eina bloquejar\u00e0 adreces IP malicioses.</p>"},{"location":"ssh_guard2/#4-provar-la-configuracio-de-sshguard","title":"4. Provar la configuraci\u00f3 de SSHGuard","text":"<p>Ara que tens SSHGuard instal\u00b7lat i configurat, fes una prova pr\u00e0ctica per veure com reacciona davant d'intents fallits de connexi\u00f3:</p> <ul> <li>Obre una terminal i intenta connectar-te al servidor amb un nom d'usuari o contrasenya incorrecta repetidament (uns 4-5 intents).</li> </ul> Bash<pre><code>ssh usuari_incorrecte@ip_del_servidor\n</code></pre> <p>Despr\u00e9s de diversos intents fallits, SSHGuard hauria de bloquejar la teva IP temporalment.</p>"},{"location":"ssh_guard2/#5-verificar-lactivitat-de-sshguard","title":"5. Verificar l'activitat de SSHGuard","text":"<p>Despr\u00e9s de fer els intents fallits, pots verificar si SSHGuard ha bloquejat la teva IP consultant els registres:</p> Bash<pre><code>sudo tail -f /var/log/syslog\n</code></pre> <p>Hauries de veure alguna cosa com aix\u00f2: Text Only<pre><code>sshguard[xxxx]: Blocking 192.168.x.x after 4 attempts.\n</code></pre></p> <p>Aix\u00f2 vol dir que SSHGuard ha detectat els intents d'atac i ha bloquejat l'adre\u00e7a IP sospitosa.</p>"},{"location":"ssh_guard2/#6-desbloquejar-manualment-una-ip-opcional","title":"6. Desbloquejar manualment una IP (opcional)","text":"<p>Si vols desbloquejar manualment una IP bloquejada per SSHGuard, pots fer-ho amb les seg\u00fcents comandes segons el tallafocs que facis servir:</p> <ul> <li>Iptables:   Bash<pre><code>sudo iptables -D sshguard -s 192.168.x.x -j DROP\n</code></pre></li> </ul>"},{"location":"ssh_guard2/#7-configuracio-avancada-opcional","title":"7. Configuraci\u00f3 avan\u00e7ada (opcional)","text":"<p>Si vols canviar la durada del bloqueig o ajustar els par\u00e0metres de detecci\u00f3, pots modificar-ho al fitxer de configuraci\u00f3 <code>/etc/sshguard/sshguard.conf</code>:</p> <ul> <li>Exemple: canviar la durada del bloqueig a 1 hora (3600 segons):   Bash<pre><code>BLOCK_TIME=3600\n</code></pre></li> </ul> <p>Despr\u00e9s de modificar la configuraci\u00f3, reinicia SSHGuard per aplicar els canvis:</p> Bash<pre><code>sudo systemctl restart sshguard\n</code></pre>"},{"location":"ssh_pub_priv/","title":"Ssh pub priv","text":""},{"location":"ssh_pub_priv/#introduccio","title":"Introducci\u00f3","text":"<p>Llig atentament el seg\u00fcent document on s'expliquen moltes de les possibilitats de configuraci\u00f3 del servidor OpenSSH.</p> <p>Document sobre configuraci\u00f3 de servidor OpenSSH</p> <ul> <li> <p>Una de les mesures de seguretat recomanades \u00e9s canviar el port d'escolta dels serveis per ports alternatius que no siguen superiors al 1024, els anomenats puertos well-known. Tria un port alternatiu; assegura't que no estiga en \u00fas en el teu sistema i que no tingues previst utilitzar-lo, i configura el teu servidor perqu\u00e8 escolte les peticions per ell.</p> </li> <li> <p>Configura openssh-server perqu\u00e8 no mantinga obertes les connexions que no han iniciat sessi\u00f3 durant m\u00e9s temps del necessari.</p> </li> <li> <p>Creus que tots els usuaris del sistema necessiten tenir acc\u00e9s via SSH al servidor? Normalment no \u00e9s aix\u00ed. Pensa en una estructura d'usuaris o grups i configura el servidor perqu\u00e8 permeta l'acc\u00e9s a l'usuari <code>ubuntu</code> i denegue l'acc\u00e9s a altres usuaris com els alumnes, que estaran dins d'un grup, per\u00f2 no als usuaris que estiguen fora del grup.</p> </li> </ul>"},{"location":"ssh_pub_priv/#part-2","title":"Part 2","text":"<p>Sense contrasenya</p> <p>Fins ara, sempre ens hem connectat al servidor SSH d'Ubuntu Server autenticant-nos amb usuari/contrasenya. L'autenticaci\u00f3 mitjan\u00e7ant clau p\u00fablica i clau privada dota el servidor SSH d'un plus de seguretat al nostre sistema, ja que, entre altres coses, \u00e9s m\u00e9s resistent a atacs per for\u00e7a bruta o a robatoris de contrasenyes per descuit.</p>"},{"location":"ssh_pub_priv/#tasques","title":"Tasques","text":"<p>Consulta els v\u00eddeos que tens m\u00e9s avall per realitzar les seg\u00fcents accions sobre una m\u00e0quina virtual de VirtualBox amb un Ubuntu Server:</p> <ol> <li> <p>Per defecte, aquest sistema permet la connexi\u00f3 via SSH mitjan\u00e7ant els dos m\u00e8todes esmentats a la introducci\u00f3 d'aquesta pr\u00e0ctica. Realitza els passos necessaris perqu\u00e8 <code>admin01</code> es connecte al servidor utilitzant l'autenticaci\u00f3 per clau p\u00fablica. Consulta el seg\u00fcent v\u00eddeo: Ubuntu Server 18.04 - Autenticaci\u00f3 SSH amb clau p\u00fablica i privada</p> </li> <li> <p>Configura el sistema de manera que nom\u00e9s permeta la connexi\u00f3 mitjan\u00e7ant clau p\u00fablica/privada.</p> </li> <li> <p>Fes els canvis necessaris perqu\u00e8 un usuari no administrador del servidor puga connectar-se via SSH. L'usuari es dir\u00e0 igual que tu. Aquest v\u00eddeo et servir\u00e0 de guia: Ubuntu Server 18.04 - Autenticaci\u00f3 SSH nom\u00e9s amb clau p\u00fablica i privada</p> </li> </ol>"},{"location":"ssh_pub_priv/#lliurament","title":"Lliurament","text":"<p>Puja un fitxer PDF amb les seg\u00fcents captures de pantalla:</p> <ol> <li> <p>Canvis realitzats en l'arxiu de configuraci\u00f3 del servidor SSH.</p> </li> <li> <p>Comanda que copia la clau p\u00fablica de <code>admin01</code> directament del client al servidor i la deixa preparada per al seu \u00fas. No oblides que s'ha de veure el resultat.</p> </li> <li> <p>Comanda que copia la clau p\u00fablica de l'usuari que has creat del client al servidor. No oblides que s'ha de veure el resultat.</p> </li> <li> <p>Comanda que mostra l'arxiu de claus autoritzades de l'usuari que has creat al servidor. Atenci\u00f3, no es demana que mostre el contingut, sin\u00f3 que mostre el nom de l'arxiu i els seus detalls.</p> </li> </ol>"},{"location":"sshaudit/","title":"Sshaudit","text":""},{"location":"sshaudit/#contexto","title":"Contexto","text":"<p><code>ssh-audit</code> es una herramienta programada en Python para la auditor\u00eda de la configuraci\u00f3n de clientes y servidores SSH.</p> <p>Recursos</p> <ul> <li>https://github.com/arthepsy/ssh-audit, repositorio de las versiones 1.X. Sin actualizar desde 2016.</li> <li>https://github.com/jtesta/ssh-audit, fork del repositorio de la versi\u00f3n 1.X que actualmente proporciona las versiones 2.X.</li> <li>https://www.sshaudit.com/hardening_guides.html</li> </ul>"},{"location":"sshaudit/#tareas","title":"Tareas","text":"<ul> <li> <p>Consulta la documentaci\u00f3n de ssh-audit en el fichero README.md y l\u00e9ela con detenimiento.</p> </li> <li> <p>Instala, por cualquiera de los procedimientos documentados, ssh-audit en tu equipo.</p> </li> <li> <p>Te recomendamos la instalaci\u00f3n mediante PyPI o clonando el repositorio.</p> </li> </ul> Bash<pre><code>$ git clone --depth 1 https://github.com/jtesta/ssh-audit.git\n</code></pre> <ul> <li> <p>Audita el servidor de SSH de tu m\u00e1quina servidora</p> </li> <li> <p>Ejecuta la auditor\u00eda contra la instancia de VirtualBox.</p> </li> <li> <p>Modifica la configuraci\u00f3n del servidor en de funci\u00f3n de los resultados obtenidos y de la gu\u00eda de fortificaci\u00f3n. En l\u00edneas generales, deber\u00e1s:</p> </li> </ul> <p>Hardering SSH</p> <ul> <li>Regenerar las claves RSA y ED25519.</li> <li>Borrar los grupos Diffie-Hellman peque\u00f1os.</li> <li>Habilitar las claves RSA y ED25519.</li> <li>Restringir los algoritmos de intercambio de claves, cifrado y MAC1 admitidos.</li> </ul> <ul> <li>Ejecuta de nuevo la auditor\u00eda contra tu instancia para comprobar que las modificaciones han sido satisfactorias y ya no ofrece fallos.</li> </ul>"},{"location":"sshaudit/#audita-el-cliente-de-ssh-que-estes-utilizando","title":"Audita el cliente de SSH que est\u00e9s utilizando.","text":"<ul> <li> <p>Ejecuta la auditor\u00eda contra tu cliente de SSH.</p> </li> <li> <p>Modifica la configuraci\u00f3n del cliente en de funci\u00f3n de los resultados obtenidos.</p> </li> <li> <p>Ejecuta de nuevo la auditor\u00eda contra tu cliente de SSH para comprobar que las modificaciones han sido satisfactorias y ya no ofrece fallos.</p> </li> </ul>"},{"location":"sshaudit24/","title":"SSH-Audit","text":"<p>SSH-Audit</p> <p>SSH-Audit \u00e9s una eina \u00fatil per revisar i avaluar la seguretat de la configuraci\u00f3 del servei SSH. A trav\u00e9s d'ella, pots identificar vulnerabilitats o configuracions desaconsellades, permetent-te millorar la seguretat del teu servidor SSH.</p>"},{"location":"sshaudit24/#activitat-practica-auditar-la-configuracio-ssh-amb-ssh-audit","title":"Activitat pr\u00e0ctica: Auditar la configuraci\u00f3 SSH amb ssh-audit","text":""},{"location":"sshaudit24/#objectiu","title":"Objectiu:","text":"<p>Utilitzar l'eina ssh-audit per analitzar la configuraci\u00f3 d'OpenSSH d'un servidor, identificar vulnerabilitats potencials, protocols insegurs, o configuracions millorables, i aplicar els canvis suggerits per millorar la seguretat.</p>"},{"location":"sshaudit24/#requisits-previs","title":"Requisits previs:","text":"<ul> <li>Un servidor Linux amb SSH habilitat (Ubuntu, Debian, CentOS, etc.).</li> <li>Acc\u00e9s com a superusuari (<code>root</code>) o permisos de <code>sudo</code>.</li> <li>ssh-audit instal\u00b7lat al client des del qual farem la comprovaci\u00f3.</li> </ul>"},{"location":"sshaudit24/#passos-de-lactivitat","title":"Passos de l'activitat:","text":""},{"location":"sshaudit24/#1-installacio-de-ssh-audit","title":"1. Instal\u00b7laci\u00f3 de ssh-audit","text":"<p>ssh-audit es pot instal\u00b7lar f\u00e0cilment en qualsevol sistema Linux. Tamb\u00e9 es pot utilitzar sense instal\u00b7laci\u00f3 simplement executant-lo com a fitxer de Python.</p> <ul> <li> <p>Ubuntu/Debian:   Bash<pre><code>sudo apt-get install ssh-audit\n</code></pre></p> </li> <li> <p>Alternativa amb pip (qualsevol distribuci\u00f3):   Si tens <code>pip</code> instal\u00b7lat, pots fer-ho amb:   Bash<pre><code>sudo pip install ssh-audit\n</code></pre></p> </li> </ul> <p>O pots descarregar el fitxer ssh-audit.py directament des del seu repositori oficial.</p>"},{"location":"sshaudit24/#2-comprovacio-basica-de-lssh-del-servidor","title":"2. Comprovaci\u00f3 b\u00e0sica de l'SSH del servidor","text":"<p>Un cop tinguis ssh-audit instal\u00b7lat, pots executar-lo des del teu ordinador client per auditar el servidor SSH remot.</p> <p>Executa la seg\u00fcent comanda des del terminal del client:</p> Bash<pre><code>ssh-audit ip_del_servidor\n</code></pre> <ul> <li>Exemple:   Bash<pre><code>ssh-audit 192.168.1.100\n</code></pre></li> </ul> <p>Aquesta comanda analitzar\u00e0 la configuraci\u00f3 del servidor SSH remot i proporcionar\u00e0 un informe detallat que inclour\u00e0:</p> <ul> <li>Versions del protocol SSH suportades.</li> <li>Algorismes de xifrat, autenticaci\u00f3 i intercanvi de claus.</li> <li>Aspectes obsolets o insegurs (com l'\u00fas del protocol SSH-1).</li> <li>Recomanacions per millorar la configuraci\u00f3 de seguretat.</li> </ul>"},{"location":"sshaudit24/#3-interpretar-els-resultats-de-lauditoria","title":"3. Interpretar els resultats de l'auditoria","text":"<p>Un cop finalitzada l'execuci\u00f3 de ssh-audit, obtindr\u00e0s una sortida que contindr\u00e0 informaci\u00f3 estructurada en diferents seccions. Aqu\u00ed tens alguns punts claus a observar:</p> <ul> <li> <p>Protocol: Si es detecta SSH-1, hauries de deshabilitar-lo, ja que \u00e9s considerat obsolet i insegur.</p> </li> <li> <p>Algorismes d'intercanvi de claus: Et mostrar\u00e0 si el servidor est\u00e0 utilitzant algorismes segurs com <code>curve25519-sha256</code> o <code>diffie-hellman-group-exchange-sha256</code>. Si s'estan utilitzant algorismes m\u00e9s febles com <code>diffie-hellman-group1-sha1</code>, es recomana substituir-los.</p> </li> <li> <p>Xifrats (Ciphers): Revisar si s'utilitzen ciphers segurs com <code>aes128-ctr</code>, <code>aes256-ctr</code> i evitar xifrats insegurs com <code>3des-cbc</code> o <code>arcfour</code>.</p> </li> <li> <p>Algorismes de hashing (MACs): Comprovar si el servidor utilitza algoritmes de hash segurs com <code>hmac-sha2-256</code> o <code>hmac-sha2-512</code> i evitar <code>hmac-md5</code> o <code>hmac-sha1</code>.</p> </li> <li> <p>Claus d'host: \u00c9s important assegurar-se que s'utilitzen claus segures. El format <code>ed25519</code> \u00e9s molt recomanable.</p> </li> </ul>"},{"location":"sshaudit24/#4-aplicar-els-canvis-al-servidor-segons-els-resultats","title":"4. Aplicar els canvis al servidor segons els resultats","text":"<p>Un cop interpretats els resultats de l'auditoria, pots aplicar les millores suggerides editant el fitxer de configuraci\u00f3 SSH al servidor.</p> <ul> <li>Edita el fitxer <code>/etc/ssh/sshd_config</code>:   Bash<pre><code>sudo nano /etc/ssh/sshd_config\n</code></pre></li> </ul> <p>Fes els seg\u00fcents ajustos segons el que ssh-audit et recomani:</p> <ul> <li> <p>Deshabilitar el protocol SSH-1 (si s'est\u00e0 utilitzant):   Bash<pre><code>Protocol 2\n</code></pre></p> </li> <li> <p>Actualitzar els ciphers per utilitzar els algorismes segurs:   Bash<pre><code>Ciphers aes128-ctr,aes192-ctr,aes256-ctr\n</code></pre></p> </li> <li> <p>Actualitzar els MACs per assegurar-te que utilitzes algorismes segurs:   Bash<pre><code>MACs hmac-sha2-256,hmac-sha2-512\n</code></pre></p> </li> <li> <p>Deshabilitar algorismes de clau febles i afegir suport per claus m\u00e9s segures com ed25519:   Bash<pre><code>HostKey /etc/ssh/ssh_host_ed25519_key\n</code></pre></p> </li> </ul>"},{"location":"sshaudit24/#5-reiniciar-el-servei-ssh","title":"5. Reiniciar el servei SSH","text":"<p>Despr\u00e9s de fer els canvis al fitxer de configuraci\u00f3, reinicia el servei SSH perqu\u00e8 els nous ajustos tinguin efecte:</p> Bash<pre><code>sudo systemctl restart sshd\n</code></pre>"},{"location":"sshaudit24/#6-repetir-lauditoria-per-verificar-les-millores","title":"6. Repetir l'auditoria per verificar les millores","text":"<p>Despr\u00e9s d'haver aplicat els canvis de seguretat al servidor SSH, pots executar una altra auditoria amb ssh-audit per assegurar-te que els ajustos s\u00f3n efectius i que les vulnerabilitats han estat corregides.</p> Bash<pre><code>ssh-audit ip_del_servidor\n</code></pre> <p>Si els ajustos han estat correctament aplicats, haur\u00e0s eliminat els elements insegurs que apareixien a l'auditoria inicial.</p>"},{"location":"sshaudit24/#7-prova-de-connexio","title":"7. Prova de connexi\u00f3","text":"<p>Per acabar, fes una prova de connexi\u00f3 SSH des d'un client per verificar que la configuraci\u00f3 no ha bloquejat l'acc\u00e9s correcte. Simplement utilitza la comanda SSH per accedir al servidor com ho fas normalment:</p> Bash<pre><code>ssh usuari@ip_del_servidor\n</code></pre>"},{"location":"sshfs/","title":"SSHFS - Sistema remot d'arxius","text":""},{"location":"sshfs/#sshfs","title":"SSHFS","text":"<p>SSHFS (Secure SHell FileSystem) \u00e9s un sistema de fitxers basat en FUSE (Filesystem in Userspace) que permet muntar un directori remot a trav\u00e9s de SSH i treballar amb ell com si fos part del sistema de fitxers local. Amb SSHFS, pots accedir, modificar i gestionar fitxers d'una m\u00e0quina remota sense necessitat de copiar-los al sistema local, utilitzant el protocol de Secure Shell (SSH) per garantir la seguretat.</p>"},{"location":"sshfs/#practica-muntar-un-ssh-filesystem-remot-i-accedir-des-de-maquines-clients","title":"Pr\u00e0ctica: Muntar un SSH Filesystem remot i accedir des de m\u00e0quines clients","text":"<p>Objectius </p> <ul> <li>Configurar un servidor SSH per permetre l'acc\u00e9s a fitxers de manera remota.  </li> <li>Muntar el sistema de fitxers remot en una m\u00e0quina client utilitzant SSHFS.  </li> <li>Treballar amb fitxers remots com si estigueren en un directori local.  </li> </ul>"},{"location":"sshfs/#requeriments-previs","title":"Requeriments previs","text":"<p>Servidor remot:</p> <ul> <li>Acc\u00e9s a un servidor amb SSH configurat.</li> <li>Instal\u00b7lat el paquet necessari per al servei SSH (habitualment <code>openssh-server</code>).</li> </ul> <p>Client:</p> <ul> <li>Sistema operatiu Linux/Unix.</li> <li>Paquet <code>sshfs</code> instal\u00b7lat.</li> </ul>"},{"location":"sshfs/#procediment","title":"Procediment","text":""},{"location":"sshfs/#configurar-el-servidor-remot","title":"Configurar el servidor remot","text":"<ul> <li>Assegurar-se que el servei SSH est\u00e0 actiu:</li> </ul> <p>Instal\u00b7lar el servidor SSH si no est\u00e0 disponible:</p> Bash<pre><code>sudo apt update\nsudo apt install openssh-server\n</code></pre> <p>Activar i assegurar-se que el servei est\u00e0 funcionant:</p> Bash<pre><code>sudo systemctl enable ssh\nsudo systemctl start ssh\nsudo systemctl status ssh\n</code></pre> <ul> <li>Crear un usuari per a acc\u00e9s remot:</li> </ul> Bash<pre><code>sudo adduser usuari_remot\n</code></pre> <ul> <li>Configurar permisos i seguretat (opcional):</li> </ul> <p>Editar el fitxer <code>/etc/ssh/sshd_config</code> per assegurar-se que permet connexions:</p> Text Only<pre><code>PermitRootLogin no\nPasswordAuthentication yes\n</code></pre> <p>Reiniciar el servei SSH per aplicar els canvis:</p> Bash<pre><code>sudo systemctl restart ssh\n</code></pre>"},{"location":"sshfs/#installar-i-configurar-sshfs-al-client","title":"Instal\u00b7lar i configurar SSHFS al client","text":"<ul> <li>Instal\u00b7lar SSHFS:</li> </ul> Bash<pre><code>sudo apt update\nsudo apt install sshfs\n</code></pre> <ul> <li> <p>Crear un punt de muntatge:</p> <ul> <li> <p>Triar un directori local on es muntar\u00e0 el sistema de fitxers remot:</p> Bash<pre><code>mkdir -p ~/ssh_remot\n</code></pre> </li> </ul> </li> <li> <p>Muntar el sistema de fitxers remot:</p> <ul> <li> <p>Utilitzar SSHFS per muntar el directori remot al punt local:</p> Bash<pre><code>sshfs usuari_remot@IP_SERVIDOR:/directori/remot ~/ssh_remot\n</code></pre> </li> <li> <p>Exemple:</p> Bash<pre><code>sshfs usuari_remot@192.168.1.100:/home/usuari_remot ~/ssh_remot\n</code></pre> </li> </ul> </li> </ul>"},{"location":"sshfs/#validar-el-muntatge","title":"Validar el muntatge","text":"<p>Comprovar que el directori est\u00e0 muntat:</p> <p>Bash<pre><code>df -h\n</code></pre>    Hauria d'apar\u00e8ixer una l\u00ednia que indique el muntatge mitjan\u00e7ant SSHFS.</p> <p>Navegar pel sistema de fitxers remot com si fos local:</p> Bash<pre><code>cd ~/ssh_remot\nls\n</code></pre> <p>Crear, editar i eliminar fitxers per comprovar l'acc\u00e9s:    Bash<pre><code>touch prova.txt\necho \"Hola m\u00f3n remot!\" &gt; prova.txt\ncat prova.txt\n</code></pre></p>"},{"location":"sshfs/#desmuntar-el-sistema-de-fitxers","title":"** Desmuntar el sistema de fitxers**","text":"<ul> <li>Una vegada finalitzada la sessi\u00f3, desmuntar el directori:</li> </ul> Bash<pre><code>fusermount -u ~/ssh_remot\n</code></pre>"},{"location":"sshfs/#tasques-complementaries","title":"Tasques complement\u00e0ries","text":""},{"location":"sshfs/#configurar-claus-ssh-per-evitar-utilitzar-contrasenyes-repetides","title":"Configurar claus SSH per evitar utilitzar contrasenyes repetides:","text":"<p>Generar una clau SSH al client:</p> Bash<pre><code>ssh-keygen -t rsa -b 4096\n</code></pre> <p>Copiar la clau p\u00fablica al servidor:</p> Bash<pre><code>ssh-copy-id usuari_remot@IP_SERVIDOR\n</code></pre> <ul> <li>Fer el muntatge autom\u00e0tic afegint una entrada a <code>/etc/fstab</code> (opcional i avan\u00e7at).</li> </ul>"},{"location":"sshfs/#muntatge-de-forma-permanent","title":"Muntatge de forma permanent","text":"<p>FSTAB</p> <p>Utilitzar fstab permet muntar el sistema de fitxers SSHFS autom\u00e0ticament cada vegada que l'equip client inicia.</p>"},{"location":"sshfs/#procediment_1","title":"Procediment","text":""},{"location":"sshfs/#verificar-que-sshfs-funciona-manualment","title":"Verificar que SSHFS funciona manualment","text":"<p>Abans d'afegir una entrada a <code>fstab</code>, assegura't que pots muntar el sistema de fitxers remot manualment:</p> Bash<pre><code>sshfs usuari_remot@IP_SERVIDOR:/directori/remot ~/ssh_remot\n</code></pre> <p>Si aix\u00f2 funciona correctament, pots continuar amb la configuraci\u00f3 a <code>fstab</code>.</p>"},{"location":"sshfs/#crear-un-punt-de-muntatge-permanent","title":"Crear un punt de muntatge permanent","text":"<p>Defineix un directori en el sistema local que sempre ser\u00e0 el punt de muntatge:</p> Bash<pre><code>mkdir -p ~/ssh_remot\n</code></pre>"},{"location":"sshfs/#configurar-les-credencials-opcional-pero-recomanat","title":"Configurar les credencials (opcional, per\u00f2 recomanat)","text":"<p>Haur\u00e0s realitzat abans aquest pas, per\u00f2 el posem ac\u00ed tamb\u00e9 a mode de tutorial. Ens evitem haver d'introduir la contrasenya.</p> <ul> <li>Genera una clau SSH al client:</li> </ul> Bash<pre><code>ssh-keygen -t rsa -b 4096\n</code></pre> <ul> <li>Copia la clau p\u00fablica al servidor:</li> </ul> Bash<pre><code>ssh-copy-id usuari_remot@IP_SERVIDOR\n</code></pre> <ul> <li>Prova l'acc\u00e9s sense contrasenya:</li> </ul> Bash<pre><code>ssh usuari_remot@IP_SERVIDOR\n</code></pre>"},{"location":"sshfs/#modificar-el-fitxer-etcfstab","title":"Modificar el fitxer <code>/etc/fstab</code>","text":"<ul> <li>Obre el fitxer <code>/etc/fstab</code> amb permisos d'administrador:</li> </ul> Bash<pre><code>sudo nano /etc/fstab\n</code></pre> <ul> <li>Afegeix una l\u00ednia al fitxer per configurar el muntatge autom\u00e0tic amb SSHFS:</li> </ul> Text Only<pre><code>usuari_remot@IP_SERVIDOR:/directori/remot  /home/usuari/ssh_remot  fuse.sshfs  defaults,_netdev,user,idmap=user,IdentityFile=/home/usuari/.ssh/id_rsa,allow_other  0  0\n</code></pre> <p>usuari_remot: el nom de l'usuari al servidor remot.</p> <p>IP_SERVIDOR: l'adre\u00e7a IP del servidor remot.</p> <p>/directori/remot: el directori al servidor remot que vols muntar.</p> <p>/home/usuari/ssh_remot: el punt de muntatge local.</p> <p>idmap=user: mant\u00e9 els permisos d'usuari.</p> <p>IdentityFile: especifica la ruta de la clau SSH (si l'utilitzes).</p> <p>allow_other: permet que altres usuaris al sistema accedeixin al muntatge (opcional).</p>"},{"location":"sshfs/#provar-el-muntatge","title":"Provar el muntatge","text":"<p>For\u00e7a el muntatge de l'entrada a <code>fstab</code> sense reiniciar:</p> Bash<pre><code>sudo mount -a\n</code></pre> <p>Comprova si el sistema de fitxers est\u00e0 muntat:</p> Bash<pre><code>df -h\n</code></pre>"},{"location":"sshfs/#resoldre-problemes-comuns","title":"Resoldre problemes comuns","text":"<ul> <li>Si tens problemes perqu\u00e8 el muntatge dep\u00e8n de la connexi\u00f3 de xarxa, afegeix l'opci\u00f3 <code>_netdev</code> a l'entrada de <code>fstab</code>. Aquesta opci\u00f3 assegura que el muntatge nom\u00e9s es fa quan la xarxa est\u00e0 activa:</li> </ul> Text Only<pre><code>defaults,_netdev\n</code></pre> <ul> <li>Si l'usuari no t\u00e9 permisos per muntar el sistema de fitxers, afegeix l'opci\u00f3 <code>user</code> per permetre als usuaris no root muntar-lo:</li> </ul> Text Only<pre><code>defaults,_netdev,user\n</code></pre> <p>allow-other</p> <ul> <li>Recorda que <code>allow_other</code> nom\u00e9s funcionar\u00e0 si tens habilitat aquesta opci\u00f3 a FUSE. </li> </ul> <p>Edita <code>/etc/fuse.conf</code> i descomenta:</p> Text Only<pre><code>user_allow_other\n</code></pre> <p>Resultat</p> <p>Despr\u00e9s de configurar <code>fstab</code>, el sistema muntar\u00e0 autom\u00e0ticament el directori remot mitjan\u00e7ant SSHFS en cada arrencada, i el punt de muntatge estar\u00e0 disponible al directori definit. Aix\u00f2 \u00e9s \u00fatil per garantir un acc\u00e9s remot consistent i automatitzat als recursos del servidor.</p>"},{"location":"sshguard/","title":"Sshguard","text":""},{"location":"sshguard/#fortificacion-del-servidor-sshguard","title":"Fortificaci\u00f3n del servidor: SSHGuard","text":""},{"location":"sshguard/#contexto","title":"Contexto","text":"<p>SSHGuard</p> <p>SSHGuard es una peque\u00f1a utilidad que se ejecuta en el servidor donde est\u00e9 instalado OpenSSH y sirve para proteger el equipo contra ataques de fuerza bruta. Tambi\u00e9n se puede utilizar para otros servicios (correo electr\u00f3nico y FTP), aunque esta pr\u00e1ctica nos centraremos solo en SSH.</p> <p>Su funcionamiento es muy sencillo:</p> <p>Revisa los archivos de auditor\u00eda del sistema en busca de intentos de acceso no satisfactorios reincidentes Bloquea las direcciones IP de los infractores utilizando alguna herramienta de firewall, entre ellas iptables. Si la direcci\u00f3n se encuentra en una lista blanca, no establece la regla en el firewall. Transcurrido un tiempo desbloquea la direcci\u00f3n del atacante, a no ser que se ha definido en una lista negra en cuyo caso no lo desbloquea.</p>"},{"location":"sshguard/#recursos","title":"Recursos","text":"Text Only<pre><code>https://www.sshguard.net\nhttps://www.sshguard.net/docs.html\nDocumentaci\u00f3n SSHGuard @ Arch Linux.\nman sshguard\nman sshguard-setup\n</code></pre> <p>Bug de sshguard</p> <p>SSHGuard en Ubuntu 20.04 parece funcionar aunque en realidad no aplica los filtros. Consulta https://askubuntu.com/questions/1245543/how-do-i-configure-sshguard-in-ubuntu-20-04 para m\u00e1s informaci\u00f3n.</p>"},{"location":"sshguard/#tareas","title":"Tareas","text":"<ul> <li>Comprobaciones previas</li> </ul> <p>Accede al servidor que has desplegado. Comprueba que se est\u00e9 ejecutando el servicio SSH.</p> Bash<pre><code>$ ss -lt\n</code></pre> <p>Comprueba los archivos de auditor\u00eda en busca de intentos de acceso a SSH. Puedes utilizar la herramienta lnav.</p>"},{"location":"sshguard/#instalacion","title":"Instalaci\u00f3n","text":"<p>Instala SSHGuard desde los paquetes de la distribuci\u00f3n.</p> <p>Consulta la documentaci\u00f3n de SSHGuard.</p> <p>Intenta comprender y explicar cada una de las opciones de los ficheros de configuraci\u00f3n. Los encontrar\u00e1s en la ruta /etc/sshguard.</p> <p>Adapta los ficheros de configuraci\u00f3n a tus necesidades. Per exemple bloqueja als possibles atacants despr\u00e9s de 5 intents fallids de login durant tres minuts.</p> <p>Reinicia el servicio.</p> Bash<pre><code>$ sudo systemctl reload-or-restart sshguard\n</code></pre> <p>Para conocer el estado del servicio Fail2ban podemos usar el siguiente comando que nos indicar\u00e1 los servicios que est\u00e1n supervisados:</p> Bash<pre><code>$ sudo systemctl status sshguard\n</code></pre>"},{"location":"sshguard/#comprobaciones-finales","title":"Comprobaciones finales","text":"<p>Si en el servidor ya hay direcciones IP bloqueadas se deber\u00edan mostrar en el cortafuego dentro del apartado Chain sshguard.</p> Bash<pre><code>$ sudo iptables -L\n</code></pre> <p>Intenta establecer una conexi\u00f3n SSH desde un equipo que no hayas incluido en la lista blanca con un usuario que no exista o con una contrase\u00f1a err\u00f3nea. Despu\u00e9s de varios intentos ya no te dejar\u00e1 conectar.</p> Bash<pre><code>$ ssh usuario_que_no_existe@nombreServidor\n</code></pre> <p>Realiza las mismas pruebas desde un equipo que hayas incluido en la lista blanca. Comprueba que no se bloquea aunque sobrepases el n\u00famero m\u00e1ximo de intentos.</p> <p>Consulta el estado del cortafuego. No deber\u00eda aparecer la direcci\u00f3n IP desde la que has intentado acceder en la lista de reglas.</p> Bash<pre><code>$ sudo iptables -L\n</code></pre>"},{"location":"sshguard/#entrega","title":"Entrega","text":"<p>Sube las capturas de pantalla pedidas en el enunciado dentro de un \u00fanico archivo PDF. No olvides marcar en las capturas de pantalla los cambios realizados para que los pueda localizar m\u00e1s f\u00e1cilmente.</p>"},{"location":"vlans_pfsense/","title":"Vlans pfsense","text":""},{"location":"vlans_pfsense/#escenari","title":"Escenari","text":"<p>Muntarem un escenari amb un router <code>Pfsense</code>, amb una interfa\u00e7 connectada a la WAN i altra a la LAN. </p> <p>VLANS</p> <p>Crearem dues VLANS que correran per la mateixa interfa\u00e7 de xarxa de la LAN. </p> <p>Utilitzarem els identificadors 20 i 30, de manera que les xarxes que tindrem seran:</p> <ul> <li>WAN (DHCP Client)</li> <li>LAN : 192.168.1.0/24</li> <li>VLAN 20 : 192.168.20.0/24</li> <li>VLAN 30 : 192.168.30.0/24</li> </ul> <p></p>"},{"location":"vlans_pfsense/#procediment","title":"Procediment","text":""},{"location":"vlans_pfsense/#importar-el-appliance-de-pfsense","title":"Importar el appliance de Pfsense","text":"<p>Pots descarregar ac\u00ed el appliance oficial. Has de baixar els dos arxius i importar-lo com qualsevol altre appliance en GNS3.</p> <p></p>"},{"location":"vlans_pfsense/#primers-passos","title":"Primers passos","text":"<p>Desr\u00e9s d'instal\u00b7lar caldr\u00e0 assignar les xarxes WAN i LAN </p>"},{"location":"vlans_pfsense/#habilitar-el-webconfig-des-de-la-wan","title":"Habilitar el webconfig des de la WAN","text":"<p>Com que voldrem configurar Pfsense des del navegador, i en principi no tenim opci\u00f3 d'entrar des de la LAN, ho haurem de fer des de la LAN. </p> <p>No es possible accedir a la web de configuraci\u00f3</p> <p>Amb la configuraci\u00f3 inicial no es pot accedir a la web de configuraci\u00f3. A m\u00e9s a m\u00e9s tamp\u00f2c accepta tr\u00e0fic per la WAN que provinga d'una xarxa local, com \u00e9s el nostre cas des de l'institut. Cal desactivar el firewall, afegir una regla per a accedir des de la WAN i habilitar l'opci\u00f3 de permetre tr\u00e0fic de xarxa local.</p> <p>Seguix les indicacions dels seg\u00fcents tutorials per a fer-ho.</p> <p>https://help.clouding.io/hc/es/articles/360010473620-C%C3%B3mo-configurar-reglas-de-firewall-en-pfSense https://www.labsmac.es/desactivar-las-reglas-del-firewall-por-consola-en-pfsense/</p>"},{"location":"vlans_pfsense/#configuracio","title":"Configuraci\u00f3","text":"<p>Ens connectem per Navegador amb la IP de la WAN del Pfsense amb admin/pfsense.</p> <ul> <li>Assignem i habilitem les interfaces WAN i LAN si no ho estan.</li> </ul>"},{"location":"vlans_pfsense/#creacio-de-vlans","title":"Creaci\u00f3 de VLANs","text":"<p>Les creem sobre la LAN</p> <p></p>"},{"location":"vlans_pfsense/#assignacio","title":"Assignaci\u00f3","text":""},{"location":"vlans_pfsense/#habilitar-les-vlans","title":"Habilitar les VLANs","text":"<p>Cal habilitar les VLANs i indicar que el <code>IPv4 Configuration Type</code> \u00e9s STATIC IPv4, i assignar les IPs corresponents. </p> <p></p>"},{"location":"vlans_pfsense/#habilitar-el-trafic-de-les-vlans-en-el-firewall","title":"Habilitar el tr\u00e0fic de les VLANs en el firewall","text":""},{"location":"vlans_pfsense/#habilitar-els-servidors-dhcp-de-les-vlans-i-la-lan","title":"Habilitar els servidors DHCP de les VLANs i la LAN","text":""},{"location":"vlans_pfsense/#configurar-els-switch","title":"Configurar els switch","text":"<p>TRUNK</p> <p>Caldr\u00e0 habilitar els ports del switchs que faran de TRUNK indicant que s\u00f3n de tipus <code>dot1q</code></p> <p></p> <p>A m\u00e9s a m\u00e9s indicarem en quines boques del switch ix cada VLAN.</p>"},{"location":"vlans_pfsense/#comprovar-les-ips","title":"Comprovar les ips","text":"<p>Es comprova que els Virtual PCs tinguen les IPs correctes en funci\u00f3 de les VLANs a les que s'han connectat.</p>"},{"location":"xifrats_ssh/","title":"Xifrats","text":"<p>Una connexi\u00f3 SSH (Secure Shell) utilitza diversos tipus de xifrat per assegurar la comunicaci\u00f3 entre el client i el servidor. Aquesta comunicaci\u00f3 segura est\u00e0 composta per diferents fases, on es fan servir diferents tipus de xifrat per protegir la integritat i la confidencialitat de les dades transmeses. A continuaci\u00f3, es detallen els principals tipus de xifrat implicats en una connexi\u00f3 SSH:</p>"},{"location":"xifrats_ssh/#1-xifrat-de-clau-publica-public-key-cryptography","title":"1. Xifrat de Clau P\u00fablica (Public Key Cryptography)","text":"<p>Aquest tipus de xifrat s'utilitza durant la fase inicial de l'establiment de la connexi\u00f3 per autenticar el servidor i, opcionalment, el client.</p> <ul> <li>RSA (Rivest\u2013Shamir\u2013Adleman): Un dels xifrats m\u00e9s comuns i robustos, basat en la dificultat de factoritzar grans nombres primers.</li> <li>DSA (Digital Signature Algorithm): S'utilitza en conjunci\u00f3 amb l'algorisme de signatura digital.</li> <li>ECDSA (Elliptic Curve Digital Signature Algorithm): Basat en corbes el\u00b7l\u00edptiques, \u00e9s m\u00e9s eficient i ofereix seguretat equivalent a RSA amb claus m\u00e9s petites.</li> <li>ED25519: Un algorisme modern de corba el\u00b7l\u00edptica que \u00e9s molt r\u00e0pid i segur, cada cop m\u00e9s utilitzat com a est\u00e0ndard en les connexions SSH.</li> </ul>"},{"location":"xifrats_ssh/#2-xifrat-simetric-symmetric-encryption","title":"2. Xifrat Sim\u00e8tric (Symmetric Encryption)","text":"<p>Despr\u00e9s de la fase d'intercanvi de claus, SSH utilitza xifrat sim\u00e8tric per assegurar la comunicaci\u00f3. En aquest tipus de xifrat, una \u00fanica clau secreta s'utilitza tant per xifrar com per desxifrar les dades.</p> <p>Alguns dels xifrats sim\u00e8trics comuns utilitzats en SSH s\u00f3n:</p> <ul> <li>AES (Advanced Encryption Standard): \u00c9s el xifrat sim\u00e8tric m\u00e9s com\u00fa, i pot operar en diferents mides de clau: 128, 192, o 256 bits. AES \u00e9s molt segur i r\u00e0pid.</li> <li>3DES (Triple Data Encryption Standard): Utilitza tres aplicacions successives de DES. \u00c9s m\u00e9s lent que AES, per\u00f2 encara es considera segur en algunes implementacions.</li> <li>ChaCha20-Poly1305: Un xifrat modern i r\u00e0pid, particularment eficient en maquinari amb poca pot\u00e8ncia, com dispositius m\u00f2bils.</li> <li>Blowfish: Un altre algorisme sim\u00e8tric que, tot i ser m\u00e9s vell, encara es troba en algunes implementacions de SSH.</li> </ul>"},{"location":"xifrats_ssh/#3-algorismes-de-hmac-integritat-de-missatges","title":"3. Algorismes de HMAC (Integritat de Missatges)","text":"<p>SSH utilitza algorismes de HMAC (Hash-based Message Authentication Code) per garantir la integritat dels missatges transmesos, assegurant que no han estat manipulats durant el transport.</p> <p>Alguns dels HMAC utilitzats en connexions SSH s\u00f3n:</p> <ul> <li>HMAC-SHA2: Utilitza la fam\u00edlia d'algorismes SHA-2, com SHA-256 o SHA-512, per proporcionar integritat i autenticaci\u00f3.</li> <li>HMAC-SHA1: Utilitza l'algorisme SHA-1 per generar el codi d'autenticaci\u00f3 de missatges. Tot i ser \u00e0mpliament utilitzat, ja no \u00e9s considerat tan segur com SHA-2.</li> <li>HMAC-MD5: Basat en l'algorisme MD5, per\u00f2 no es considera segur i ha estat en gran part reempla\u00e7at per SHA-2.</li> </ul>"},{"location":"xifrats_ssh/#4-intercanvi-de-claus-key-exchange-algorithms","title":"4. Intercanvi de Claus (Key Exchange Algorithms)","text":"<p>L'intercanvi de claus \u00e9s un proc\u00e9s en el qual el client i el servidor generen una clau sim\u00e8trica compartida de manera segura, que ser\u00e0 utilitzada per xifrar les dades durant la sessi\u00f3.</p> <p>Els algorismes comuns d'intercanvi de claus en SSH s\u00f3n:</p> <ul> <li>Diffie-Hellman Group Exchange: El servidor i el client generen una clau compartida a partir de valors p\u00fablics i privats sense que la clau es transmeti mai directament.</li> <li>Diffie-Hellman Group 14: Utilitza un grup primer m\u00e9s gran, considerat segur fins a la data.</li> <li>ECDH (Elliptic Curve Diffie-Hellman): Utilitza corbes el\u00b7l\u00edptiques per proporcionar un intercanvi de claus m\u00e9s eficient i segur.</li> <li>Curve25519: Basat en corbes el\u00b7l\u00edptiques, \u00e9s una versi\u00f3 m\u00e9s moderna i segura de Diffie-Hellman.</li> </ul>"},{"location":"yubikeys/","title":"Yubikeys","text":"<p>Una YubiKey \u00e9s un dispositiu de seguretat f\u00edsic que proporciona autenticaci\u00f3 forta de dos factors (2FA), autenticaci\u00f3 multifactor (MFA) i altres formes avan\u00e7ades de seguretat. Aquest dispositiu, fabricat per Yubico, s'utilitza per garantir l'acc\u00e9s segur a comptes en l\u00ednia, sistemes, aplicacions i xarxes.</p>"},{"location":"yubikeys/#funcions-principals-de-les-yubikeys","title":"Funcions principals de les YubiKeys:","text":"<ol> <li> <p>Autenticaci\u00f3 de dos factors (2FA): La YubiKey es pot utilitzar com una segona capa d'autenticaci\u00f3, a m\u00e9s de la contrasenya. Aix\u00f2 vol dir que per accedir a un compte, caldr\u00e0 tant la contrasenya com la pres\u00e8ncia f\u00edsica de la YubiKey.</p> </li> <li> <p>Autenticaci\u00f3 sense contrasenya (Passwordless): En lloc d'utilitzar una contrasenya, una YubiKey pot ser suficient per autenticar-te. Es basa en protocols com FIDO2 que permeten un acc\u00e9s segur sense la necessitat de recordar o gestionar contrasenyes.</p> </li> <li> <p>Claus de criptografia: Les YubiKeys poden generar i emmagatzemar claus de criptografia, utilitzant-les per xifrar o signar digitalment correus electr\u00f2nics, documents o altres dades sensibles.</p> </li> <li> <p>Suport per a diversos protocols: YubiKey suporta diferents est\u00e0ndards de seguretat com FIDO U2F, FIDO2, OTP (One-Time Password), PIV (Personal Identity Verification) i OpenPGP. Aix\u00f2 la fa molt vers\u00e0til per a una \u00e0mplia gamma d'aplicacions i plataformes.</p> </li> <li> <p>Autenticaci\u00f3 en sistemes operatius i serveis en l\u00ednia: Es pot utilitzar per autenticar-se a serveis com Gmail, GitHub, Dropbox, Microsoft, i molts altres serveis compatibles amb 2FA o autenticaci\u00f3 sense contrasenya.</p> </li> </ol>"},{"location":"yubikeys/#com-funciona-una-yubikey","title":"Com funciona una YubiKey?","text":"<p>Les YubiKeys tenen la forma d'un petit clauer USB o NFC, i la seva funci\u00f3 principal \u00e9s generar codis \u00fanics o claus que es verifiquen amb el servidor o sistema al qual es vol accedir. Aqu\u00ed hi ha alguns exemples de com pot funcionar en diferents escenaris:</p> <ul> <li>Autenticaci\u00f3 amb FIDO U2F o FIDO2:</li> <li>Quan introdueixes la teva YubiKey en un port USB (o fas servir NFC en m\u00f2bils compatibles), el sistema demana tocar el bot\u00f3 de la YubiKey per verificar que \u00e9s a les teves mans.</li> <li> <p>Aquest proc\u00e9s de toc genera una resposta criptogr\u00e0fica que nom\u00e9s pot ser produ\u00efda per la teva YubiKey, confirmant la teva identitat.</p> </li> <li> <p>OTP (Contrasenya d'un sol \u00fas):</p> </li> <li> <p>Quan es pressiona el bot\u00f3 de la YubiKey, aquesta genera una contrasenya d'un sol \u00fas (One-Time Password) que es verifica en el servidor. Cada vegada que la utilitzes, es genera un codi nou, fent molt dif\u00edcil la seva reutilitzaci\u00f3 en atacs de phishing.</p> </li> <li> <p>Autenticaci\u00f3 sense contrasenya (Passwordless):</p> </li> <li>Utilitzant protocols com FIDO2/WebAuthn, la YubiKey pot autenticar-te a un servei sense necessitat d'introduir una contrasenya. Nom\u00e9s necessites la YubiKey i la confirmaci\u00f3 f\u00edsica tocant el dispositiu.</li> </ul>"},{"location":"yubikeys/#tipus-de-yubikeys","title":"Tipus de YubiKeys:","text":"<ul> <li>YubiKey 5 Series: Compatible amb USB-A, USB-C, NFC i suport per FIDO2, FIDO U2F, OTP, PIV i OpenPGP.</li> <li>YubiKey Bio: Inclou autenticaci\u00f3 biom\u00e8trica amb empremta digital, a m\u00e9s dels protocols de seguretat convencionals.</li> <li>Security Key by Yubico: Aquesta \u00e9s una opci\u00f3 m\u00e9s econ\u00f2mica i senzilla que ofereix suport per FIDO U2F i FIDO2 per a autenticaci\u00f3 b\u00e0sica.</li> </ul>"},{"location":"yubikeys/#avantatges-de-les-yubikeys","title":"Avantatges de les YubiKeys:","text":"<ol> <li> <p>Seguretat robusta: Com que les YubiKeys requereixen pres\u00e8ncia f\u00edsica i utilitzen criptografia avan\u00e7ada, s\u00f3n molt segures i resistents a atacs com phishing, man-in-the-middle i phishing invers.</p> </li> <li> <p>F\u00e0cil d'usar: Un cop configurada, nom\u00e9s cal introduir-la al dispositiu o tocar-la per completar l'autenticaci\u00f3, fent-la f\u00e0cil d'usar en comparaci\u00f3 amb altres m\u00e8todes com les contrasenyes complexes o aplicacions de generaci\u00f3 de codis.</p> </li> <li> <p>Sense necessitat de bateries o connexi\u00f3 a internet: Les YubiKeys no requereixen manteniment, ja que no necessiten bateries ni connexi\u00f3 a internet per funcionar.</p> </li> <li> <p>Compatibilitat \u00e0mplia: Funciona amb una \u00e0mplia gamma de serveis en l\u00ednia, sistemes operatius i aplicacions empresarials.</p> </li> </ol>"},{"location":"yubikeys/#limitacions-de-les-yubikeys","title":"Limitacions de les YubiKeys:","text":"<ol> <li> <p>Depend\u00e8ncia del dispositiu f\u00edsic: Si perds la teva YubiKey o se't trenca, pot ser complicat recuperar l'acc\u00e9s als comptes, tot i que la majoria de serveis permeten configurar m\u00e8todes de recuperaci\u00f3 addicionals.</p> </li> <li> <p>Cost: Tot i que les YubiKeys s\u00f3n assequibles per a molts usuaris individuals i empreses, el cost inicial pot ser un factor limitant per a alguns.</p> </li> </ol>"},{"location":"yubikeys/#conclusio","title":"Conclusi\u00f3:","text":"<p>Les YubiKeys s\u00f3n eines molt poderoses per millorar la seguretat en l'autenticaci\u00f3, oferint una protecci\u00f3 robusta contra la majoria de tipus d'atacs cibern\u00e8tics. S\u00f3n \u00e0mpliament utilitzades tant en entorns personals com empresarials, i estan dissenyades per fer que l'acc\u00e9s als sistemes sigui segur i senzill.</p>"},{"location":"img/iptables_manual/","title":"Iptables manual","text":"<ul> <li>Skip to primary navigation</li> <li>Skip to content</li> <li>Skip to footer</li> </ul> <p>PLEDIN 3.0 </p> <ul> <li>Inicio</li> <li>Blog</li> <li>Plataforma</li> <li>M\u00f3dulos</li> <li>Presentaci\u00f3n</li> </ul> <p>Toggle search \uf002 Toggle menu </p> <p> FORMCHECKBOX Toggle Menu </p> <ul> <li>Seguridad y Alta Disponibilidad (antiguo) </li> <li>Inicio</li> <li>Introducci\u00f3n</li> <li>Criptograf\u00eda</li> <li>Cortafuegos</li> <li>VPN</li> <li>Alta disponibilidad</li> </ul>"},{"location":"img/iptables_manual/#iptables-un-manual-sencillo","title":"iptables, un manual sencillo","text":"<p>Un cortafuegos (firewall) es un dispositivo hardware o software que tiene como objetivo proteger una red de otras redes a las que est\u00e1 conectado. El cortafuegos se configura con una serie de reglas que determinan el tr\u00e1fico que puede pasar de una red a otra y el tr\u00e1fico que debe ser bloqueado. Para comprender el funcionamiento de un cortafuegos, podemos pensar en c\u00f3mo desempe\u00f1an su trabajo los guardias de seguridad de una discoteca. Los due\u00f1os del local establecen los criterios que debe cumplir un potencial cliente para poder pasar a la sala y, cada vez que alguien llega a la puerta, el portero lo eval\u00faa:</p> <ul> <li>si cumple los criterios \u2192 pasa</li> <li>si no los cumple \u2192 no pasa</li> </ul> <p>En la siguiente figura se representa el esquema de una red de ordenadores que utiliza un cortafuegos para proteger la red local de la red externa:</p> <p></p> <p>Se pueden construir cortafuegos m\u00e1s sofisticados, como veremos a lo largo del art\u00edculo, que incluyen equipos separados del resto de la red local (DMZ: Zona Desmilitarizada) para aumentar a\u00fan m\u00e1s la seguridad. De hecho, en las grandes corporaciones, es posible encontrar instalaciones con m\u00e1s de un cortafuegos, que separan los equipos de diferentes \u00e1reas de la empresa.</p>"},{"location":"img/iptables_manual/#linux-como-cortafuegospermalinka","title":"Linux como cortafuegosPermalink\u00c1**","text":"<p>El n\u00facleo de las m\u00e1quinas GNU/Linux incorpora el framework Netfilter, que permite interceptar y manipular paquetes de red. Adem\u00e1s, en el espacio de usuario, el administrador puede usar iptables para establecer las reglas del firewall.</p>"},{"location":"img/iptables_manual/#iptablespermalinka","title":"iptablesPermalink\u00c1**","text":"<p>iptables se usa para crear, mantener y revisar las tablas de filtrado de paquetes en el kernel de Linux, y se estructura de la siguiente manera:</p> <ul> <li>Existen diferentes tablas (tables) dentro de las cuales puede haber varias cadenas (chains).</li> <li>Cada cadena consiste en una lista de reglas con las que se comparan los paquetes que pasan por el cortafuegos. Las reglas especifican qu\u00e9 se hace con los paquetes que se ajustan a ellas (target).</li> </ul> <p>Para cada paquete que recibe el cortafuegos, se examina la primera regla de la cadena correspondiente. Si el paquete no se ajusta a esa regla, se contin\u00faa examinando la siguiente hasta que se ajusta con alguna. En ese momento se ejecuta el target:</p> <ul> <li>DROP: el paquete se descarta, no puede pasar</li> <li>ACCEPT: el paquete contin\u00faa su camino normal</li> </ul> <p>Si se llega al final de una cadena predefinida se ejecuta un target por defecto, llamado chain policy. El chain policy establece, por tanto, la pol\u00edtica por defecto de nuestro cortafuegos.</p>"},{"location":"img/iptables_manual/#tablaspermalinka","title":"TablasPermalink\u00c1**","text":"<p>Como dec\u00edamos, en iptables existen varias tablas, que tienen diferentes objetivos:</p> <ul> <li>La tabla filter es la tabla por defecto, y se utiliza para especificar filtros de paquetes. Contiene 3 chains predefinidas:</li> <li>INPUT: Se consulta para los paquetes que van dirigidos al propio cortafuegos</li> <li>FORWARD: La atraviesan los paquetes enrutados a trav\u00e9s de esta m\u00e1quina, es decir, aquellos paquetes en los que el origen y el destino son equipos de redes diferentes.</li> <li>OUTPUT: Para paquetes generados localmente</li> <li>La tabla nat se consulta cada vez que se ve un paquete que inicia una nueva conexi\u00f3n, con el objetivo de alterar alg\u00fan par\u00e1metro de esa conexi\u00f3n. Tiene 3 chains predefinidas:</li> <li>PREROUTING: se consulta con los paquetes que entran en la m\u00e1quina cortafuegos, tan pronto como llegan, antes de decidir qu\u00e9 hacer con ellos.</li> <li>OUTPUT: se utiliza para alterar paquetes generados localmente, antes de enrutarlos.</li> <li>POSTROUTING: para alterar los paquetes que est\u00e1n a punto de salir de la m\u00e1quina.</li> <li>La tabla mangle es una tabla especial, destinada a alterar determinados par\u00e1metros de los paquetes (TOS, TTL \u2026), que se utiliza para realizar configuraciones complejas del cortafuegos. Cuenta con 5 chains predefinidas: INPUT, OUTPUT, PREROUNTING, POSTROUTING Y FORWARD.</li> </ul>"},{"location":"img/iptables_manual/#flujo-de-los-paquetes-a-traves-de-iptablespermalinka","title":"Flujo de los paquetes a trav\u00e9s de iptablesPermalink\u00c1**","text":"<p>Veamos todos los posibles caminos que un paquete puede seguir al atravesar nuestro cortafuegos.</p> <p></p> <p>Veamos el camino que seguir\u00eda, por ejemplo, un paquete que se origina en nuestra red local y va destinado a una m\u00e1quina de Internet:</p> <ul> <li>El paquete entra en el cortafuegos por una interfaz de red, por tanto, primero se comprobar\u00edan las reglas de la cadena PREROUTING.</li> <li>A continuaci\u00f3n se comprobar\u00edan las reglas de la cadena FORWARD, ya que el paquete no va destinado a un proceso del cortafuegos, si no que va a atravesarlo, saliendo por la interfaz que lo conecta con la red externa.</li> <li>Por \u00faltimo, si el paquete no ha sido filtrado y sigue adelante, antes de salir del cortafuegos por la otra interfaz de red, se comprueban las reglas de la cadena POSTROUTING</li> </ul>"},{"location":"img/iptables_manual/#comandos-de-configuracionpermalinka","title":"Comandos de configuraci\u00f3nPermalink\u00c1**","text":"<p>Vamos a ir explicando, a continuaci\u00f3n, los comandos b\u00e1sicos de configuraci\u00f3n de iptables. Veremos alg\u00fan ejemplo sencillo, y terminaremos con un ejemplo completo de configuraci\u00f3n de un firewall con DMZ.</p>"},{"location":"img/iptables_manual/#listado-de-reglaspermalinka","title":"Listado de reglas:Permalink\u00c1**","text":"<p>iptables [-t tabla] [opciones] -L [chain]</p> <p>Muestra un listado de todas las reglas de una cadena, o de todas ellas. Las opciones disponibles son:</p> <ul> <li>-v: informaci\u00f3n detallada de una regla</li> <li>-N: crear una nueva cadena</li> <li>-X: Borrar una cadena vac\u00eda</li> </ul>"},{"location":"img/iptables_manual/#borrado-de-contadorespermalinka","title":"Borrado de contadores:Permalink\u00c1**","text":"<p>iptables [-t tabla] -Z [chain]</p> <p>Borra los contadores de una determinada chain, o de todas ellas. Es habitual colocar este comando al principio de todos los script de configuraci\u00f3n, para borrar las reglas que existieran de antemano. Se puede combinar con la opci\u00f3n -L para mostrar la informaci\u00f3n justo antes de borrarla.</p>"},{"location":"img/iptables_manual/#borrado-de-todas-las-reglaspermalinka","title":"Borrado de todas las reglas:Permalink\u00c1**","text":"<p>iptables [-t tabla] -F [chain]</p> <p>Borra las reglas de una determinada chain o de todas ellas.</p>"},{"location":"img/iptables_manual/#creacion-y-borrado-de-reglaspermalinka","title":"Creaci\u00f3n y borrado de reglas:Permalink\u00c1**","text":"<p>iptables [-t table] -A chain rule-spec</p> <p>iptables [-t table] -I chain [rulenum] rule-spec</p> <p>iptables [-t table] -R chain rulenum rule-spec</p> <p>iptables [-t table] -D chain rule-spec</p> <p>iptables [-t table] -D chain rulenum</p> <p>Las opciones son las siguientes:</p> <ul> <li>-A: a\u00f1ade una regla al final de la lista</li> <li>-I: inserta una regla al comienzo de la lista o en el punto especificado</li> <li>-R: reemplaza una regla (especificada por su n\u00famero de regla) por otra</li> <li>-D: borra una regla determinada</li> </ul> <p>Para especificar una regla podemos usar los siguientes par\u00e1metros:</p> <ul> <li>-p [!] protocolo: el protocolo del paquete a comprobar. Puede ser \u2018tcp\u2019, \u2018udp\u2019, \u2018icmp\u2019 o \u2018all\u2019</li> <li>-[sd] [!] direcci\u00f3n[/m\u00e1scara]: direcci\u00f3n ip origen (s) o destino (d) del paquete</li> <li>-[io] [!] iface: nombre de la interfaz de entrada (i) o de salida (o) del paquete</li> <li>-j target: especifica el target de dicha regla. Puede ser una acci\u00f3n predefinida (ACCEPT, DROP), una extensi\u00f3n o el nombre de una chain</li> </ul>"},{"location":"img/iptables_manual/#establecimiento-de-un-politica-por-defectopermalinka","title":"Establecimiento de un pol\u00edtica por defecto:Permalink\u00c1**","text":"<p>iptables [-t table] -P chain target</p> <p>Establece el taget que se ejecutar\u00e1 para los paquetes que no cumplan con ninguna regla de la chain especificada.</p>"},{"location":"img/iptables_manual/#un-ejemplo-sencillopermalinka","title":"Un ejemplo sencilloPermalink\u00c1**","text":"<p>Con estos comandos b\u00e1sicos de configuraci\u00f3n ya podemos resolver muchos de los problemas con los que se encuentra una empresa al exponer sus sistemas de informaci\u00f3n a Internet. Vamos a ver un ejemplo sencillo para entender c\u00f3mo se deben escribir las reglas en iptables. Observemos la figura 3, que representa una instalaci\u00f3n sencilla, con una m\u00e1quina que act\u00faa como router y cortafuegos conectando dos redes distintas.</p> <p></p> <p>Supongamos que queremos que s\u00f3lo la m\u00e1quina B pueda hablar con C, y adem\u00e1s s\u00f3lo pueda usar el protocolo TCP. Los paquetes que no cumplan estas condiciones ser\u00e1n descartados. Lo primero que tenemos que decidir es \u00bfen qu\u00e9 tabla y en qu\u00e9 cadena vamos a colocar las reglas? En este caso, queremos realizar filtrado de paquetes, por lo que est\u00e1 claro que trabajaremos con la tabla filter\u2026 pero \u00bfen la cadena INPUT, OUTPUT o FORWARD? Como los paquetes que queremos filtrar son los que van a atravesar el Firewall de una red a otra, trabajaremos con la cadena FORWARD. Los comandos que deber\u00edamos usar para conseguir estos objetivos son los siguientes:</p> <p>iptables -F FORWARD</p> <p>iptables -P FORWARD DROP</p> <p>iptables -t filter -A FORWARD -p tcp -s 192.168.1.2 -d 192.168.2.1 -j ACCEPT</p> <p>iptables -t filter -A FORWARD -p tcp -s 192.168.2.1 -d 192.168.1.2 -j ACCEPT</p> <ul> <li>La l\u00ednea 1 borra las reglas que pudiera haber en la cadena FORWARD de la tabla filter (que es la tabla por defecto).</li> <li>La l\u00ednea 2 establece la pol\u00edtica por defecto a DROP (denegar), por lo tanto, los paquetes que no cumplan con las reglas que especifiquemos ser\u00e1n rechazados.</li> <li>Las l\u00edneas 3 y 4 permiten el tr\u00e1fico entre las m\u00e1quinas B y C seg\u00fan las reglas especificadas en el enunciado.</li> </ul> <p></p> <p>Los aministradores no suelen sentarse delante de la m\u00e1quina que act\u00faa como cortafuegos y ejecutan los comandos uno a uno. Es m\u00e1s habitual escribir todos los comandos en un script de shell y ejecutar solamente el script. No s\u00f3lo se hace por comodidad, sino porque esta opci\u00f3n permite incluir comentarios y reutilizar el c\u00f3digo:</p>"},{"location":"img/iptables_manual/#binbash","title":"!/bin/bash","text":""},{"location":"img/iptables_manual/#script-de-iptables-un-ejemplo-sencillo","title":"Script de iptables \u2013 Un ejemplo sencillo","text":""},{"location":"img/iptables_manual/#borramos-las-reglas-de-la-chain-forward-de-la-tabla-filter","title":"Borramos las reglas de la chain FORWARD de la tabla filter","text":"<p>iptables -F FORWARD</p>"},{"location":"img/iptables_manual/#establecemos-la-politica-por-defecto-drop","title":"Establecemos la pol\u00edtica por defecto -&gt; DROP","text":"<p>iptables -P FORWARD DROP</p>"},{"location":"img/iptables_manual/#aceptamos-los-paquetes-tcp-entre-b-y-c","title":"Aceptamos los paquetes TCP entre B y C","text":"<p>iptables -t filter -A FORWARD -p tcp -s 192.168.1.2 -d 192.168.2.1 -j ACCEPT</p> <p>iptables -t filter -A FORWARD -p tcp -s 192.168.2.1 -d 192.168.1.2 -j ACCEPT</p>"},{"location":"img/iptables_manual/#extensiones-de-las-reglaspermalinka","title":"Extensiones de las reglasPermalink\u00c1**","text":"<p>Con las opciones vistas hasta el momento podemos controlar los par\u00e1metros m\u00e1s b\u00e1sicos de la cabecera IP del paquete. Puede ser necesario un control m\u00e1s estricto, por ello existen una serie de extensiones que permiten utilizar opciones nuevas:</p> <ul> <li>-m extensi\u00f3n: activa una extensi\u00f3n para poder especificar los par\u00e1metros del paquete.</li> </ul> <p>Veamos algunas extensiones de las reglas:</p> <ul> <li>tcp: a\u00f1ade las siguientes opciones</li> <li>--sport [!] port[:port]: especifica el puerto o rango de puertos origen</li> <li>--dport [!] port[:port]: especifica el puerto o rango de puertos destino</li> <li>[!] --syn: la regla concordar\u00e1 s\u00f3lo con los paquetes cuyo bit SYN=1 y los flags ACK y FIN valgan 0. Los datagramas con estos valores se utilizan para abrir las conexiones TCP</li> <li>udp: a\u00f1ade las siguientes opciones:</li> <li>--sport [!] port[:port]: especifica el puerto o rango de puertos origen</li> <li>--dport [!] port[:port]: especifica el puerto o rango de puertos destino</li> </ul> <p>Ejemplo: supongamos que quieres crear una regla para permitir el paso a las peticiones a un servidor web que tiene la IP 172.16.0.254.</p> <p>iptables -A FORWARD -p tcp -d 172.16.0.254 --dport 80 -j ACCEPT</p> <ul> <li>icmp: a\u00f1ade la opci\u00f3n --icmp-type tipo, que indica qu\u00e9 tipo ICMP debe tener el paquete (echo-request, echo-reply, network-unreachable\u2026)</li> <li>mac: a\u00f1ade la opci\u00f3n --mac-source [!] dir_mac, que especifica la direcci\u00f3n MAC que debe tener el paquete.</li> </ul> <p>Ejemplo: quieres permitir que se realice ping al cortafuegos desde la m\u00e1quina del administrador, que tiene IP din\u00e1mica y MAC 00:21:00:16:82:9f</p> <p>iptables -A INPUT -p icmp --icmp-type echo-request -m mac --mac-source 00:21:00:16:82:9f -j ACCEPT  </p> <p>iptables -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT</p> <ul> <li>state: A\u00f1ade la opci\u00f3n --state valor, que indica el estado en el que debe estar la conexi\u00f3n correspondiente a dicho paquete. Los tipos de estado principales son:</li> <li>NEW: el paquete corresponde a una conexi\u00f3n nueva</li> <li>ESTABLISHED: el paquete est\u00e1 asociado a una conexi\u00f3n ya establecida</li> <li>RELATED: el paquete corresponde a una conexi\u00f3n nueva, pero relacionada con una que ya est\u00e1 establecida (como un canal de datos FTP o un error de ICMP)</li> <li>multiport: Nos permite indicar con las opciones --sports y --dports varios puertos.</li> </ul>"},{"location":"img/iptables_manual/#extensiones-de-targetpermalinka","title":"Extensiones de targetPermalink\u00c1**","text":"<p>Existen otros target diferentes a DROP y ACCEPT que permiten que nuestro cortafuegos realice otras funciones a parte del filtrado de paquetes:</p> <ul> <li>MASQUERADE: s\u00f3lo es v\u00e1lida en la chain POSTROUTING. Indica que la direcci\u00f3n origen del paquete (y de todos los de esa conexi\u00f3n) ser\u00e1 cambiada por la IP local de esta m\u00e1quina. Muy \u00fatil para IP din\u00e1mica (es lo que se conoce como NAT)</li> </ul> <p>Ejemplo:</p> <p>iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE</p> <ul> <li>SNAT: s\u00f3lo es v\u00e1lida en la chain POSTROUTING. Indica que la direcci\u00f3n y puerto origen del paquete (y de todos los de esa conexi\u00f3n) sea modificada seg\u00fan se especifica con la opci\u00f3n --to-source. El target ser\u00e1 SNAT (en lugar de MASQUERADE) cuando tengamos una IP fija.</li> </ul> <p>Ejemplo:</p> <p>iptables -t nat -A POSTROUTING -o eth1 -j SNAT --to-source 189.29.35.15</p> <ul> <li>DNAT: s\u00f3lo es v\u00e1lida en las chains PREROUTING y OUTPUT. Cambia la direcci\u00f3n IP destino (y de todos los futuros de esta misma conexi\u00f3n) por el especificado con la opci\u00f3n --to-destination. Es lo que se conoce como \u2018abrir el puerto\u2019 en el router.</li> </ul> <p>Por ejemplo, si la m\u00e1quina 192.168.1.2 de nuestra red local aloja un servidor web que queremos que sea accesible desde la red externa:</p> <p>iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.2:80</p>"},{"location":"img/iptables_manual/#dmz-zona-desmilitarizadapermalinka","title":"DMZ, zona desmilitarizadaPermalink\u00c1**","text":"<p>Observa la figura siguiente, que representa una red en la que tenemos un servidor web p\u00fablico, al que vamos a permitir el acceso desde Internet, y un servidor de BBDD privado, con toda la informaci\u00f3n de nuestra empresa.</p> <p></p> <p>\u00bfQu\u00e9 ocurrir\u00eda si un atacante consigue comprometer la seguridad de nuestro servidor web? A partir de ese momento, el acceso a los recursos de la red local ser\u00eda inmediato, ya que ambos servidores se encuentran en la misma red.</p> <p>En estos casos, el uso de una DMZ permite que se puedan dar servicios a la red externa a la vez que se protege la red interna en el caso de que un intruso comprometa la seguridad de los equipos situados en la zona desmilitarizada:</p> <p></p>"},{"location":"img/iptables_manual/#un-ejemplo-completopermalinka","title":"Un ejemplo completoPermalink\u00c1**","text":"<p>Observemos la imagen, que representa la configuraci\u00f3n de la red de nuestra empresa:</p> <p></p> <p>En el ejemplo supondremos que nuestra m\u00e1quina GNU/Linux est\u00e1 conectada a un ROUTER que nos proporciona el acceso a Internet por la interfaz eth2. Este router est\u00e1 configurado como monopuesto (no hace NAT y deja pasar todo el tr\u00e1fico a nuestra m\u00e1quina Linux).</p> <p>Las direcciones de la m\u00e1quina son las siguientes:</p> <ul> <li>eth0: 192.168.1.1/24</li> <li>eth1: 192.168.2.1/24</li> <li>eth2: direcci\u00f3n IP obtenida por DHCP (din\u00e1mica)</li> </ul> <p>En la DMZ tenemos un servidor WEB y un servidor SSH que queremos sean accesibles desde Internet y la red local. Las direcciones son:</p> <ul> <li>Servidor WEB: 192.168.2.2/24</li> <li>Servidor FTP: 192.168.2.3/24</li> </ul> <p>Las m\u00e1quinas de la red local podr\u00e1n navegar por Internet accediendo a servidores WEB, servidores WEB Seguros, servidores FTP y servidores DNS. El resto de conexiones ser\u00e1n filtradas.</p> <p>Todas las m\u00e1quinas de la red local tienen direcciones del rango 192.168.1.0/24.</p> <p>Supondremos que en el firewall hay instalado un servidor ssh para que el administrador pueda conectarse desde la red local.</p> <p>Se presenta a continuaci\u00f3n un script, con una parte configurable por el usuario, para que pueda ser f\u00e1cilmente adaptado a otras instalaciones y requisitos:</p>"},{"location":"img/iptables_manual/#binbash_1","title":"!/bin/bash","text":""},{"location":"img/iptables_manual/#_1","title":"##############################################################","text":""},{"location":"img/iptables_manual/#plo-de-configuracion-de-un-firewall-con-dmz-y-red-local","title":"plo de configuraci\u00f3n de un firewall con DMZ y red local","text":""},{"location":"img/iptables_manual/#_2","title":"Iptables manual","text":"<p>### SECCI\u00d3N CONFIGURABLE POR EL USUARIO ###</p> <p># REDLOCAL    Direcci\u00f3n IP de la red local interna</p> <p># BCASTLOCAL    Direcci\u00f3n de Broadcast de la red local</p> <p># IFAZLOCAL    Nombre del interfaz de red local</p> <p># CUALQUIERA    Direcci\u00f3n de red 0.0.0.0</p> <p># IFAZEXT        Nombre del interfaz de red externo</p> <p># WEB        Direcci\u00f3n IP del servidor WEB</p> <p># FTP            Direcci\u00f3n IP del servidor FTP</p> <p># REDDMZ        Direcci\u00f3n IP de la red DMZ</p> <p># IFAZDMZ        Nombre del interfaz de red de la DMZ</p> <p># TCPLOCAL    Lista de puertos TCP que permitimos usar en la red local</p> <p># UDPLOCAL    Lista de puertos UDP que permitimos usar en la red local</p> <p>REDLOCAL = \"192.168.1.0/24\"</p> <p>BCASTLOCAL = \"192.168.1.255\"</p> <p>IFAZLOCAL = \"eth0\"</p> <p>CUALQUIERA = \"0/0\"</p> <p>IFAZEXT = \"eth2\"</p> <p>WEB = \"192.168.2.2\"</p> <p>FTP = \"192.168.2.3\"</p> <p>REDDMZ = \"192.168.2.0/24\"</p> <p>IFAZDMZ = \"eth1\"</p> <p>TCPLOCAL = \"www,ftp,ftp-data,https\"</p> <p>UDPLOCAL = \"domain\"</p> <p>###IMPLEMENTACI\u00d3N###</p> <p># Borramos todas las reglas que pudiera haber anteriormente, y los contadores</p> <p>iptables -F</p> <p>iptables -t nat -F</p> <p>iptables -X         #borra las cadenas creadas por el usuario</p> <p>iptables -Z</p> <p># Cambiamos la pol\u00edtica por defecto en todas las cadenas de la tabla filter</p> <p># Chain Policy -&gt; DROP</p> <p>iptables -P FORWARD DROP</p> <p>iptables -P INPUT DROP</p> <p>iptables -P OUTPUT DROP</p> <p># Permitimos que se acceda al cortafuegos por ssh</p> <p>iptables -A INPUT -s $REDLOCAL -p tcp --dport 22 -j ACCEPT</p> <p>iptables -A OUTPUT -d $REDLOCAL -p tcp --sport 22 -j ACCEPT</p>"},{"location":"img/iptables_manual/#conexiones-tcp","title":"CONEXIONES TCP","text":"<p># Permitimos las conexiones establecidas, desde la red externa y desde la DMZ hacia la red local en los puertos permitidos</p> <p>iptables -A FORWARD -d $REDLOCAL -p tcp  -m state --state ESTABLISHED -m multiport --sports $TCPLOCAL -j ACCEPT</p> <p># Permitimos el tr\u00e1fico desde la red local hacia la red externa y hacia la DMZ en los puertos permitidos</p> <p>iptables -A FORWARD -s $REDLOCAL -p tcp -m multiport --dports $TCPLOCAL -j ACCEPT</p> <p># Permitimos el tr\u00e1fico desde la red local y desde la red externa al servidor WEB  por el puerto 80</p> <p>iptables -A FORWARD -d $WEB -p tcp --dport 80 -j ACCEPT</p> <p># Permitimos las conexiones establecidas desde el servidor WEB a la red local y a la red externa</p> <p>iptables -A FORWARD -s $WEB -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</p> <p># Permitimos el tr\u00e1fico desde la red local y desde la red externa al servidor FTP por el puerto 20 y 21</p> <p>iptables -A FORWARD -d $FTP -p tcp --dport 20:21 -j ACCEPT</p> <p># Permitimos las conexiones establecidas desde el servidor FTP a la red local y a la red externa</p> <p>iptables -A FORWARD -s $FTP -p tcp --sport 20:21 -m state --state ESTABLISHED -j ACCEPT</p> <p># Permitimos las conexiones relacionadas desde el servidor FTP a la red local y a la red externa</p> <p>iptables -A FORWARD -s $WEB -p tcp --sport 20:21 -m state --state RELATED -j ACCEPT</p>"},{"location":"img/iptables_manual/#conexiones-udp","title":"CONEXIONES UDP","text":"<p># Permitimos las conexiones establecidas desde la red externa hacia la red local en los puertos permitidos</p> <p>iptables -A FORWARD -d $REDLOCAL -i $IFAZEXT -p udp  -m state --state     ESTABLISHED -m multiport --sports $UDPLOCAL -j ACCEPT</p> <p># Permitimos el tr\u00e1fico desde la red local hacia la red externa  en los puertos permitidos</p> <p>iptables -A FORWARD -s $REDLOCAL -o $IFAZEXT -p udp -m multiport --dports     $UDPLOCAL -j ACCEPT</p> <p>## Hacemos NAT para las m\u00e1quinas de la red local y para las m\u00e1quinas de la  DMZ</p> <p>iptables -t nat -A POSTROUTING -o eth2 -j MASQUERADE</p> <p># Si la direcci\u00f3n IP P\u00fablica fuera est\u00e1tica har\u00edamos SNAT</p> <p>## Hacemos DNAT para que las peticiones que recibimos de Internet lleguen a los servidores</p> <p>iptables -t nat -A PREROUTING -i eth2 -p tcp --dport 80 -j DNAT --to-destination $WEB:80</p> <p>iptables -t nat -A PREROUTING -i eth2 -p tcp \u2013dport 20 -j DNAT --to-destination $FTP:20</p> <p>Updated: September 28, 2022</p> <p>Enter your search term... </p> <ul> <li>**   Feed</li> </ul> <p>\u00a9 2022 Jos\u00e9 Domingo Mu\u00f1oz. Powered by Jekyll &amp; Minimal Mistakes.</p>"}]}