
<!doctype html>
<html lang="ca" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../yubikeys/">
      
      
        <link rel="next" href="../reduir_serveis/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.14">
    
    
      
        <title>Apunts IPTables - BASTIONAT DE XARXES I SISTEMES - CE Ciberseguretat</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fad675c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#iptables-un-manual-senzill" class="md-skip">
          Salta el contingut
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Capçalera">
    <a href=".." title="BASTIONAT DE XARXES I SISTEMES - CE Ciberseguretat" class="md-header__button md-logo" aria-label="BASTIONAT DE XARXES I SISTEMES - CE Ciberseguretat" data-md-component="logo">
      
  <img src="../img/logocap.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BASTIONAT DE XARXES I SISTEMES - CE Ciberseguretat
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Apunts IPTables
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Format oscur"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Format oscur" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Format clar"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Format clar" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Neteja" aria-label="Neteja" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicialitzant cerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Pestanyes" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Inici

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../manuals/" class="md-tabs__link">
          
  
  Manuals

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../instalar_gns3_primer_escenari/" class="md-tabs__link">
          
  
  GNS3

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../criptografia/" class="md-tabs__link">
          
  
  Criptografía

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ssh/" class="md-tabs__link">
          
  
  SSH

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../equipBase/" class="md-tabs__link">
          
  
  Fortificació equip base

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../hotspot/" class="md-tabs__link">
          
  
  Hotspot

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../snmp/" class="md-tabs__link">
          
  
  Monitorització

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navegació" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BASTIONAT DE XARXES I SISTEMES - CE Ciberseguretat" class="md-nav__button md-logo" aria-label="BASTIONAT DE XARXES I SISTEMES - CE Ciberseguretat" data-md-component="logo">
      
  <img src="../img/logocap.png" alt="logo">

    </a>
    BASTIONAT DE XARXES I SISTEMES - CE Ciberseguretat
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inici
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Manuals
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Manuals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manuals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guíes i manuals
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    GNS3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            GNS3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../instalar_gns3_primer_escenari/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Instal·lació de GNS3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crear_appliances/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crear appliances
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Criptografía
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Criptografía
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../criptografia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Prac_T2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pràctiques del tema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apunts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apunts complementaris
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    SSH
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            SSH
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apunts SSH
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Apunts SSH
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connexio_ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connexió SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xifrats_ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Xifrats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pràctiques
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Pràctiques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hardering_ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hardering SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssh_2fa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2FA SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sshaudit24/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH-Audit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssh_guard2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH-Guard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fail2ban_telegram/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fail2ban i Telegram
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ssh_cert/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Accés remot amb certificats
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sshfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSHFS
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Fortificació equip base
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Fortificació equip base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apunts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Apunts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../equipBase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortificació
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../servidorNAS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Còpies de seguretat
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../honeypot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HoneyPot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yubikeys/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Yubikeys
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Apunts IPTables
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Apunts IPTables
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#iptables-un-manual-senzill" class="md-nav__link">
    <span class="md-ellipsis">
      Iptables, un manual senzill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-linux-com-a-tallafocs" class="md-nav__link">
    <span class="md-ellipsis">
      1. Linux com a tallafocs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Linux com a tallafocs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    <span class="md-ellipsis">
      iptables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#taules" class="md-nav__link">
    <span class="md-ellipsis">
      Taules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fluix-dels-paquets-a-traves-diptables" class="md-nav__link">
    <span class="md-ellipsis">
      Fluix dels paquets a través d'iptables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comandos-de-configuracio" class="md-nav__link">
    <span class="md-ellipsis">
      Comandos de configuració
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comandos de configuració">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llistat-de-regles" class="md-nav__link">
    <span class="md-ellipsis">
      Llistat de regles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esborrat-de-comptadors" class="md-nav__link">
    <span class="md-ellipsis">
      Esborrat de comptadors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esborrat-de-totes-les-regles" class="md-nav__link">
    <span class="md-ellipsis">
      Esborrat de totes les regles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacio-i-esborrat-de-regles" class="md-nav__link">
    <span class="md-ellipsis">
      Creació i esborrat de regles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#establiment-duna-politica-per-defecte" class="md-nav__link">
    <span class="md-ellipsis">
      Establiment d'una política per defecte
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-un-exemple-senzill" class="md-nav__link">
    <span class="md-ellipsis">
      2. Un exemple senzill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-exemple-complet-amb-dmz" class="md-nav__link">
    <span class="md-ellipsis">
      3. Exemple complet amb DMZ
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pràctiques
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Pràctiques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reduir_serveis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reducció serveis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practiquesBase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Equip base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../serverNAS/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Servidor NAS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tallafoc_windows/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tallafoc Windows
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tallafoc_linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tallafoc Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2_6" >
        
          
          <label class="md-nav__link" for="__nav_6_2_6" id="__nav_6_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Active Directory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2_6">
            <span class="md-nav__icon md-icon"></span>
            Active Directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crear_ad.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Crear AD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../editar_gpo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Editar GPOs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../active_directory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPOs interesants
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Hotspot
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Hotspot
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apunts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Apunts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hotspot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hotspot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pràctiques
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Pràctiques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../practiquesHotspot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creació Hotspot
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hotspot_user_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lots d'usuaris
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Monitorització
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Monitorització
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Apunts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Apunts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SNMP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent_snmp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent SNMP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pràctiques
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Pràctiques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prac_the_dude/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitorització amb The Dude
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Taula de continguts">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Taula de continguts
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#iptables-un-manual-senzill" class="md-nav__link">
    <span class="md-ellipsis">
      Iptables, un manual senzill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-linux-com-a-tallafocs" class="md-nav__link">
    <span class="md-ellipsis">
      1. Linux com a tallafocs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Linux com a tallafocs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    <span class="md-ellipsis">
      iptables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#taules" class="md-nav__link">
    <span class="md-ellipsis">
      Taules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fluix-dels-paquets-a-traves-diptables" class="md-nav__link">
    <span class="md-ellipsis">
      Fluix dels paquets a través d'iptables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comandos-de-configuracio" class="md-nav__link">
    <span class="md-ellipsis">
      Comandos de configuració
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comandos de configuració">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#llistat-de-regles" class="md-nav__link">
    <span class="md-ellipsis">
      Llistat de regles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esborrat-de-comptadors" class="md-nav__link">
    <span class="md-ellipsis">
      Esborrat de comptadors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#esborrat-de-totes-les-regles" class="md-nav__link">
    <span class="md-ellipsis">
      Esborrat de totes les regles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creacio-i-esborrat-de-regles" class="md-nav__link">
    <span class="md-ellipsis">
      Creació i esborrat de regles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#establiment-duna-politica-per-defecte" class="md-nav__link">
    <span class="md-ellipsis">
      Establiment d'una política per defecte
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-un-exemple-senzill" class="md-nav__link">
    <span class="md-ellipsis">
      2. Un exemple senzill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-exemple-complet-amb-dmz" class="md-nav__link">
    <span class="md-ellipsis">
      3. Exemple complet amb DMZ
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Apunts IPTables</h1>

<h2 id="iptables-un-manual-senzill"><strong>Iptables, un manual senzill</strong></h2>
<div class="admonition info">
<p class="admonition-title">Firewall</p>
<p>Un tallafocs (firewall) és un dispositiu de hardware o software que té com a objectiu protegir una xarxa d'altres xarxes a les quals està connectat. El tallafocs es configura amb una sèrie de regles que determinen el trànsit que pot passar d'una xarxa a una altra i el trànsit que ha de ser bloquejat. </p>
</div>
<p>Per comprendre el funcionament d'un tallafocs, podem pensar en com realitzen la seva feina els guàrdies de seguretat d'una discoteca. Els propietaris del local estableixen els criteris que ha de complir un client potencial per poder passar a la sala i, cada vegada que algú arriba a la porta, el porter l'avalua:</p>
<ul>
<li>si compleix els criteris → passa</li>
<li>si no els compleix → no passa</li>
</ul>
<p>A la següent figura es representa l'esquema d'una xarxa d'ordinadors que utilitza un tallafocs per protegir la xarxa local de la xarxa externa:</p>
<p><img alt="iptables" src="../img/img_iptables/iptables1.png" /></p>
<p>Es poden construir tallafocs més sofisticats, que incloguen equips separats de la resta de la xarxa local (<strong>DMZ: Zona Desmilitaritzada</strong>) per augmentar encara més la seguretat. De fet, en les grans corporacions, és possible trobar instal·lacions amb més d'un tallafocs, que separen els equips de diferents àrees de l'empresa.</p>
<h2 id="1-linux-com-a-tallafocs">1. Linux com a tallafocs</h2>
<p>El nucli de les màquines GNU/Linux incorpora el framework Netfilter, que permet interceptar i manipular paquets de xarxa. A més, en l'espai d'usuari, l'administrador pot usar iptables per establir les regles del tallafocs.</p>
<h3 id="iptables">iptables</h3>
<p>iptables s'utilitza per crear, mantenir i revisar les taules de filtratge de paquets en el nucli de Linux, i s'estructura de la següent manera:</p>
<ul>
<li>Existeixen diferents taules (tables) dins de les quals pot haver-hi diverses cadenes (chains).</li>
<li>Cada cadena consisteix en una llista de regles amb les quals es comparen els paquets que passen pel tallafocs. Les regles especifiquen què es fa amb els paquets que s'ajusten a elles (target).</li>
</ul>
<p>Per a cada paquet que rep el tallafocs, s'examina la primera regla de la cadena corresponent. Si el paquet no s'ajusta a aquesta regla, es continua examinant la següent fins que s'ajusti amb alguna. En aquell moment s'executa el target:</p>
<ul>
<li>DROP: el paquet es descarta, no pot passar</li>
<li>ACCEPT: el paquet continua el seu camí normal</li>
</ul>
<p>Si s'arriba al final d'una cadena predefinida s'executa un target per defecte, anomenat política de cadena (chain policy). La política de cadena estableix, per tant, la política per defecte del nostre tallafocs.</p>
<h3 id="taules">Taules</h3>
<p>Com dèiem, en iptables existeixen diverses taules, que tenen diferents objectius:</p>
<ul>
<li>La taula filter és la taula per defecte, i s'utilitza per especificar filtres de paquets. Conté 3 cadenes predefinides:</li>
<li>INPUT: Es consulta per als paquets que van dirigits al propi tallafocs.</li>
<li>FORWARD: La travessen els paquets enrutats a través d'aquesta màquina, és a dir, aquells paquets en els quals l'origen i el destí són equips de xarxes diferents.</li>
<li>OUTPUT: Per a paquets generats localment.</li>
<li>La taula nat es consulta cada vegada que es veu un paquet que inicia una nova connexió, amb l'objectiu de modificar algun paràmetre d'aquella connexió. Té 3 cadenes predefinides:</li>
<li>PREROUTING: es consulta amb els paquets que entren a la màquina tallafocs, tan aviat com arriben, abans de decidir què fer amb ells.</li>
<li>OUTPUT: s'utilitza per alterar paquets generats localment, abans de rutar-los.</li>
<li>POSTROUTING: per alterar els paquets que estan a punt de sortir de la màquina.</li>
<li>La taula mangle és una taula especial, destinada a alterar determinats paràmetres dels paquets (TOS, TTL …), que s'utilitza per realitzar configuracions complexes del tallafocs. Comptarà amb 5 cadenes predefinides: INPUT, OUTPUT, PREROUTING, POSTROUTING I FORWARD.</li>
</ul>
<h3 id="fluix-dels-paquets-a-traves-diptables">Fluix dels paquets a través d'iptables</h3>
<p>Veiem tots els possibles camins que un paquet pot seguir al travessar el nostre tallafocs.</p>
<p><img alt="iptables" src="../img/img_iptables/iptables2.png" /></p>
<p>Veiem el camí que seguiria, per exemple, un paquet que s'origina a la nostra xarxa local i va destinat a una màquina d'Internet:</p>
<ul>
<li>El paquet entra al tallafocs per una interfície de xarxa, per tant, primer es comprovarien les regles de la cadena PREROUTING.</li>
<li>A continuació es comprovarien les regles de la cadena FORWARD, ja que el paquet no va destinat a un procés del tallafocs, sinó que va a travessar-lo, sortint per la interfície que el connecta amb la xarxa externa.</li>
<li>Finalment, si el paquet no ha estat filtrat i continua endavant, abans de sortir del tallafocs per l'altra interfície de xarxa, es comproven les regles de la cadena POSTROUTING.</li>
</ul>
<h3 id="comandos-de-configuracio">Comandos de configuració</h3>
<p>Anem a explicar, a continuació, els comandos bàsics de configuració d'iptables. Veurem algun exemple senzill, i acabarem amb un exemple complet de configuració d'un tallafocs amb DMZ.</p>
<h4 id="llistat-de-regles">Llistat de regles</h4>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span><span class="o">[</span>opcions<span class="o">]</span><span class="w"> </span>-L<span class="w"> </span><span class="o">[</span>cadena<span class="o">]</span>
</span></code></pre></div></td></tr></table></div>
<p>Mostra un llistat de totes les regles d'una cadena, o de totes elles. Les opcions disponibles són:</p>
<ul>
<li>-v: informació detallada d'una regla</li>
<li>-N: crear una nova cadena</li>
<li>-X: Esborrar una cadena buida</li>
</ul>
<h4 id="esborrat-de-comptadors">Esborrat de comptadors</h4>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-Z<span class="w"> </span><span class="o">[</span>cadena<span class="o">]</span>
</span></code></pre></div></td></tr></table></div>
<p>Esborra els comptadors d'una determinada cadena, o de totes elles. És habitual col·locar aquest comandament al principi de tots els scripts de configuració, per esborrar les regles que existien prèviament. Es pot combinar amb l'opció -L per mostrar la informació just abans d'esborrar-la.</p>
<h4 id="esborrat-de-totes-les-regles">Esborrat de totes les regles</h4>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-F<span class="w"> </span><span class="o">[</span>cadena<span class="o">]</span>
</span></code></pre></div></td></tr></table></div>
<p>Esborra les regles d'una determinada cadena o de totes elles.</p>
<h4 id="creacio-i-esborrat-de-regles">Creació i esborrat de regles</h4>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-A<span class="w"> </span>cadena<span class="w"> </span>regla-especificada
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-I<span class="w"> </span>cadena<span class="w"> </span><span class="o">[</span>número-regla<span class="o">]</span><span class="w"> </span>regla-especificada
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-R<span class="w"> </span>cadena<span class="w"> </span>número-regla<span class="w"> </span>regla-especificada
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-D<span class="w"> </span>cadena<span class="w"> </span>regla-especificada
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-D<span class="w"> </span>cadena<span class="w"> </span>número-regla
</span></code></pre></div></td></tr></table></div>
<p>Les opcions són les següents:</p>
<ul>
<li>-A: afegeix una regla al final de la llista</li>
<li>-I: insereix una regla al començament de la llista o en el punt especificat</li>
<li>-R: reemplaça una regla (especificada pel seu número de regla) per una altra</li>
<li>-D: esborra una regla determinada</li>
</ul>
<p>Per especificar una regla podem usar els següents paràmetres:</p>
<ul>
<li>-p [!] protocol: el protocol del paquet a comprovar. Pot ser ‘tcp’, ‘udp’, ‘icmp’ o ‘all’.</li>
<li>-[sd] [!] adreça[/màscara]: adreça ip origen (s) o destí (d) del paquet.</li>
<li>-[io] [!] iface: nom de la interfície d'entrada (i) o de sortida (o) del paquet.</li>
<li>-j target: especifica el target d'aquesta regla. Pot ser una acció predefinida (ACCEPT, DROP), una extensió o el nom d'una cadena.</li>
</ul>
<h4 id="establiment-duna-politica-per-defecte">Establiment d'una política per defecte</h4>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a>iptables<span class="w"> </span><span class="o">[</span>-t<span class="w"> </span>taula<span class="o">]</span><span class="w"> </span>-P<span class="w"> </span>cadena<span class="w"> </span>target
</span></code></pre></div></td></tr></table></div>
<p>Estableix el target que s'executarà per als paquets que no compleixin cap regla de la cadena especificada.</p>
<h2 id="2-un-exemple-senzill">2. Un exemple senzill</h2>
<p>Amb aquests comandaments bàsics de configuració ja podem resoldre molts dels problemes amb els quals es troba una empresa al exposar els seus sistemes d'informació a Internet. Anem a veure un exemple senzill per entendre com s'han d'escriure les regles en iptables. Observem la figura 3, que representa una instal·lació senzilla, amb una màquina que actua com a router i tallafocs connectant dues xarxes diferents.</p>
<p><img alt="iptables" src="../img/img_iptables/iptables3.png" /></p>
<p>Suposem que volem que només la màquina B puga parlar amb C, i a més només puga usar el protocol TCP. Els paquets de la xarxa A no han d'accedir a la màquina C, i no volem que l'usuari de B puga accedir a la màquina A. En aquest escenari, no volem exposar la màquina A a Internet, així que definirem les següents regles:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Esborrem totes les regles existents</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a>iptables<span class="w"> </span>-F
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="c1"># Establim les polítiques per defecte</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a>iptables<span class="w"> </span>-P<span class="w"> </span>INPUT<span class="w"> </span>DROP
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a>iptables<span class="w"> </span>-P<span class="w"> </span>FORWARD<span class="w"> </span>DROP
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a>iptables<span class="w"> </span>-P<span class="w"> </span>OUTPUT<span class="w"> </span>ACCEPT
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="c1"># Permetem l&#39;accés a la màquina B</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.1.2<span class="w"> </span>-d<span class="w"> </span><span class="m">192</span>.168.1.3<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span></code></pre></div></td></tr></table></div>
<p>Amb això, ja tenim la màquina B connectada amb la màquina C. Encara podem permetre l'accés a la màquina C des d'Internet, i prohibir l'accés a la màquina A. Veiem com implementar-ho:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># Permet l&#39;accés a la màquina C</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span>.0.0.0/0<span class="w"> </span>-d<span class="w"> </span><span class="m">192</span>.168.1.3<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span></code></pre></div></td></tr></table></div>
<p>A partir d'aquest moment, la màquina B pot accedir a la màquina C, i la màquina C està accessible des d'Internet. La màquina A no pot ser accedida des de cap lloc.</p>
<h2 id="3-exemple-complet-amb-dmz">3. Exemple complet amb DMZ</h2>
<p>A l'últim exemple, construirem un tallafocs que contindrà una DMZ. La xarxa es veurà així:</p>
<p><img alt="iptables" src="../img/img_iptables/iptables4.png" /></p>
<p>El tallafocs estarà format per tres interfícies de xarxa:</p>
<ul>
<li><strong>INTERFÍCIE_EXTERNA:</strong> connecta amb Internet.</li>
<li><strong>INTERFÍCIE_DMZ:</strong> connecta amb la DMZ (servidor web i servidor de correu).</li>
<li><strong>INTERFÍCIE_INTERNA:</strong> connecta amb la xarxa interna de l'empresa.</li>
</ul>
<p><img alt="iptables" src="../img/img_iptables/iptables9.png" /></p>
<p>El tallafocs ha de ser capaç de controlar les comunicacions de les xarxes internes amb la DMZ, així com les comunicacions de la DMZ amb Internet. Les regles seran:</p>
<div class="language-bash highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Esborrem les regles existents</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>iptables<span class="w"> </span>-F
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="c1"># Establim les polítiques per defecte</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a>iptables<span class="w"> </span>-P<span class="w"> </span>INPUT<span class="w"> </span>DROP
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a>iptables<span class="w"> </span>-P<span class="w"> </span>FORWARD<span class="w"> </span>DROP
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a>iptables<span class="w"> </span>-P<span class="w"> </span>OUTPUT<span class="w"> </span>ACCEPT
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="c1"># Permet l&#39;accés a la màquina DMZ des de la xarxa interna</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-d<span class="w"> </span><span class="m">192</span>.168.2.0/24<span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="c1"># Permet l&#39;accés a la xarxa interna des de la DMZ</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.2.0/24<span class="w"> </span>-d<span class="w"> </span><span class="m">192</span>.168.1.0/24<span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="c1"># Permet l&#39;accés a Internet des del servidor web de la DMZ</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-s<span class="w"> </span><span class="m">192</span>.168.2.2<span class="w"> </span>-d<span class="w"> </span><span class="m">0</span>.0.0.0/0<span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="c1"># Permet l&#39;accés des de Internet al servidor web</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19"></a>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span>.0.0.0/0<span class="w"> </span>-d<span class="w"> </span><span class="m">192</span>.168.2.2<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20"></a>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="c1"># Permet l&#39;accés al servidor de correu</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22"></a>iptables<span class="w"> </span>-A<span class="w"> </span>FORWARD<span class="w"> </span>-s<span class="w"> </span><span class="m">0</span>.0.0.0/0<span class="w"> </span>-d<span class="w"> </span><span class="m">192</span>.168.2.3<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">25</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
</span></code></pre></div></td></tr></table></div>
<p>Amb això, hem aconseguit una bona configuració inicial d'un tallafocs. Tot i això, cal tenir en compte que aquesta és una configuració bàsica, i que en una instal·lació real seria convenient aplicar estratègies de seguretat addicionals.</p>
<hr />





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Peu de pàgina" >
        
          
          <a href="../yubikeys/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Yubikeys">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                Yubikeys
              </div>
            </div>
          </a>
        
        
          
          <a href="../reduir_serveis/" class="md-footer__link md-footer__link--next" aria-label="Següent: Reducció serveis">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Següent
              </span>
              <div class="md-ellipsis">
                Reducció serveis
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Maite Martí - Xuso Ortí - Professors Departament d'Informàtica IES Jaume II el Just (Tavernes de la Valldigna)
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "content.code.copy", "content.code.annotate", "content.code.select", "navigation.footer"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copiat al porta-retalls", "clipboard.copy": "C\u00f2pia al porta-retalls", "search.result.more.one": "1 m\u00e9s en aquesta p\u00e0gina", "search.result.more.other": "# m\u00e9s en aquesta p\u00e0gina", "search.result.none": "Cap document coincideix", "search.result.one": "1 document coincident", "search.result.other": "# documents coincidents", "search.result.placeholder": "Escriu per a comen\u00e7ar a cercar", "search.result.term.missing": "Desaparegut", "select.version": "Selecciona la versi\u00f3"}}</script>
    
    
      <script src="../assets/javascripts/bundle.cd18aaf1.min.js"></script>
      
    
  </body>
</html>